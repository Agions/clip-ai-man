import{r as e,j as t,u as a,f as n,g as s,R as r,B as i,h as o,i as l,N as d,k as c}from"./react-vendor-43699894.js";import{b5 as u,b6 as p,b7 as m,b8 as h,b4 as g,b9 as y,ba as x,bb as j,bc as f,bd as _,be as v,bf as w}from"./antd-core-3ff350fe.js";import{_ as S}from"./antd-overlay-2fb1735a.js";import{_ as b}from"./antd-form-ac5cb9b6.js";import{v as C,a as N}from"./utils-vendor-2c130484.js";import{_ as k}from"./antd-select-f6d45ce4.js";import{invoke as I}from"@tauri-apps/api/core";import{listen as T}from"@tauri-apps/api/event";import"./antd-locale-f40aeb8b.js";import"./antd-date-504a9cb2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const A=e.createContext({isDarkMode:!1,toggleTheme:()=>{}}),O=({children:a})=>{const[n,s]=e.useState(!1);e.useEffect(()=>{const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=e?"dark"===e:t;s(a),r(a);const n=window.matchMedia("(prefers-color-scheme: dark)"),i=t=>{null===e&&(s(t.matches),r(t.matches))};return n.addEventListener?n.addEventListener("change",i):n.addListener(i),()=>{n.removeEventListener?n.removeEventListener("change",i):n.removeListener(i)}},[]);const r=e=>{const t=document.documentElement;e?(t.classList.add("dark-theme"),document.body.style.backgroundColor="#141414",document.body.style.color="rgba(255, 255, 255, 0.85)",t.style.setProperty("--text-color-primary","rgba(255, 255, 255, 0.85)"),t.style.setProperty("--text-color-secondary","rgba(255, 255, 255, 0.65)"),t.style.setProperty("--text-color-disabled","rgba(255, 255, 255, 0.35)"),t.style.setProperty("--bg-color-primary","#141414"),t.style.setProperty("--bg-color-secondary","#1f1f1f"),t.style.setProperty("--bg-color-component","#1f1f1f"),t.style.setProperty("--border-color","#303030"),t.style.setProperty("--form-label-color","rgba(255, 255, 255, 0.85)"),document.body.querySelectorAll(".ant-form-item-label > label").forEach(e=>e.style.color="rgba(255, 255, 255, 0.85)")):(t.classList.remove("dark-theme"),document.body.style.backgroundColor="#fff",document.body.style.color="rgba(0, 0, 0, 0.85)",t.style.setProperty("--text-color-primary","rgba(0, 0, 0, 0.85)"),t.style.setProperty("--text-color-secondary","rgba(0, 0, 0, 0.65)"),t.style.setProperty("--text-color-disabled","rgba(0, 0, 0, 0.35)"),t.style.setProperty("--bg-color-primary","#ffffff"),t.style.setProperty("--bg-color-secondary","#f0f2f5"),t.style.setProperty("--bg-color-component","#ffffff"),t.style.setProperty("--border-color","#d9d9d9"),t.style.setProperty("--form-label-color","rgba(0, 0, 0, 0.85)"),document.body.querySelectorAll(".ant-form-item-label > label").forEach(e=>e.style.color=""))};return t.jsx(A.Provider,{value:{isDarkMode:n,toggleTheme:()=>{const e=!n;s(e),localStorage.setItem("theme",e?"dark":"light"),r(e)}},children:a})},E=()=>e.useContext(A),{Sider:P,Content:$,Header:D}=u,{Title:M,Text:z}=p,B=({children:s})=>{const r=a(),i=n(),[o,l]=e.useState(!1);E();const[d,c]=e.useState(3),[u,p]=e.useState(window.innerWidth);e.useEffect(()=>{const e=()=>{p(window.innerWidth),window.innerWidth<768&&!o?l(!0):window.innerWidth>=1200&&o&&l(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[o]);const m=e=>"/"===e?"/"===i.pathname:i.pathname.startsWith(e),h=[{key:"/",icon:t.jsx(HomeOutlined,{}),label:"首页",onClick:()=>r("/")},{key:"/workflow",icon:t.jsx(ThunderboltOutlined,{}),label:"漫剧工作流",onClick:()=>r("/workflow")},{key:"/project",icon:t.jsx(VideoCameraOutlined,{}),label:"项目管理",onClick:()=>r("/")},{key:"/editor",icon:t.jsx(ScissorOutlined,{}),label:"视频剪辑",onClick:()=>r("/editor")},{key:"/templates",icon:t.jsx(AppstoreOutlined,{}),label:"模板中心",onClick:()=>r("/templates")},{key:"/scripts",icon:t.jsx(BookOutlined,{}),label:"脚本库",onClick:()=>r("/scripts")},{key:"/settings",icon:t.jsx(SettingOutlined,{}),label:"设置",onClick:()=>r("/settings")}],g={items:[{key:"profile",label:"个人信息",icon:t.jsx(UserOutlined,{})},{key:"preferences",label:"偏好设置",icon:t.jsx(SettingOutlined,{})},{type:"divider"},{key:"logout",label:"退出登录",danger:!0}],onClick:e=>{"preferences"===e.key?r("/settings"):e.key}},y={items:[{key:"1",label:t.jsxs("div",{children:[t.jsx(z,{strong:!0,children:"视频处理完成"}),t.jsx("div",{children:t.jsx(z,{type:"secondary",children:"《夏日海滩》视频已处理完成"})})]})},{key:"2",label:t.jsxs("div",{children:[t.jsx(z,{strong:!0,children:"脚本生成完成"}),t.jsx("div",{children:t.jsx(z,{type:"secondary",children:"AI助手已完成脚本生成"})})]})},{key:"3",label:t.jsxs("div",{children:[t.jsx(z,{strong:!0,children:"系统通知"}),t.jsx("div",{children:t.jsx(z,{type:"secondary",children:"有新版本可用：v2.1.0"})})]})},{type:"divider"},{key:"all",label:t.jsx(z,{type:"secondary",children:"查看全部通知"})}],onClick:e=>{"all"===e.key?r("/notifications"):c(e=>e-1)}};return t.jsxs(AntLayout,{className:"_layout_dkfi8_1 "+(o?"_siderCollapsed_dkfi8_110":""),children:[t.jsxs(P,{className:"_sider_dkfi8_4",theme:"light",trigger:null,collapsible:!0,collapsed:o,width:220,breakpoint:"lg",children:[t.jsx("div",{className:"_logo_dkfi8_27",children:o?t.jsx(FireOutlined,{style:{fontSize:"24px",color:"#FF5252"}}):t.jsxs(Space,{children:[t.jsx(FireOutlined,{style:{fontSize:"24px",color:"#FF5252"}}),t.jsx(M,{level:4,style:{margin:0},children:"ClipAiMan"})]})}),t.jsx(Menu,{mode:"inline",className:"_menu_dkfi8_59",selectedKeys:[!m("/")||m("/project")||m("/editor")?m("/project")?"/project":m("/templates")?"/templates":m("/editor")?"/editor":m("/scripts")?"/scripts":m("/settings")?"/settings":"":"/"],items:h}),t.jsx("div",{className:"_collapseButton_dkfi8_122",children:t.jsx(Tooltip,{title:o?"展开菜单":"收起菜单",placement:"right",children:t.jsx(Button,{type:"text",icon:o?t.jsx(MenuUnfoldOutlined,{}):t.jsx(MenuFoldOutlined,{}),onClick:()=>{l(!o)}})})})]}),t.jsxs(AntLayout,{children:[t.jsxs(D,{className:"_header_dkfi8_128",children:[t.jsxs("div",{className:"_headerTitle_dkfi8_146",children:["/"===i.pathname&&"欢迎使用ClipAiMan",i.pathname.startsWith("/workflow")&&"漫剧工作流",i.pathname.startsWith("/project")&&"项目管理",i.pathname.startsWith("/templates")&&"模板中心",i.pathname.startsWith("/editor")&&"视频剪辑工作台",i.pathname.startsWith("/scripts")&&"脚本库",i.pathname.startsWith("/settings")&&"系统设置"]}),t.jsxs("div",{className:"_headerControls_dkfi8_164",children:[t.jsx(Tooltip,{title:"帮助中心",children:t.jsx(Button,{type:"text",shape:"circle",icon:t.jsx(QuestionCircleOutlined,{})})}),t.jsx(Dropdown,{menu:y,trigger:["click"],placement:"bottomRight",arrow:!0,children:t.jsx(Badge,{count:d,overflowCount:99,size:"small",children:t.jsx(Button,{type:"text",shape:"circle",icon:t.jsx(BellOutlined,{})})})}),t.jsx(Dropdown,{menu:g,placement:"bottomRight",trigger:["click"],arrow:!0,children:t.jsx(Button,{type:"text",className:"_userButton_dkfi8_173",children:t.jsxs(Space,{children:[t.jsx(Avatar,{size:"small",style:{backgroundColor:"#1E88E5"},children:"U"}),u>576&&t.jsx("span",{children:"用户"})]})})})]})]}),t.jsx($,{className:"_content_dkfi8_100",children:t.jsx("div",{className:"_contentWrapper_dkfi8_113",children:s})})]})]})},{Title:F,Text:L}=p,R=()=>{const n=a(),[s]=e.useState(()=>(e=>[{id:"1",type:"workflow",title:"一键生成漫剧",description:"输入主题，AI 自动生成完整漫剧视频",icon:t.jsx(ThunderboltOutlined,{}),color:"#722ed1",tag:"热门",tagColor:"red",action:()=>e("/workflow"),hot:!0},{id:"2",type:"template",title:"情感故事模板",description:"温馨治愈的情感类漫剧模板",icon:t.jsx(HeartOutlined,{}),color:"#eb2f96",tag:"推荐",tagColor:"pink",action:()=>e("/workflow")},{id:"3",type:"tool",title:"AI 图像生成",description:"文生图、图生视频，多种风格可选",icon:t.jsx(FireOutlined,{}),color:"#fa8c16",tag:"新功能",tagColor:"green",action:()=>e("/workflow"),new:!0},{id:"4",type:"tool",title:"智能配音",description:"60+ 音色，支持方言和情感",icon:t.jsx(PlayCircleOutlined,{}),color:"#13c2c2",action:()=>e("/workflow")},{id:"5",type:"template",title:"悬疑推理模板",description:"紧张刺激的悬疑类漫剧模板",icon:t.jsx(StarOutlined,{}),color:"#1890ff",action:()=>e("/workflow")},{id:"6",type:"tip",title:"创作技巧",description:"如何让 AI 生成更优质的剧本",icon:t.jsx(BulbOutlined,{}),color:"#52c41a",tag:"技巧",tagColor:"blue",action:()=>{}}])(n)),[r]=e.useState(()=>(e=>[{id:"quick1",title:"新建漫剧",icon:t.jsx(ThunderboltOutlined,{}),color:"#722ed1",action:()=>e("/workflow")},{id:"quick2",title:"继续创作",icon:t.jsx(EditOutlined,{}),color:"#1890ff",action:()=>e("/projects")},{id:"quick3",title:"查看模板",icon:t.jsx(StarOutlined,{}),color:"#fa8c16",action:()=>e("/templates")},{id:"quick4",title:"使用指南",icon:t.jsx(BookOutlined,{}),color:"#52c41a",action:()=>{window.open("https://github.com/Agions/ManGaAI/blob/main/README.md","_blank")}}])(n)),[i,o]=e.useState(new Date);return e.useEffect(()=>{const e=setInterval(()=>{o(new Date)},6e4);return()=>clearInterval(e)},[]),t.jsxs("div",{className:"_container_eax58_1",children:[t.jsxs("div",{className:"_greeting_eax58_6",children:[t.jsxs(F,{level:3,className:"_greetingTitle_eax58_10",children:[(()=>{const e=i.getHours();return e<6?"夜深了":e<12?"早上好":e<14?"中午好":e<18?"下午好":"晚上好"})(),"，开始创作吧！"]}),t.jsxs(L,{type:"secondary",children:[t.jsx(ClockCircleOutlined,{})," ",i.toLocaleDateString("zh-CN")," "," ",i.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]})]}),t.jsxs(Card,{className:"_quickActions_eax58_13",bordered:!1,children:[t.jsx(F,{level:5,children:"快捷操作"}),t.jsx(Row,{gutter:[16,16],children:r.map(e=>t.jsx(Col,{xs:12,sm:6,children:t.jsxs(Button,{type:"default",className:"_quickButton_eax58_21",onClick:e.action,style:{borderColor:e.color,color:e.color},block:!0,children:[t.jsx("span",{style:{color:e.color},children:e.icon}),t.jsx("span",{children:e.title})]})},e.id))})]}),t.jsxs("div",{className:"_recommendations_eax58_40",children:[t.jsxs("div",{className:"_sectionHeader_eax58_43",children:[t.jsxs(F,{level:5,children:[t.jsx(FireOutlined,{style:{color:"#ff4d4f"}})," 为你推荐"]}),t.jsxs(Button,{type:"link",size:"small",children:["查看更多 ",t.jsx(RightOutlined,{})]})]}),t.jsx(Row,{gutter:[16,16],children:s.map(e=>t.jsx(Col,{xs:24,sm:12,lg:8,children:t.jsx(Card,{className:"_recommendCard_eax58_52",bordered:!1,hoverable:!0,onClick:e.action,children:t.jsxs("div",{className:"_cardContent_eax58_65",children:[t.jsx("div",{className:"_iconWrapper_eax58_70",style:{backgroundColor:`${e.color}15`,color:e.color},children:e.icon}),t.jsxs("div",{className:"_cardInfo_eax58_80",children:[t.jsxs("div",{className:"_cardHeader_eax58_84",children:[t.jsx(L,{strong:!0,className:"_cardTitle_eax58_91",children:e.title}),t.jsxs(Space,{size:4,children:[e.hot&&t.jsx(Badge,{count:"HOT",style:{backgroundColor:"#ff4d4f"}}),e.new&&t.jsx(Badge,{count:"NEW",style:{backgroundColor:"#52c41a"}}),e.tag&&t.jsx(Tag,{color:e.tagColor,style:{margin:0},children:e.tag})]})]}),t.jsx(L,{type:"secondary",className:"_cardDesc_eax58_94",children:e.description})]})]})})},e.id))})]}),t.jsx(Card,{className:"_statsCard_eax58_101",bordered:!1,children:t.jsxs(Row,{gutter:16,align:"middle",children:[t.jsx(Col,{flex:"auto",children:t.jsxs(Space,{direction:"vertical",size:0,children:[t.jsx(L,{type:"secondary",children:"本周创作"}),t.jsx(F,{level:4,style:{margin:0},children:"12 个项目"})]})}),t.jsx(Col,{children:t.jsxs(Space,{direction:"vertical",size:0,style:{textAlign:"right"},children:[t.jsx(L,{type:"secondary",children:"节省时长"}),t.jsx(F,{level:4,style:{margin:0,color:"#52c41a"},children:"48 小时"})]})}),t.jsx(Col,{children:t.jsx(Button,{type:"primary",icon:t.jsx(ThunderboltOutlined,{}),onClick:()=>n("/workflow"),children:"立即创作"})})]})})]})},q={container:"_container_27jar_1",header:"_header_27jar_8",projectsCard:"_projectsCard_27jar_29",projectsList:"_projectsList_27jar_47",projectCard:"_projectCard_27jar_50",projectInfo:"_projectInfo_27jar_78",projectMeta:"_projectMeta_27jar_89",projectDate:"_projectDate_27jar_97",anticon:"_anticon_27jar_103",errorContainer:"_errorContainer_27jar_108",footer:"_footer_27jar_118",banner:"_banner_27jar_143",slogan:"_slogan_27jar_151",float:"_float_27jar_1",fadeIn:"_fadeIn_27jar_1",actionButton:"_actionButton_27jar_278",features:"_features_27jar_289","ant-divider":"_ant-divider_27jar_292","ant-divider-inner-text":"_ant-divider-inner-text_27jar_296",modelIntro:"_modelIntro_27jar_300",modelCards:"_modelCards_27jar_308",configButton:"_configButton_27jar_319",secondaryButton:"_secondaryButton_27jar_329",modelConfigArea:"_modelConfigArea_27jar_341",statsCard:"_statsCard_27jar_348",statIcon:"_statIcon_27jar_358",featureCard:"_featureCard_27jar_362",featureIcon:"_featureIcon_27jar_373",featureTitle:"_featureTitle_27jar_380",featureDesc:"_featureDesc_27jar_384",cta:"_cta_27jar_388",ctaButton:"_ctaButton_27jar_402",workflow:"_workflow_27jar_419",steps:"_steps_27jar_422",stepCard:"_stepCard_27jar_425",stepNumber:"_stepNumber_27jar_443",hero:"_hero_27jar_454",heroContent:"_heroContent_27jar_483",title:"_title_27jar_487",highlight:"_highlight_27jar_496",subtitle:"_subtitle_27jar_500",stats:"_stats_27jar_348",modelCard:"_modelCard_27jar_308",selectedModel:"_selectedModel_27jar_520",modelIcon:"_modelIcon_27jar_534",modelInfo:"_modelInfo_27jar_548",modelName:"_modelName_27jar_552",modelProvider:"_modelProvider_27jar_557",modelSelected:"_modelSelected_27jar_561",modelAction:"_modelAction_27jar_569",modelDesc:"_modelDesc_27jar_577",shineButton:"_shineButton_27jar_580",shine:"_shine_27jar_580",pulse:"_pulse_27jar_1",aiModelSection:"_aiModelSection_27jar_634",heroButtons:"_heroButtons_27jar_667",heroTitle:"_heroTitle_27jar_838",heroIcon:"_heroIcon_27jar_844",heroHighlight:"_heroHighlight_27jar_848",heroDesc:"_heroDesc_27jar_853",heroActions:"_heroActions_27jar_859",heroButton:"_heroButton_27jar_667",heroImage:"_heroImage_27jar_874",statItem:"_statItem_27jar_908",sectionTitle:"_sectionTitle_27jar_920",featureRow:"_featureRow_27jar_934",projectsSection:"_projectsSection_27jar_980",sectionHeader:"_sectionHeader_27jar_986",sectionAction:"_sectionAction_27jar_992",projectCover:"_projectCover_27jar_1011",defaultCover:"_defaultCover_27jar_1025",projectType:"_projectType_27jar_1029",projectAvatar:"_projectAvatar_27jar_1038",projectDetails:"_projectDetails_27jar_1043",projectDuration:"_projectDuration_27jar_1055",emptyProjects:"_emptyProjects_27jar_1058",layout:"_layout_27jar_1154",welcomeCard:"_welcomeCard_27jar_1157",welcomeAvatar:"_welcomeAvatar_27jar_1164",greeting:"_greeting_27jar_1169",welcomeTitle:"_welcomeTitle_27jar_1174",welcomeText:"_welcomeText_27jar_1178",statistics:"_statistics_27jar_1182",statistic:"_statistic_27jar_1182",sectionCard:"_sectionCard_27jar_1199",projectTitle:"_projectTitle_27jar_1238",statusTag:"_statusTag_27jar_1244",featuresSection:"_featuresSection_27jar_1248",workflowSection:"_workflowSection_27jar_1290",workflowSteps:"_workflowSteps_27jar_1293",workflowCard:"_workflowCard_27jar_1312",stepIcon:"_stepIcon_27jar_1349",ctaSection:"_ctaSection_27jar_1355",ctaText:"_ctaText_27jar_1365",primaryButton:"_primaryButton_27jar_1396",darkCard:"_darkCard_27jar_1414",darkProjectCard:"_darkProjectCard_27jar_1422",darkFeatures:"_darkFeatures_27jar_1432",darkWorkflow:"_darkWorkflow_27jar_1433",darkCta:"_darkCta_27jar_1440"},{Title:W,Paragraph:V,Text:K}=p,U=()=>{const n=a(),[s,r]=e.useState(!0),[i,o]=e.useState([]),{isDarkMode:l}=E();(new Date).getHours(),e.useEffect(()=>{const e=setTimeout(()=>{o([{id:"1",name:"产品宣传视频",description:"公司新产品宣传短视频",createdAt:"2023-05-15T08:00:00.000Z",updatedAt:"2023-05-16T10:30:00.000Z",status:"completed",thumbnail:"https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png"},{id:"2",name:"社交媒体短视频",description:"抖音和小红书推广内容",createdAt:"2023-05-10T12:00:00.000Z",updatedAt:"2023-05-11T09:15:00.000Z",status:"draft",thumbnail:"https://gw.alipayobjects.com/zos/rmsportal/JiqGstEfoWAOHiTxclqi.png"},{id:"3",name:"教学视频系列",description:"软件使用教程系列视频",createdAt:"2023-05-05T15:45:00.000Z",updatedAt:"2023-05-08T14:20:00.000Z",status:"processing",thumbnail:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"}]),r(!1)},800);return()=>clearTimeout(e)},[]);const d=()=>{n("/project/new")};return t.jsxs("div",{className:q.container,children:[t.jsx(R,{}),t.jsx(Card,{className:`${q.hero} ${l?q.darkCard:""}`,bordered:!1,children:t.jsxs("div",{className:q.heroContent,children:[t.jsxs(W,{level:1,className:q.title,children:["ClipAiMan ",t.jsx("span",{className:q.highlight,children:"AI漫剧创作"})]}),t.jsx(V,{className:q.subtitle,children:"AI赋能的短视频创作工具，让视频制作更简单、更高效"}),t.jsxs("div",{className:q.heroButtons,children:[t.jsx(Button,{type:"primary",size:"large",icon:t.jsx(PlusOutlined,{}),onClick:d,className:`${q.primaryButton} ${q.shineButton}`,children:"创建新项目"}),t.jsx(Button,{size:"large",icon:t.jsx(PlayCircleOutlined,{}),onClick:()=>n("/editor"),className:q.secondaryButton,children:"进入工作台"})]})]})}),t.jsxs(Row,{gutter:[24,24],className:q.stats,children:[t.jsx(Col,{xs:24,sm:8,children:t.jsx(Card,{className:`${q.statsCard} ${l?q.darkCard:""}`,children:t.jsx(Statistic,{title:"项目总数",value:i.length,prefix:t.jsx(VideoCameraOutlined,{className:q.statIcon})})})}),t.jsx(Col,{xs:24,sm:8,children:t.jsx(Card,{className:`${q.statsCard} ${l?q.darkCard:""}`,children:t.jsx(Statistic,{title:"已完成项目",value:i.filter(e=>"completed"===e.status).length,prefix:t.jsx(StarOutlined,{className:q.statIcon})})})}),t.jsx(Col,{xs:24,sm:8,children:t.jsx(Card,{className:`${q.statsCard} ${l?q.darkCard:""}`,children:t.jsx(Statistic,{title:"处理中项目",value:i.filter(e=>"processing"===e.status).length,prefix:t.jsx(FireOutlined,{className:q.statIcon})})})})]}),t.jsx(Card,{title:t.jsxs("div",{className:q.sectionHeader,children:[t.jsxs(K,{strong:!0,style:{fontSize:18},children:[t.jsx(VideoCameraOutlined,{})," 我的项目"]}),t.jsx(Button,{type:"primary",icon:t.jsx(PlusOutlined,{}),onClick:d,children:"创建新项目"})]}),className:`${q.sectionCard} ${l?q.darkCard:""}`,bordered:!1,children:t.jsx(Spin,{spinning:s,children:0===i.length?t.jsx(Empty,{description:"暂无项目，点击「创建新项目」开始使用",image:m.PRESENTED_IMAGE_SIMPLE,children:t.jsx(Button,{type:"primary",icon:t.jsx(PlusOutlined,{}),onClick:d,children:"创建新项目"})}):t.jsx(List,{grid:{gutter:24,xs:1,sm:2,md:3,lg:4},dataSource:i,renderItem:e=>{return t.jsx(List.Item,{children:t.jsx(Card,{className:`${q.projectCard} ${l?q.darkProjectCard:""}`,hoverable:!0,onClick:()=>{return t=e.id,void n(`/project/${t}`);var t},cover:e.thumbnail&&t.jsx("div",{className:q.projectThumbnail,children:t.jsx("img",{alt:e.name,src:e.thumbnail,width:100,style:{width:150,height:150}})}),actions:[t.jsx(Button,{type:"text",icon:t.jsx(EditOutlined,{}),onClick:t=>((e,t)=>{t.stopPropagation(),n(`/project/edit/${e}`)})(e.id,t)},"edit"),t.jsx(Button,{type:"text",icon:t.jsx(VideoCameraOutlined,{}),onClick:t=>((e,t)=>{t.stopPropagation(),n(`/editor/${e}`)})(e.id,t)},"scissors"),t.jsx(Button,{type:"text",danger:!0,icon:t.jsx(DeleteOutlined,{}),onClick:t=>((e,t)=>{t.stopPropagation(),S.confirm({title:"确认删除",content:"删除后无法恢复，确定要删除此项目吗？",okText:"删除",okType:"danger",cancelText:"取消",onOk:()=>{o(i.filter(t=>t.id!==e)),h.success("项目已删除")}})})(e.id,t)},"delete")],children:t.jsx(Card.Meta,{title:t.jsxs("div",{className:q.projectTitle,children:[t.jsx("span",{children:e.name}),t.jsx(Tag,{color:"draft"===e.status?"blue":"processing"===e.status?"orange":"green",className:q.statusTag,children:"draft"===e.status?"草稿":"processing"===e.status?"处理中":"已完成"})]}),description:t.jsxs(t.Fragment,{children:[t.jsx(K,{ellipsis:!0,style:{marginBottom:8,display:"block"},children:e.description}),t.jsxs(K,{type:"secondary",style:{fontSize:12},children:["更新于: ",(a=e.updatedAt,new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}))]})]})})})});var a}})})}),t.jsxs("div",{className:q.features,children:[t.jsxs(W,{level:3,className:q.sectionTitle,children:[t.jsx(RocketOutlined,{})," 强大功能"]}),t.jsxs(Row,{gutter:[24,24],children:[t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.featureCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.featureIcon,style:{color:"#1890ff",fontSize:36},children:t.jsx(ThunderboltOutlined,{})}),t.jsx(W,{level:4,className:q.featureTitle,children:"智能分析"}),t.jsx(V,{className:q.featureDesc,children:"基于AI技术分析视频内容，智能识别关键场景和情感变化"})]})}),t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.featureCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.featureIcon,style:{color:"#722ed1",fontSize:36},children:t.jsx(CodeOutlined,{})}),t.jsx(W,{level:4,className:q.featureTitle,children:"脚本生成"}),t.jsx(V,{className:q.featureDesc,children:"自动生成专业短视频脚本，支持多种风格和平台定制"})]})}),t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.featureCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.featureIcon,style:{color:"#13c2c2",fontSize:36},children:t.jsx(CloudOutlined,{})}),t.jsx(W,{level:4,className:q.featureTitle,children:"一键剪辑"}),t.jsx(V,{className:q.featureDesc,children:"根据脚本一键生成精美短视频，无需复杂操作"})]})}),t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.featureCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.featureIcon,style:{color:"#fa8c16",fontSize:36},children:t.jsx(BulbOutlined,{})}),t.jsx(W,{level:4,className:q.featureTitle,children:"创意辅助"}),t.jsx(V,{className:q.featureDesc,children:"AI提供创意建议和创作灵感，帮助提升内容质量"})]})})]})]}),t.jsxs("div",{className:q.workflow,children:[t.jsxs(W,{level:3,className:q.sectionTitle,children:[t.jsx(FireOutlined,{})," 使用流程"]}),t.jsx("div",{className:q.steps,children:t.jsxs(Row,{gutter:[24,24],children:[t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.stepCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.stepNumber,children:"1"}),t.jsx("div",{className:q.stepIcon,style:{fontSize:32},children:t.jsx(CameraOutlined,{})}),t.jsx(W,{level:4,children:"上传视频"}),t.jsx(V,{children:"上传您的原始视频素材"})]})}),t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.stepCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.stepNumber,children:"2"}),t.jsx("div",{className:q.stepIcon,style:{fontSize:32},children:t.jsx(ThunderboltOutlined,{})}),t.jsx(W,{level:4,children:"AI分析"}),t.jsx(V,{children:"智能分析视频内容和结构"})]})}),t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.stepCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.stepNumber,children:"3"}),t.jsx("div",{className:q.stepIcon,style:{fontSize:32},children:t.jsx(CodeOutlined,{})}),t.jsx(W,{level:4,children:"自动生成脚本"}),t.jsx(V,{children:"基于分析生成专业短视频脚本"})]})}),t.jsx(Col,{xs:24,sm:12,md:6,children:t.jsxs(Card,{className:`${q.stepCard} ${l?q.darkCard:""}`,bordered:!1,children:[t.jsx("div",{className:q.stepNumber,children:"4"}),t.jsx("div",{className:q.stepIcon,style:{fontSize:32},children:t.jsx(ToolOutlined,{})}),t.jsx(W,{level:4,children:"智能剪辑"}),t.jsx(V,{children:"一键生成精美短视频成品"})]})})]})})]}),t.jsxs(Card,{className:`${q.cta} ${l?q.darkCta:""}`,bordered:!1,children:[t.jsx(W,{level:3,children:"准备好开始创作了吗？"}),t.jsx(V,{className:q.ctaText,children:"使用ClipAiMan，让AI为您的创作提供灵感和效率"}),t.jsx(Button,{type:"primary",size:"large",icon:t.jsx(PlusOutlined,{}),onClick:d,className:q.ctaButton,children:"立即创建项目"})]}),t.jsxs("div",{className:q.footer,children:[t.jsx(Divider,{}),t.jsxs(Space,{split:t.jsx(Divider,{type:"vertical"}),children:[t.jsx(K,{type:"secondary",children:"© 2025 ClipAiMan"}),t.jsx(K,{type:"secondary",children:"基于 Tauri 和 React 构建"}),t.jsx("a",{href:"https://github.com/agions/blazecut",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]})]})]})};function H(e,t=!1){const a=window.crypto.getRandomValues(new Uint32Array(1))[0],n=`_${a}`;return Object.defineProperty(window,n,{value:a=>(t&&Reflect.deleteProperty(window,n),null==e?void 0:e(a)),writable:!1,configurable:!0}),a}async function J(e,t={}){return new Promise((a,n)=>{const s=H(e=>{a(e),Reflect.deleteProperty(window,`_${r}`)},!0),r=H(e=>{n(e),Reflect.deleteProperty(window,`_${s}`)},!0);window.__TAURI_IPC__({cmd:e,callback:s,error:r,...t})})}function G(e,t="asset"){return window.__TAURI__.convertFileSrc(e,t)}async function X(e){return J("tauri",e)}async function Y(e={}){return"object"==typeof e&&Object.freeze(e),X({__tauriModule:"Dialog",message:{cmd:"openDialog",options:e}})}async function Q(e={}){return"object"==typeof e&&Object.freeze(e),X({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:e}})}const Z=async()=>{const{installed:e,version:t}=await(async()=>{try{return await J("check_ffmpeg")}catch(e){return{installed:!1}}})();return!!e||(h.error("操作失败：未检测到FFmpeg，请先安装FFmpeg后再试"),!1)},ee=async e=>{try{if(!e)throw new Error("视频路径不能为空");if(!(await Z()))throw new Error("未安装FFmpeg");return await J("analyze_video",{path:e})}catch(t){let e="视频分析失败，请稍后再试";const a=t instanceof Error?t.message:String(t);throw a.includes("未安装FFmpeg")?e="分析失败：未检测到 FFmpeg，请确保已正确安装并配置到系统 PATH。":a.includes("运行ffprobe失败")?e="分析失败：无法执行 ffprobe 命令，请检查 FFmpeg 是否完整安装。":a.includes("ffprobe命令执行失败")?e="分析失败：ffprobe 执行出错，可能是视频文件损坏或格式不支持。":a.includes("解析JSON失败")?e="分析失败：无法解析视频元数据。":a.includes("无法获取视频流信息")||a.includes("未找到视频流")?e="分析失败：无法识别视频流信息。":a.includes("路径不能为空")&&(e="错误：视频路径无效。"),h.error(e),new Error(e)}},te=async(e,t={})=>{try{if(!e)throw new Error("视频路径不能为空");if(!(await Z()))throw new Error("未安装FFmpeg");const{interval:a=10,maxFrames:n=10}=t;return(await J("extract_key_frames",{path:e,count:n})).map((e,t)=>({id:C(),timestamp:t*a,path:e,description:""}))}catch(a){let e="提取关键帧失败，请确保视频文件可访问且FFmpeg已安装";throw(a instanceof Error?a.message:String(a)).includes("未安装FFmpeg")&&(e="提取关键帧失败：未检测到 FFmpeg，请确保已正确安装并配置到系统 PATH。"),h.error(e),a}},ae=e=>{const t=Math.floor(e/3600),a=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},ne=({initialVideoPath:a,onVideoSelect:n,onVideoRemove:s,loading:r=!1})=>{const[i,o]=e.useState(a||null),[l,d]=e.useState(a?G(a):null),[c,u]=e.useState(null),[p,m]=e.useState(!1);return t.jsx("div",{className:"_videoSelector_1l5tx_1",children:t.jsx(Spin,{spinning:r||p,tip:p?"分析视频中...":"加载中...",children:i?t.jsxs("div",{className:"_videoPreviewContainer_1l5tx_39",children:[t.jsx("div",{className:"_videoPreview_1l5tx_39",children:t.jsx("video",{src:l||void 0,controls:!0,className:"_videoPlayer_1l5tx_58"})}),c&&t.jsxs(Card,{className:"_metadataCard_1l5tx_66",size:"small",title:"视频信息",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"文件名:"})," ",i.split("/").pop()]}),t.jsxs("p",{children:[t.jsx("strong",{children:"时长:"})," ",ae(c.duration)]}),t.jsxs("p",{children:[t.jsx("strong",{children:"分辨率:"})," ",(g=c.width,y=c.height,3840===g&&2160===y?`${g}x${y} (4K UHD)`:2560===g&&1440===y?`${g}x${y} (2K QHD)`:1920===g&&1080===y?`${g}x${y} (1080p)`:1280===g&&720===y?`${g}x${y} (720p)`:720===g&&480===y?`${g}x${y} (480p)`:`${g}x${y}`)]}),t.jsxs("p",{children:[t.jsx("strong",{children:"帧率:"})," ",c.fps," fps"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"编码:"})," ",c.codec]})]}),t.jsx("div",{className:"_videoActions_1l5tx_88",children:t.jsxs(Space,{children:[t.jsx(Button,{icon:t.jsx(DeleteOutlined,{}),onClick:()=>{o(null),d(null),u(null),s&&s()},danger:!0,children:"移除"}),t.jsx(Button,{icon:t.jsx(PlayCircleOutlined,{}),onClick:async()=>{if(i)try{await J("open_file",{path:i})}catch(e){h.error("无法打开视频，请确保系统有关联的视频播放器")}},type:"primary",children:"在播放器中打开"})]})})]}):t.jsxs("div",{className:"_uploadArea_1l5tx_6",onClick:async()=>{try{const t=await Y({multiple:!1,filters:[{name:"视频文件",extensions:["mp4","mov","avi","mkv","wmv","flv"]}]});if(!t||Array.isArray(t))return;const a=t;o(a),d(G(a)),m(!0);try{const e=await ee(a);u(e),n(a,e)}catch(e){n(a)}finally{m(!1)}}catch(e){h.error("选择视频失败，请重试")}},children:[t.jsx(UploadOutlined,{className:"_uploadIcon_1l5tx_30"}),t.jsx("p",{children:"点击选择视频文件"}),t.jsx("p",{className:"_uploadTip_1l5tx_25",children:"支持 MP4, MOV, AVI 等格式"})]})})});var g,y},se=({videoPath:a,initialSegments:n=[],onSave:s,onExport:r,script:i,metadata:o,onScriptUpdate:l})=>{const[d,c]=e.useState(n),[u,p]=e.useState(null),[m]=b.useForm(),[g,y]=e.useState(!1),[x,j]=e.useState(""),[f,_]=e.useState(!1),[v,w]=e.useState(!1),[C,N]=e.useState(!1),[k,I]=e.useState(0);e.useEffect(()=>{const e=d.reduce((e,t)=>e+(t.end-t.start),0);I(e)},[d]);const T=()=>{const e=d.length>0?d[d.length-1]:null,t=e?e.end:0,a=t+30;m.setFieldsValue({start:t,end:a,type:"narration",content:""}),p(d.length)},A=[{title:"时间",key:"time",width:180,render:(e,a,n)=>t.jsxs("span",{children:[ae(a.start)," - ",ae(a.end)]})},{title:"时长",dataIndex:"duration",key:"duration",width:80,render:(e,a)=>t.jsx("span",{children:ae(a.end-a.start)})},{title:"类型",dataIndex:"type",key:"type",width:100,render:e=>t.jsx("span",{children:"narration"===e?"旁白":"dialogue"===e?"对白":"action"===e?"动作":"transition"===e?"转场":e})},{title:"内容",dataIndex:"content",key:"content",render:e=>t.jsx("div",{className:"_contentCell_13vaw_103",children:e||t.jsx("span",{className:"_emptyContent_13vaw_108",children:"（无内容）"})})},{title:"操作",key:"action",width:180,render:(e,n,s)=>t.jsxs(Space,{size:"small",children:[t.jsx(Tooltip,{title:"编辑",children:t.jsx(Button,{type:"text",icon:t.jsx(EditOutlined,{}),onClick:()=>(e=>{const t=d[e];m.setFieldsValue({start:t.start,end:t.end,type:t.type||"narration",content:t.content||""}),p(e)})(s)})}),t.jsx(Tooltip,{title:"预览",children:t.jsx(Button,{type:"text",icon:t.jsx(PlayCircleOutlined,{}),onClick:()=>(async e=>{try{_(!0);const t=d[e],n=await(async(e,t,a)=>{try{if(!(await Z()))throw new Error("未安装FFmpeg");return await J("generate_preview",{input_path:e,segment:t,transition:a?.transition,transition_duration:a?.transitionDuration,volume:a?.volume,add_subtitles:a?.addSubtitles})}catch(n){let e="生成预览失败";throw(n instanceof Error?n.message:String(n)).includes("未安装FFmpeg")&&(e="预览失败：未检测到 FFmpeg，请确保已正确安装并配置到系统 PATH。"),h.error(e),new Error(e)}})(a,t);j(G(n)),y(!0)}catch(t){h.error("生成预览失败")}finally{_(!1)}})(s)})}),t.jsx(Tooltip,{title:"删除",children:t.jsx(Button,{type:"text",danger:!0,icon:t.jsx(DeleteOutlined,{}),onClick:()=>(e=>{S.confirm({title:"确认删除",content:"确定要删除这个片段吗？",onOk:()=>{const t=[...d];t.splice(e,1),c(t)}})})(s)})})]})}];return t.jsxs("div",{className:"_scriptEditor_13vaw_83",children:[t.jsxs(Card,{title:"脚本编辑",className:"_editorCard_13vaw_86",extra:t.jsxs(Space,{children:[t.jsx(Button,{icon:t.jsx(EditOutlined,{}),onClick:()=>{w(!0)},children:"AI优化"}),t.jsx(Button,{type:"primary",icon:t.jsx(SaveOutlined,{}),onClick:()=>s(d),children:"保存"}),r&&t.jsx(Dropdown,{overlay:t.jsxs(Menu,{onClick:({key:e})=>r(e),children:[t.jsx(Menu.Item,{children:"文本文件 (.txt)"},"txt"),t.jsx(Menu.Item,{children:"字幕文件 (.srt)"},"srt"),t.jsx(Menu.Item,{children:"Word文档 (.docx)"},"doc")]}),visible:C,onVisibleChange:N,children:t.jsxs(Button,{icon:t.jsx(ExportOutlined,{}),onClick:()=>{N(!0)},children:["导出 ",t.jsx(DownOutlined,{})]})})]}),children:[t.jsxs("div",{className:"_statsBar_13vaw_90",children:[t.jsxs("div",{children:["总片段: ",d.length]}),t.jsxs("div",{children:["总时长: ",ae(k)]})]}),t.jsx(Table,{rowKey:(e,t)=>String(t),dataSource:d,columns:A,pagination:!1,className:"_segmentsTable_13vaw_97",footer:()=>t.jsx(Button,{type:"dashed",icon:t.jsx(PlusOutlined,{}),block:!0,onClick:T,children:"添加片段"})}),null!==u&&t.jsx("div",{className:"_editForm_13vaw_112",children:t.jsx(Card,{title:`编辑片段 #${u+1}`,className:"_editCard_13vaw_115",children:t.jsxs(Form,{form:m,layout:"vertical",children:[t.jsxs("div",{className:"_timeInputs_13vaw_119",children:[t.jsx(Form.Item,{name:"start",label:"开始时间 (秒)",rules:[{required:!0,message:"请输入开始时间"}],children:t.jsx(Input,{type:"number",step:"0.1",min:"0"})}),t.jsx(Form.Item,{name:"end",label:"结束时间 (秒)",rules:[{required:!0,message:"请输入结束时间"},({getFieldValue:e})=>({validator:(t,a)=>a>e("start")?Promise.resolve():Promise.reject(new Error("结束时间必须大于开始时间"))})],children:t.jsx(Input,{type:"number",step:"0.1",min:"0"})})]}),t.jsx(Form.Item,{name:"type",label:"类型",rules:[{required:!0,message:"请选择类型"}],children:t.jsxs(Select,{children:[t.jsx(Select.Option,{value:"narration",children:"旁白"}),t.jsx(Select.Option,{value:"dialogue",children:"对白"}),t.jsx(Select.Option,{value:"action",children:"动作"}),t.jsx(Select.Option,{value:"transition",children:"转场"})]})}),t.jsx(Form.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入内容"}],children:t.jsx(Input.TextArea,{rows:4})}),t.jsx("div",{className:"_formActions_13vaw_126",children:t.jsxs(Space,{children:[t.jsx(Button,{onClick:()=>{p(null),m.resetFields()},children:"取消"}),t.jsx(Button,{type:"primary",onClick:()=>{m.validateFields().then(e=>{const t=parseFloat(e.start),a=parseFloat(e.end),n=[...d],s={start:t,end:a,type:e.type,content:e.content};null!==u&&(u<d.length?n[u]=s:n.push(s)),c(n),p(null),m.resetFields()})},children:"保存"})]})})]})})})]}),t.jsx(Modal,{title:"预览片段",visible:g,onCancel:()=>y(!1),footer:null,width:700,destroyOnClose:!0,children:t.jsx("div",{className:"_previewContainer_13vaw_131",children:f?t.jsx("div",{className:"_previewLoading_13vaw_145",children:t.jsx("p",{children:"正在生成预览..."})}):t.jsx("video",{src:x,controls:!0,autoPlay:!0,className:"_previewVideo_13vaw_140"})})}),t.jsxs(Modal,{title:"AI 优化脚本",visible:v,onCancel:()=>w(!1),onOk:async()=>{try{h.info("正在使用 AI 优化脚本..."),w(!1),setTimeout(()=>{h.success("脚本优化完成")},2e3)}catch(e){h.error("AI 优化脚本失败")}},children:[t.jsx("p",{children:"使用 AI 优化脚本将会根据视频内容和当前脚本，生成更加专业的表达和结构。"}),t.jsx("p",{children:"点击确定开始优化。"})]})]})};var re;async function ie(e,t={}){return X({__tauriModule:"Fs",message:{cmd:"readTextFile",path:e,options:t}})}async function oe(e,t,a){"object"==typeof a&&Object.freeze(a),"object"==typeof e&&Object.freeze(e);const n={path:"",contents:""};let s=a;return"string"==typeof e?n.path=e:(n.path=e.path,n.contents=e.contents),"string"==typeof t?n.contents=null!=t?t:"":s=t,X({__tauriModule:"Fs",message:{cmd:"writeFile",path:n.path,contents:Array.from((new TextEncoder).encode(n.contents)),options:s}})}async function le(e,t={}){return X({__tauriModule:"Fs",message:{cmd:"createDir",path:e,options:t}})}async function de(e,t={}){return X({__tauriModule:"Fs",message:{cmd:"exists",path:e,options:t}})}function ce(){return navigator.appVersion.includes("Win")}!function(e){e[e.Audio=1]="Audio",e[e.Cache=2]="Cache",e[e.Config=3]="Config",e[e.Data=4]="Data",e[e.LocalData=5]="LocalData",e[e.Desktop=6]="Desktop",e[e.Document=7]="Document",e[e.Download=8]="Download",e[e.Executable=9]="Executable",e[e.Font=10]="Font",e[e.Home=11]="Home",e[e.Picture=12]="Picture",e[e.Public=13]="Public",e[e.Runtime=14]="Runtime",e[e.Template=15]="Template",e[e.Video=16]="Video",e[e.Resource=17]="Resource",e[e.App=18]="App",e[e.Log=19]="Log",e[e.Temp=20]="Temp",e[e.AppConfig=21]="AppConfig",e[e.AppData=22]="AppData",e[e.AppLocalData=23]="AppLocalData",e[e.AppCache=24]="AppCache",e[e.AppLog=25]="AppLog"}(re||(re={})),ce(),ce();const ue=async(e,t)=>{if(!t||!e)throw new Error("无效的项目数据");try{await(async()=>{try{const s="blazecut";try{return void(await J("check_app_data_directory"))}catch(e){}let r=!1;try{r=await de(s,{dir:re.AppData})}catch(t){throw new Error(`检查目录出错: ${t instanceof Error?t.message:"未知错误"}`)}if(!r){try{await le(s,{dir:re.AppData,recursive:!0})}catch(a){throw new Error(`创建目录失败: ${a instanceof Error?a.message:"未知错误"}`)}try{if(!(await de(s,{dir:re.AppData})))throw new Error("无法创建应用数据目录，请检查权限")}catch(n){throw new Error(`验证目录出错: ${n instanceof Error?n.message:"未知错误"}`)}}return}catch(s){throw h.error("创建应用数据目录失败，请检查权限设置"),s}})().catch(e=>{throw new Error(`应用数据目录错误: ${e.message||"未知错误"}`)});const o=`blazecut/${e}.json`;let l;try{const e={...t};if(e.aiModel&&e.aiModel.apiKey&&(e.aiModel={...e.aiModel,apiKey:void 0}),l=JSON.stringify(e,null,2),!l)throw new Error("项目数据序列化为空")}catch(a){throw new Error("无法序列化项目数据")}try{return void(await J("save_project_file",{projectId:e,content:l}))}catch(n){}await de(o,{dir:re.AppData}).catch(e=>!1);try{await oe(o,l,{dir:re.AppData})}catch(s){try{const t=`${await he()}${e}.json`;return void(await oe(t,l))}catch(r){throw new Error(`文件写入失败: ${s?.message||"未知错误"}`)}}try{if(!(await de(o,{dir:re.AppData})))throw new Error("文件似乎已写入但无法验证其存在")}catch(i){throw new Error(`无法验证文件是否保存成功: ${i?.message||"未知错误"}`)}return}catch(o){const e=o instanceof Error?o.message:"未知错误";throw h.error(`保存项目文件失败: ${e}`),o}},pe=async(e,t)=>{try{const a=await Q({defaultPath:t,filters:[{name:"文本文件",extensions:["txt"]}]});if(!a)return;let n="";n+=`项目: ${e.projectName}\n`,n+=`创建时间: ${new Date(e.createdAt).toLocaleString()}\n\n`,e.segments.forEach(e=>{n+=`[${me(e.startTime)} - ${me(e.endTime)}]\n`,n+=`${e.content}\n\n`}),await oe(a,n),h.success("脚本已导出")}catch(a){throw h.error("导出脚本失败"),a}},me=e=>{const t=Math.floor(e/60),a=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},he=async()=>{try{const e=await async function(){return X({__tauriModule:"Path",message:{cmd:"resolvePath",path:"",directory:re.AppConfig}})}();return await de(e)||await le(e,{recursive:!0}),e}catch(e){return""}},ge=async e=>{try{const t=await he();if(!t)return"";const a=`${t}api_keys.json`;if(!(await de(a)))return await oe(a,JSON.stringify({})),"";const n=await ie(a);return JSON.parse(n)[e]||""}catch(t){return""}};class ye extends Error{constructor(e,t){super(e),this.statusCode=t,this.name="AIServiceError"}}const xe=e=>{const t=Math.floor(e/60),a=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},je=(e,t)=>{const{keyMoments:a,emotions:n,summary:s}=e,r=a.map(e=>`时间点: ${Math.floor(e.timestamp/60)}分${e.timestamp%60}秒, 描述: ${e.description}, 重要性: ${e.importance}/10`).join("\n"),i=n.map(e=>`时间点: ${Math.floor(e.timestamp/60)}分${e.timestamp%60}秒, 情感: ${e.type}, 强度: ${e.intensity}`).join("\n");let o="请生成一个专业、信息丰富的解说脚本",l="使用中立、专业的语气";return t&&("informative"===t.style?o="请生成一个客观、教育性、详细的信息型解说脚本":"entertaining"===t.style?o="请生成一个活泼、风趣、吸引人的娱乐型解说脚本":"dramatic"===t.style?o="请生成一个情感丰富、紧张、引人入胜的戏剧型解说脚本":"casual"===t.style&&(o="请生成一个轻松、对话式、自然的随意型解说脚本"),"neutral"===t.tone?l="使用中立、专业的语气":"enthusiastic"===t.tone?l="使用热情、充满活力的语气":"serious"===t.tone?l="使用严肃、庄重的语气":"humorous"===t.tone?l="使用幽默、诙谐的语气":"inspirational"===t.tone&&(l="使用励志、鼓舞人心的语气")),`请根据以下视频分析信息，为我创建一个视频解说脚本。\n\n视频摘要:\n${s}\n\n关键时刻:\n${r}\n\n情感标记:\n${i}\n\n要求:\n1. ${o}\n2. ${l}\n3. 每个段落应包含时间戳，格式为 [分:秒]\n4. 脚本应当分段呈现，每段对应视频中的一个场景或主题\n5. 脚本总长度应当适合视频时长，保持流畅自然\n6. 请确保脚本语言生动，能够吸引观众注意力\n\n请直接返回分段的脚本内容，不要包含其他解释。每个段落前使用时间戳标记，例如 [00:10]。\n`},fe={wenxinGenerateScript:async(e,t,a)=>{try{const n=je(t,a);return(await N.post("https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions_pro?access_token="+e,{messages:[{role:"user",content:n}]},{headers:{"Content-Type":"application/json"}})).data.result}catch(n){throw new ye(n.response?.data?.error_msg||"文心一言API调用失败",n.response?.status)}},qianwenGenerateScript:async(e,t,a)=>{try{const n=je(t,a);return(await N.post("https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation",{model:"qwen-plus",input:{prompt:n},parameters:{}},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).data.output.text}catch(n){throw new ye(n.response?.data?.message||"通义千问API调用失败",n.response?.status)}},sparkGenerateScript:async(e,t,a)=>{try{const n=je(t,a),s=await N.post("https://spark-api.xf-yun.com/v2.1/chat",{header:{app_id:a?.appId||"",uid:"blazecut_user"},parameter:{chat:{domain:"general",temperature:.7,max_tokens:4096}},payload:{message:{text:[{role:"user",content:n}]}}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(0!==s.data.header.code)throw new ye(`讯飞星火API错误: ${s.data.header.message}`);return s.data.payload.choices[0].text}catch(n){throw new ye(n.response?.data?.header?.message||"讯飞星火API调用失败",n.response?.status)}},chatglmGenerateScript:async(e,t,a)=>{try{const n=je(t,a);return(await N.post("https://open.bigmodel.cn/api/paas/v4/chat/completions",{model:"glm-4",messages:[{role:"user",content:n}],temperature:.7,max_tokens:4096},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})).data.choices[0].content}catch(n){throw new ye(n.response?.data?.error?.message||"智谱清言API调用失败",n.response?.status)}},doubaoGenerateScript:async(e,t,a)=>{try{const n=je(t,a);return(await N.post("https://api.doubao.com/v1/chat/completions",{model:"doubao-pro",messages:[{role:"user",content:n}],temperature:.7,max_tokens:4096},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}})).data.output.text}catch(n){throw new ye(n.response?.data?.error?.message||"字节豆包API调用失败",n.response?.status)}},deepseekGenerateScript:async(e,t,a)=>{try{const n=je(t,a),s=await N.post("https://api.deepseek.com/v1/chat/completions",{model:"deepseek-chat",messages:[{role:"user",content:n}],temperature:.7,max_tokens:4e3},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!s.data.choices||!s.data.choices.length)throw new ye("DeepSeek API返回的数据格式不正确");return s.data.choices[0].message.content}catch(n){throw new ye(n.response?.data?.error?.message||"DeepSeek API调用失败",n.response?.status)}},generateScript:async(e,t,a,n)=>{switch(e){case"wenxin":return fe.wenxinGenerateScript(t,a,n);case"qianwen":return fe.qianwenGenerateScript(t,a,n);case"spark":return fe.sparkGenerateScript(t,a,n);case"chatglm":return fe.chatglmGenerateScript(t,a,n);case"doubao":return fe.doubaoGenerateScript(t,a,n);case"deepseek":return fe.deepseekGenerateScript(t,a,n);default:throw new ye(`不支持的模型类型: ${e}`)}},buildPrompt:(e,t={})=>{const{title:a,duration:n,keyMoments:s,emotions:r,summary:i}=e;let o=`\n请为以下视频编写一段高质量的解说脚本:\n\n标题: ${a}\n时长: ${n}秒 (约${Math.round(n/60)}分钟)\n视频概述: ${i}\n\n关键时刻:\n`;return s&&s.length>0&&s.forEach((e,t)=>{o+=`[${xe(e.timestamp)}] ${e.description}\n`}),r&&r.length>0&&(o+="\n情感变化:\n",r.forEach((e,t)=>{o+=`[${xe(e.timestamp)}] ${e.type} (强度: ${e.intensity.toFixed(1)})\n`})),o+="\n请根据以上信息，生成一个完整的视频解说脚本。脚本应包括以下特点:\n1. 引人入胜的开场白，吸引观众注意\n2. 按时间顺序涵盖所有关键时刻\n3. 适当的情感表达\n4. 流畅的叙事结构\n5. 清晰的总结收尾\n\n脚本格式要求:\n- 每个段落应包含时间戳，内容和类型\n- 时间戳格式: [MM:SS]\n- 类型分为: 旁白、对话或描述\n",t.tone&&(o+=`\n请使用${t.tone}的语气。`),t.style&&(o+=`\n脚本风格应该是${t.style}。`),t.targetAudience&&(o+=`\n目标受众是${t.targetAudience}。`),o},parseScriptContent:e=>{const t=e.split("\n"),a=[],n=/\[(\d{1,2}):(\d{2})(?::(\d{2}))?\]/;let s="",r=0,i=0,o="narration",l=!1;const d=()=>{l&&s&&(a.push({id:C(),startTime:r,endTime:i,content:s,type:o}),s="",l=!1)};for(const c of t){const e=c.trim();if(!e)continue;const t=e.match(n);if(t){d();const a=parseInt(t[1],10),c=parseInt(t[2],10),u=3600*(t[3]?parseInt(t[3],10):0)+60*a+c,p=e.replace(n,"").trim();r=u,i=u+10,s=p,l=!0,o=p.includes("旁白")||p.toLowerCase().includes("narration")?"narration":p.includes("对话")||p.toLowerCase().includes("dialogue")?"dialogue":p.includes("描述")||p.toLowerCase().includes("description")?"description":"narration"}else l&&(s+=" "+e,i+=2)}return d(),a}},_e="_stepCard_bdxvu_26",ve="_stepActions_bdxvu_37",{Title:we,Paragraph:Se}=p,be=()=>{const{projectId:n}=s(),r=a(),[i]=b.useForm(),[o,l]=e.useState(0),[d,c]=e.useState(!1),[u,p]=e.useState(!1),[m,g]=e.useState(null),[y,x]=e.useState(!1),[j,f]=e.useState(""),[_,v]=e.useState(null),[w,S]=e.useState([]),[N,k]=e.useState([]),[I,T]=e.useState(!0),[A,O]=e.useState(!1),[E,P]=e.useState(null);e.useEffect(()=>{n&&(O(!0),T(!1),(async e=>{try{const t=`blazecut/${e}.json`;if(!(await de(t,{dir:re.AppData})))throw new Error("项目文件不存在");const a=await ie(t,{dir:re.AppData});return JSON.parse(a)}catch(E){throw E}})(n).then(e=>{g(e),i.setFieldsValue({name:e.name,description:e.description}),e.videoPath&&(f(e.videoPath),x(!0)),e.metadata&&v(e.metadata),e.keyFrames&&e.keyFrames.length>0&&S(e.keyFrames),e.script&&e.script.length>0?(k(e.script),l(2)):e.videoPath&&l(1),P(null)}).catch(e=>{P("加载项目失败，请确认项目文件是否存在"),h.error("加载项目失败")}).finally(()=>{O(!1)}))},[n,i]);const $=(e,t)=>{f(e),x(!0),t&&v(t),0===o&&l(1)},D=()=>{f(""),x(!1),v(null),S([]),k([])},M=async()=>{if(j)try{c(!0),h.info("正在分析视频，请稍候...");let e=_;e||(e=await ee(j),v(e)),h.info("正在提取关键帧...");const t=await te(j);S(t),h.info("正在分析关键帧内容...");const a=await(async e=>{try{return e.map((e,t)=>`关键帧 ${t+1} 中的场景描述`)}catch(E){return h.error("分析关键帧内容失败，将使用默认描述"),e.map((e,t)=>`关键帧 ${t+1}`)}})(t);h.info("正在根据视频内容生成脚本...");const n=await(async(e,t,a)=>{try{const n=await ge("openai");if(!n)throw h.error("未配置OpenAI API密钥，请先在设置中配置"),new Error("未配置API密钥");const s=function(e,t,a){const n=t.map((e,t)=>`关键帧${t+1}: ${e}`).join("\n"),s={short:"短剧本(1-2分钟)",medium:"中等长度剧本(2-5分钟)",long:"长剧本(5-10分钟)"}[a.length||"medium"];return`\n请为以下视频内容创建一个引人入胜的短剧本:\n\n视频信息:\n- 时长: ${e.duration}秒\n- 分辨率: ${e.width}x${e.height}\n- 帧率: ${e.fps}fps\n\n关键视觉内容:\n${n}\n\n生成要求:\n- 风格: ${a.style||"自然流畅"}\n- 语气: ${a.tone||"专业"}\n- 长度: ${s}\n- 目的: ${a.purpose||"内容展示"}\n- 目标受众: ${a.targetAudience||"普通观众"}\n${a.additionalRequirements?`- 额外要求: ${a.additionalRequirements}`:""}\n\n请生成一个按时间轴组织的剧本，每个片段包含开始时间、结束时间和对应的文本内容。\n剧本应该与视频内容高度契合，并确保整体叙事连贯、有吸引力。\n`}(e,t,a),r=await async function(e,t){try{const a=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-4o",messages:[{role:"system",content:"你是一位专业的视频脚本撰写助手，善于根据视频内容创作引人入胜的短视频脚本。"},{role:"user",content:e}],temperature:.7,max_tokens:2e3})});if(!a.ok){const e=await a.json();throw new Error(`API请求失败: ${e.error?.message||a.statusText}`)}const n=await a.json();return{text:n.choices[0].message.content,usage:n.usage}}catch(E){throw E}}(s,n);return r.text}catch(E){const t=E instanceof Error?E.message:String(E);let a="脚本生成失败";throw t.includes("API密钥")?a="请检查API密钥是否正确":t.includes("网络")&&(a="网络连接失败，请检查网络设置"),h.error(a),new Error(a)}})(e,a,{style:"自然流畅",tone:"专业",length:"medium",purpose:"内容展示"}),s=z(n);k(s),h.success("视频分析完成"),l(2)}catch(e){h.error("视频分析失败，请稍后再试")}finally{c(!1)}else h.error("请先选择视频")},z=e=>{try{const t=e.split("\n").filter(e=>e.trim().length>0),a=[];let n=null;for(const e of t){const t=e.match(/\[(\d{1,2}:\d{2}(?::\d{2})?) - (\d{1,2}:\d{2}(?::\d{2})?)\]/);if(t){const s=B(t[1]);n={start:s,end:B(t[2]),type:"narration",content:e.substring(t[0].length).trim()},a.push(n)}else n&&(n.content+="\n"+e.trim())}return a}catch(t){return[]}},B=e=>{const t=e.split(":").map(Number);return 3===t.length?3600*t[0]+60*t[1]+t[2]:2===t.length?60*t[0]+t[1]:0},F=async()=>{try{if(await i.validateFields(),!j)return void h.error("请先选择视频文件");p(!0);const e=i.getFieldsValue(),t=(new Date).toISOString(),a={id:m?.id||C(),name:e.name,description:e.description,videoPath:j,createdAt:m?.createdAt||t,updatedAt:t,metadata:_||void 0,keyFrames:w.length>0?w:void 0,script:N.length>0?N:void 0};await ue(a.id,a),h.success("项目保存成功"),g(a),I&&r(`/project/${a.id}`)}catch(e){h.error("保存项目失败，请稍后再试")}finally{p(!1)}},L=()=>{r(-1)},R=e=>{h.info(`导出脚本为 ${e.toUpperCase()} 格式`)};return E?t.jsx(Result,{status:"error",title:"加载失败",subTitle:E,extra:[t.jsx(Button,{onClick:L,children:"返回"},"back")]}):t.jsx("div",{className:"_container_bdxvu_1",children:t.jsxs(Spin,{spinning:A,tip:"加载项目中...",children:[t.jsxs("div",{className:"_header_bdxvu_6",children:[t.jsx(Button,{type:"text",icon:t.jsx(ArrowLeftOutlined,{}),onClick:L,children:"返回"}),t.jsx(we,{level:3,children:I?"创建新项目":"编辑项目"}),t.jsx(Button,{type:"primary",icon:t.jsx(SaveOutlined,{}),onClick:F,loading:u,children:"保存项目"})]}),t.jsx(Card,{className:"_card_bdxvu_15",children:t.jsxs(Form,{form:i,layout:"vertical",initialValues:{name:"",description:""},children:[t.jsx(Form.Item,{name:"name",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:t.jsx(Input,{placeholder:"请输入项目名称",maxLength:100})}),t.jsx(Form.Item,{name:"description",label:"项目描述",children:t.jsx(Input.TextArea,{placeholder:"请输入项目描述（选填）",rows:2,maxLength:500})})]})}),t.jsx("div",{className:"_stepsContainer_bdxvu_20",children:t.jsx(Steps,{current:o,onChange:l,items:[{title:"选择视频",icon:t.jsx(VideoCameraOutlined,{}),description:"上传视频文件"},{title:"分析内容",icon:t.jsx(EditOutlined,{}),description:"分析视频生成脚本"},{title:"编辑脚本",icon:t.jsx(CheckCircleOutlined,{}),description:"编辑和优化脚本"}]})}),t.jsx("div",{className:"_stepsContent_bdxvu_23",children:(()=>{switch(o){case 0:return t.jsxs(Card,{className:_e,children:[t.jsxs(we,{level:4,children:[t.jsx(VideoCameraOutlined,{})," 选择视频"]}),t.jsx(Se,{children:"请选择要编辑的视频文件，支持 MP4、MOV、AVI 等常见格式。"}),t.jsx(ne,{initialVideoPath:j,onVideoSelect:$,onVideoRemove:D,loading:d}),t.jsx("div",{className:ve,children:t.jsx(Button,{type:"primary",onClick:()=>l(1),disabled:!y,children:"下一步"})})]});case 1:return t.jsxs(Card,{className:_e,children:[t.jsxs(we,{level:4,children:[t.jsx(EditOutlined,{})," 分析视频内容"]}),t.jsx(Se,{children:"分析视频获取关键帧和内容信息，生成脚本草稿。"}),t.jsx(Spin,{spinning:d,tip:"正在分析视频...",children:t.jsxs("div",{className:"_analyzeContent_bdxvu_42",children:[t.jsx(ne,{initialVideoPath:j,onVideoSelect:$,onVideoRemove:D,loading:!1}),w.length>0&&t.jsxs("div",{className:"_keyFrames_bdxvu_45",children:[t.jsxs(we,{level:5,children:["已提取 ",w.length," 个关键帧"]}),t.jsx("div",{className:"_keyFramesList_bdxvu_51",children:w.map((e,a)=>t.jsx("img",{src:e,alt:`关键帧 ${a+1}`,className:"_keyFrameImage_bdxvu_56"},a))})]})]})}),t.jsx("div",{className:ve,children:t.jsxs(Space,{children:[t.jsx(Button,{onClick:()=>l(0),children:"上一步"}),N.length>0?t.jsx(Button,{type:"primary",onClick:()=>l(2),children:"下一步"}):t.jsx(Button,{type:"primary",onClick:M,loading:d,children:"分析视频"})]})})]});case 2:return t.jsxs(Card,{className:_e,children:[t.jsxs(we,{level:4,children:[t.jsx(EditOutlined,{})," 编辑脚本"]}),t.jsx(Se,{children:"编辑和优化自动生成的脚本内容，可以添加、删除或修改片段。"}),t.jsx(se,{videoPath:j,initialSegments:N,onSave:k,onExport:R}),t.jsx("div",{className:ve,children:t.jsxs(Space,{children:[t.jsx(Button,{onClick:()=>l(1),children:"上一步"}),t.jsx(Button,{type:"primary",onClick:F,loading:u,children:"保存项目"})]})})]});default:return null}})()})]})})},Ce=e=>{let t;const a=new Set,n=(e,n)=>{const s="function"==typeof e?e(t):e;if(!Object.is(s,t)){const e=t;t=(null!=n?n:"object"!=typeof s||null===s)?s:Object.assign({},t,s),a.forEach(a=>a(t,e))}},s=()=>t,r={setState:n,getState:s,getInitialState:()=>i,subscribe:e=>(a.add(e),()=>a.delete(e)),destroy:()=>{a.clear()}},i=t=e(n,s,r);return r};var Ne={exports:{}},ke={},Ie={exports:{}},Te={},Ae=e,Oe="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Ee=Ae.useState,Pe=Ae.useEffect,$e=Ae.useLayoutEffect,De=Ae.useDebugValue;function Me(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Oe(e,a)}catch(n){return!0}}var ze="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),n=Ee({inst:{value:a,getSnapshot:t}}),s=n[0].inst,r=n[1];return $e(function(){s.value=a,s.getSnapshot=t,Me(s)&&r({inst:s})},[e,a,t]),Pe(function(){return Me(s)&&r({inst:s}),e(function(){Me(s)&&r({inst:s})})},[e]),De(a),a};Te.useSyncExternalStore=void 0!==Ae.useSyncExternalStore?Ae.useSyncExternalStore:ze,Ie.exports=Te;var Be=Ie.exports,Fe=e,Le=Be,Re="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},qe=Le.useSyncExternalStore,We=Fe.useRef,Ve=Fe.useEffect,Ke=Fe.useMemo,Ue=Fe.useDebugValue;ke.useSyncExternalStoreWithSelector=function(e,t,a,n,s){var r=We(null);if(null===r.current){var i={hasValue:!1,value:null};r.current=i}else i=r.current;r=Ke(function(){function e(e){if(!l){if(l=!0,r=e,e=n(e),void 0!==s&&i.hasValue){var t=i.value;if(s(t,e))return o=t}return o=e}if(t=o,Re(r,e))return t;var a=n(e);return void 0!==s&&s(t,a)?(r=e,t):(r=e,o=a)}var r,o,l=!1,d=void 0===a?null:a;return[function(){return e(t())},null===d?void 0:function(){return e(d())}]},[t,a,n,s]);var o=qe(e,r[0],r[1]);return Ve(function(){i.hasValue=!0,i.value=o},[o]),Ue(o),o},Ne.exports=ke;const He=g(Ne.exports),{useDebugValue:Je}=r,{useSyncExternalStoreWithSelector:Ge}=He,Xe=e=>e,Ye=e=>{const t="function"==typeof e?(e=>e?Ce(e):Ce)(e):e,a=(e,a)=>function(e,t=Xe,a){const n=Ge(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,a);return Je(n),n}(t,e,a);return Object.assign(a,t),a},Qe=e=>e?Ye(e):Ye;function Ze(e,t){let a;try{a=e()}catch(n){return}return{getItem:e=>{var n;const s=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),r=null!=(n=a.getItem(e))?n:null;return r instanceof Promise?r.then(s):s(r)},setItem:(e,n)=>a.setItem(e,JSON.stringify(n,null==t?void 0:t.replacer)),removeItem:e=>a.removeItem(e)}}const et=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>et(e)(a),catch(e){return this}}}catch(a){return{then(e){return this},catch:e=>et(e)(a)}}},tt=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((e,t)=>(a,n,s)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const o=new Set,l=new Set;let d;try{d=r.getStorage()}catch(y){}if(!d)return e((...e)=>{a(...e)},n,s);const c=et(r.serialize),u=()=>{const e=r.partialize({...n()});let t;const a=c({state:e,version:r.version}).then(e=>d.setItem(r.name,e)).catch(e=>{t=e});if(t)throw t;return a},p=s.setState;s.setState=(e,t)=>{p(e,t),u()};const m=e((...e)=>{a(...e),u()},n,s);let h;const g=()=>{var e;if(!d)return;i=!1,o.forEach(e=>e(n()));const t=(null==(e=r.onRehydrateStorage)?void 0:e.call(r,n()))||void 0;return et(d.getItem.bind(d))(r.name).then(e=>{if(e)return r.deserialize(e)}).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return e.state;if(r.migrate)return r.migrate(e.state,e.version)}}).then(e=>{var t;return h=r.merge(e,null!=(t=n())?t:m),a(h,!0),u()}).then(()=>{null==t||t(h,void 0),i=!0,l.forEach(e=>e(h))}).catch(e=>{null==t||t(void 0,e)})};return s.persist={setOptions:e=>{r={...r,...e},e.getStorage&&(d=e.getStorage())},clearStorage:()=>{null==d||d.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>g(),hasHydrated:()=>i,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},g(),h||m})(e,t):((e,t)=>(a,n,s)=>{let r={storage:Ze(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const o=new Set,l=new Set;let d=r.storage;if(!d)return e((...e)=>{a(...e)},n,s);const c=()=>{const e=r.partialize({...n()});return d.setItem(r.name,{state:e,version:r.version})},u=s.setState;s.setState=(e,t)=>{u(e,t),c()};const p=e((...e)=>{a(...e),c()},n,s);let m;s.getInitialState=()=>p;const h=()=>{var e,t;if(!d)return;i=!1,o.forEach(e=>{var t;return e(null!=(t=n())?t:p)});const s=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=n())?e:p))||void 0;return et(d.getItem.bind(d))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate)return[!0,r.migrate(e.state,e.version)]}return[!1,void 0]}).then(e=>{var t;const[s,i]=e;if(m=r.merge(i,null!=(t=n())?t:p),a(m,!0),s)return c()}).then(()=>{null==s||s(m,void 0),m=n(),i=!0,l.forEach(e=>e(m))}).catch(e=>{null==s||s(void 0,e)})};return s.persist={setOptions:e=>{r={...r,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>h(),hasHydrated:()=>i,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},r.skipHydration||h(),m||p})(e,t);Qe()(tt((e,t)=>({sidebarCollapsed:!1,theme:"auto",language:"zh",currentProjectId:null,currentModel:null,isLoading:!1,loadingMessage:"",notifications:[],toggleSidebar:()=>e(e=>({sidebarCollapsed:!e.sidebarCollapsed})),setTheme:t=>e({theme:t}),setLanguage:t=>e({language:t}),setCurrentProject:t=>e({currentProjectId:t}),setCurrentModel:t=>e({currentModel:t}),setLoading:(t,a="")=>e({isLoading:t,loadingMessage:a}),addNotification:a=>{const n=`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;e(e=>({notifications:[...e.notifications,{...a,id:n}]}));const s=a.duration??3e3;setTimeout(()=>{t().removeNotification(n)},s)},removeNotification:t=>e(e=>({notifications:e.notifications.filter(e=>e.id!==t)})),clearAllNotifications:()=>e({notifications:[]})}),{name:"reelforge-app-storage",partialize:e=>({sidebarCollapsed:e.sidebarCollapsed,theme:e.theme,language:e.language,currentProjectId:e.currentProjectId,currentModel:e.currentModel})}));const at={BAIDU_ERNIE:{modelId:"ernie-5.0",name:"ERNIE 5.0",provider:"baidu",description:"百度最新大模型",defaultModel:"ernie-5.0"},ALIBABA_QWEN:{modelId:"qwen-3.5",name:"通义千问 3.5",provider:"alibaba",description:"阿里大模型",defaultModel:"qwen-3.5"},ZHIPU_GLM:{modelId:"glm-5",name:"GLM-5",provider:"zhipu",description:"智谱大模型",defaultModel:"glm-5"},MOONSHOT_KIMI:{modelId:"kimi-k2.5",name:"Kimi k2.5",provider:"moonshot",description:"月之暗面大模型",defaultModel:"kimi-k2.5"},MINIMAX:{modelId:"minimax-m2.5",name:"MiniMax M2.5",provider:"minimax",description:"MiniMax大模型",defaultModel:"minimax-m2.5"},BYTEDANCE_DOUBAO:{modelId:"doubao-pro",name:"豆包 Pro",provider:"doubao",description:"字节大模型",defaultModel:"doubao-pro"}},nt=at.BAIDU_ERNIE,st={script:[at.BAIDU_ERNIE,at.ALIBABA_QWEN,at.ZHIPU_GLM],analysis:[at.MOONSHOT_KIMI,at.MINIMAX],creative:[at.BYTEDANCE_DOUBAO,at.ALIBABA_QWEN]},rt="mangaai_preferences",it={general:{language:"zh",theme:"auto",autoSave:!0,autoSaveInterval:30,showWelcome:!0,defaultProjectPath:"",maxRecentProjects:20},ai:{defaultProvider:"baidu",defaultModel:"ernie-5.0",temperature:.7,maxTokens:2e3,timeout:6e4,retryCount:3,apiKeys:{}},video:{defaultResolution:"1080p",defaultAspectRatio:"16:9",defaultFrameRate:30,defaultCodec:"h264",defaultQuality:"high",autoKeyframe:!0,defaultOutputFormat:"mp4"},notification:{projectComplete:!0,projectError:!0,apiQuotaWarning:!0,updateNotify:!1,soundEnabled:!0},shortcut:{newProject:"Ctrl+N",openProject:"Ctrl+O",saveProject:"Ctrl+S",undo:"Ctrl+Z",redo:"Ctrl+Y",playPreview:"Space",exportVideo:"Ctrl+E"},advanced:{enableDebugMode:!1,logLevel:"info",autoUpdate:!0,betaFeatures:!1,hardwareAcceleration:!0,maxConcurrentTasks:3,cacheSize:1024},version:"2.0.0",lastUpdated:Date.now()},ot=new class{settings={...it};listeners=new Set;constructor(){this.loadSettings()}loadSettings(){try{const e=localStorage.getItem(rt);if(e){const t=JSON.parse(e);this.settings=this.mergeSettings(it,t)}}catch(e){}}saveSettings(){try{this.settings.lastUpdated=Date.now(),localStorage.setItem(rt,JSON.stringify(this.settings))}catch(e){}}mergeSettings(e,t){return{...e,...t,general:{...e.general,...t.general},ai:{...e.ai,...t.ai},video:{...e.video,...t.video},notification:{...e.notification,...t.notification},shortcut:{...e.shortcut,...t.shortcut},advanced:{...e.advanced,...t.advanced}}}getSettings(){return{...this.settings}}getGeneralSettings(){return{...this.settings.general}}getAISettings(){return{...this.settings.ai}}getVideoSettings(){return{...this.settings.video}}getNotificationSettings(){return{...this.settings.notification}}getShortcutSettings(){return{...this.settings.shortcut}}getAdvancedSettings(){return{...this.settings.advanced}}updateGeneralSettings(e){this.settings.general={...this.settings.general,...e},this.saveSettings(),this.notifyListeners()}updateAISettings(e){this.settings.ai={...this.settings.ai,...e},this.saveSettings(),this.notifyListeners()}updateVideoSettings(e){this.settings.video={...this.settings.video,...e},this.saveSettings(),this.notifyListeners()}updateNotificationSettings(e){this.settings.notification={...this.settings.notification,...e},this.saveSettings(),this.notifyListeners()}updateShortcutSettings(e){this.settings.shortcut={...this.settings.shortcut,...e},this.saveSettings(),this.notifyListeners()}updateAdvancedSettings(e){this.settings.advanced={...this.settings.advanced,...e},this.saveSettings(),this.notifyListeners()}resetSettings(e){e?this.settings[e]=it[e]:this.settings={...it},this.saveSettings(),this.notifyListeners()}exportSettings(){return JSON.stringify(this.settings,null,2)}importSettings(e){try{const t=JSON.parse(e);return this.settings=this.mergeSettings(it,t),this.saveSettings(),this.notifyListeners(),!0}catch(t){return!1}}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){const e=this.getSettings();this.listeners.forEach(t=>t(e))}getApiKey(e){return this.settings.ai.apiKeys[e]}setApiKey(e,t){this.settings.ai.apiKeys[e]=t,this.saveSettings()}removeApiKey(e){delete this.settings.ai.apiKeys[e],this.saveSettings()}},lt=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_SETTINGS:it,default:ot,settingsService:ot},Symbol.toStringTag,{value:"Module"})),dt=new class{abortControllers=new Map;async generateScript(e,t,a){const n=this.buildScriptPrompt(a);try{const s=await this.callAPI(e,t,n);return{id:`script_${Date.now()}`,title:a.topic,content:s.content,segments:this.parseScriptSegments(s.content),metadata:{style:a.style,tone:a.tone,length:a.length,targetAudience:a.audience,language:a.language,wordCount:s.content.length,estimatedDuration:this.estimateDuration(s.content.length),generatedBy:e.id,generatedAt:(new Date).toISOString()},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}catch(s){throw s}}async analyzeVideo(e,t,a){const n=this.buildAnalysisPrompt(a);try{return{summary:(await this.callAPI(e,t,n)).content,scenes:this.generateMockScenes(a.duration),keyframes:this.generateMockKeyframes(a.duration),createdAt:(new Date).toISOString()}}catch(s){throw s}}async optimizeScript(e,t,a,n){const s=this.buildOptimizationPrompt(a,n);try{return(await this.callAPI(e,t,s)).content}catch(r){throw r}}async translateScript(e,t,a,n){const s=`请将以下脚本翻译成${n}，保持原有的语气和风格：\n\n${a}\n\n请直接返回翻译后的内容，不要添加解释。`;try{return(await this.callAPI(e,t,s)).content}catch(r){throw r}}async callAPI(e,t,a){if(!MODEL_PROVIDERS[e.provider])throw new Error(`不支持的提供商: ${e.provider}`);const n={model:t.model||e.defaultModel||e.id,messages:[{role:"system",content:"你是一个专业的视频内容创作助手，擅长生成高质量的解说脚本。"},{role:"user",content:a}],temperature:t.temperature??.7,max_tokens:t.maxTokens??2e3};switch(e.provider){case"openai":return this.callOpenAI(t.apiKey,n);case"anthropic":return this.callAnthropic(t.apiKey,n);case"google":return this.callGoogle(t.apiKey,n);case"baidu":return this.callBaidu(t.apiKey,t.apiSecret,n);case"alibaba":return this.callAlibaba(t.apiKey,n);case"zhipu":return this.callZhipu(t.apiKey,n);case"moonshot":return this.callMoonshot(t.apiKey,n);case"minimax":return this.callMinimax(t.apiKey,n);case"doubao":return this.callDoubao(t.apiKey,n);default:return this.mockCall(n)}}async callOpenAI(e,t){const a=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`OpenAI API 错误: ${a.status}`);const n=await a.json();return{content:n.choices[0].message.content,usage:n.usage,model:n.model}}async callAnthropic(e,t){const a=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":e,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify({model:t.model,messages:t.messages,max_tokens:t.max_tokens,temperature:t.temperature})});if(!a.ok)throw new Error(`Anthropic API 错误: ${a.status}`);const n=await a.json();return{content:n.content[0].text,usage:n.usage,model:n.model}}async callGoogle(e,t){const a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${t.model}:generateContent?key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:t.messages.map(e=>({role:"assistant"===e.role?"model":"user",parts:[{text:e.content}]})),generationConfig:{temperature:t.temperature,maxOutputTokens:t.max_tokens}})});if(!a.ok)throw new Error(`Google API 错误: ${a.status}`);return{content:(await a.json()).candidates[0].content.parts[0].text,model:t.model}}async callBaidu(e,t,a){const n=await fetch(`https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${e}&client_secret=${t}`,{method:"POST"}),s=(await n.json()).access_token,r=await fetch(`https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/${a.model}?access_token=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:a.messages,temperature:a.temperature,max_output_tokens:a.max_tokens})});if(!r.ok)throw new Error(`百度 API 错误: ${r.status}`);return{content:(await r.json()).result,model:a.model}}async callAlibaba(e,t){const a=await fetch("https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`阿里云 API 错误: ${a.status}`);const n=await a.json();return{content:n.choices[0].message.content,usage:n.usage,model:n.model}}async callZhipu(e,t){const a=await fetch("https://open.bigmodel.cn/api/paas/v4/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`智谱 API 错误: ${a.status}`);const n=await a.json();return{content:n.choices[0].message.content,usage:n.usage,model:n.model}}async callMoonshot(e,t){const a=await fetch("https://api.moonshot.cn/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:t.model||"kimi-k2.5",messages:t.messages,temperature:t.temperature??.7,max_tokens:t.max_tokens??2e3,stream:t.stream??!1})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(`月之暗面 API 错误: ${a.status} - ${e.error?.message||"未知错误"}`)}const n=await a.json();return{content:n.choices[0].message.content,usage:n.usage,model:n.model}}async callMinimax(e,t){const a=await fetch("https://api.minimax.chat/v1/text/chatcompletion_v2",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:t.model||"minimax-m2.5",messages:t.messages.map(e=>({role:e.role,content:e.content})),temperature:t.temperature??.7,max_tokens:t.max_tokens??2e3})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(`MiniMax API 错误: ${a.status} - ${e.error?.message||"未知错误"}`)}const n=await a.json();return{content:n.choices[0].message.content,usage:n.usage,model:n.model}}async callDoubao(e,t){const a=await fetch("https://ark.cn-beijing.volces.com/api/v3/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:t.model||"doubao-pro-32k",messages:t.messages,temperature:t.temperature??.7,max_tokens:t.max_tokens??2e3})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(`豆包 API 错误: ${a.status} - ${e.error?.message||"未知错误"}`)}const n=await a.json();return{content:n.choices[0].message.content,usage:n.usage,model:n.model}}async mockCall(e){return await new Promise(e=>setTimeout(e,2e3)),{content:"这是一个模拟生成的脚本内容。\n\n【开场】\n大家好！今天我们要聊的是一个非常有趣的话题。\n\n【主体内容】\n首先，让我们了解一下基本概念。这个话题涉及很多方面，包括：\n1. 核心原理\n2. 实际应用\n3. 注意事项\n\n【总结】\n希望通过这个视频，能够帮助大家更好地理解这个话题。如果你有任何问题，欢迎在评论区留言！\n\n感谢观看，我们下期再见！",usage:{prompt_tokens:500,completion_tokens:300,total_tokens:800},model:e.model}}getRecommendedModels(e){return st[e]||[nt]}getModelInfo(e){return Object.values(at).find(t=>t.modelId===e)||null}getAllModels(){return Object.values(at)}getDomesticModels(){return Object.values(at).filter(e=>["baidu","alibaba","moonshot","zhipu","minimax"].includes(e.provider))}buildScriptPrompt(e){const t={short:{time:"1-3分钟",words:"300-500字"},medium:{time:"3-5分钟",words:"500-800字"},long:{time:"5-10分钟",words:"800-1500字"}}[e.length];return`请为以下主题生成一个视频解说脚本：\n\n主题：${e.topic}\n风格：${{professional:"专业正式",casual:"轻松随意",humorous:"幽默风趣",emotional:"情感共鸣",technical:"技术讲解",promotional:"营销推广"}[e.style]||e.style}\n语气：${e.tone}\n长度：${t.time}（约${t.words}）\n目标受众：${e.audience}\n语言：${"zh"===e.language?"中文":"English"}\n${e.keywords?.length?`关键词：${e.keywords.join("、")}`:""}\n${e.requirements?`特殊要求：${e.requirements}`:""}\n${e.videoDuration?`视频时长：${Math.round(e.videoDuration/60)}分钟`:""}\n\n请生成一个结构完整的脚本，包含：\n1. 开场白（吸引观众注意）\n2. 主体内容（分段阐述）\n3. 结尾（总结和互动）\n\n要求：\n- 语言自然流畅，适合口语表达\n- 段落清晰，便于分段录制\n- 适当使用过渡语句\n- 包含互动引导（提问、引导评论等）\n\n请直接返回脚本内容，不需要额外的解释。`}buildAnalysisPrompt(e){return`请分析以下视频的基本信息：\n\n时长：${Math.round(e.duration/60)}分钟\n分辨率：${e.width}x${e.height}\n格式：${e.format}\n\n请提供：\n1. 视频内容摘要（100字以内）\n2. 建议的脚本风格\n3. 目标受众分析\n4. 内容亮点建议\n\n请直接返回分析结果。`}buildOptimizationPrompt(e,t){return`请对以下脚本进行优化：\n\n优化目标：${{shorten:"缩短内容，保持核心信息",lengthen:"扩展内容，增加细节描述",simplify:"简化语言，让内容更通俗易懂",professional:"提升专业性，增加行业术语"}[t]}\n\n原脚本：\n${e}\n\n请直接返回优化后的脚本内容。`}parseScriptSegments(e){const t=e.split("\n\n").filter(e=>e.trim());return t.map((e,a)=>({id:`seg_${a+1}`,startTime:30*a,endTime:30*(a+1),content:e.trim(),type:0===a||a===t.length-1?"narration":"dialogue"}))}estimateDuration(e){return Math.ceil(e/150)}generateMockScenes(e){const t=[],a=Math.min(Math.floor(e/30),10);for(let n=0;n<a;n++)t.push({id:`scene_${n+1}`,startTime:30*n,endTime:Math.min(30*(n+1),e),thumbnail:"",description:`场景 ${n+1}`,tags:[`场景${n+1}`]});return t}generateMockKeyframes(e){const t=[],a=Math.min(Math.floor(e/5),20);for(let n=0;n<a;n++)t.push({id:`kf_${n+1}`,timestamp:5*n,thumbnail:"",description:`关键帧 ${n+1}`});return t}async chat(e,t){const a=ot.getSettings(),n=a?.ai||{},s=at.find(e=>e.id===(n.defaultModel||nt))||at[0],r={id:t?.model||n.defaultModel||s.id,name:s.name,provider:s.provider},i={model:r.id,messages:[{role:"system",content:t?.systemPrompt||"你是一个智能助手，请根据用户的需求提供帮助。"},{role:"user",content:e}],temperature:t?.temperature??n.temperature??.7,max_tokens:t?.maxTokens??n.maxTokens??2e3};try{switch(r.provider){case"openai":return await this.callOpenAI(n.apiKey,i);case"baidu":return await this.callBaidu(n.apiKey,n.apiSecret,i);case"alibaba":return await this.callAlibaba(n.apiKey,i);case"zhipu":return await this.callZhipu(n.apiKey,i);case"moonshot":return await this.callMoonshot(n.apiKey,i);case"minimax":return await this.callMinimax(n.apiKey,i);case"doubao":return await this.callDoubao(n.apiKey,i);default:return await this.mockCall(i)}}catch(o){throw o}}async analyzeText(e,t){const a=this.buildTextAnalysisPrompt(e,t?.type||"general"),n=await this.chat(a,{model:t?.model});return{originalText:e,analysis:n.content,model:n.model,analyzedAt:(new Date).toISOString()}}buildTextAnalysisPrompt(e,t){const a={general:`请分析以下文本的内容、情感和关键信息：\n\n${e}`,sentiment:`请分析以下文本的情感倾向（积极/消极/中性）：\n\n${e}`,keywords:`请提取以下文本的关键词：\n\n${e}`,summary:`请总结以下文本的主要内容：\n\n${e}`,structure:`请分析以下文本的结构和逻辑：\n\n${e}`};return a[t]||a.general}cancelRequest(e){const t=this.abortControllers.get(e);t&&(t.abort(),this.abortControllers.delete(e))}},ct={PROJECTS:"nova_projects",APP_STATE:"nova_app_state",USER_PREFERENCES:"nova_preferences",RECENT_FILES:"nova_recent_files",MODEL_SETTINGS:"nova_model_settings",EXPORT_HISTORY:"nova_export_history"},ut=new class{projects={getAll:()=>{const e=localStorage.getItem(ct.PROJECTS);return e?JSON.parse(e):[]},getById:e=>this.projects.getAll().find(t=>t.id===e)||null,save:e=>{const t=this.projects.getAll(),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]={...e,updatedAt:(new Date).toISOString()}:t.push(e),localStorage.setItem(ct.PROJECTS,JSON.stringify(t))},delete:e=>{const t=this.projects.getAll().filter(t=>t.id!==e);localStorage.setItem(ct.PROJECTS,JSON.stringify(t))},search:e=>{const t=this.projects.getAll(),a=e.toLowerCase();return t.filter(e=>e.name.toLowerCase().includes(a)||e.description?.toLowerCase().includes(a))},getRecent:(e=10)=>this.projects.getAll().sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()).slice(0,e),export:e=>{const t=this.projects.getById(e);return t?JSON.stringify(t,null,2):""},import:e=>{try{const t=JSON.parse(e);return t.id=`${t.id}_imported_${Date.now()}`,t.createdAt=(new Date).toISOString(),t.updatedAt=(new Date).toISOString(),this.projects.save(t),t}catch{return null}}};appState={get:()=>{const e=localStorage.getItem(ct.APP_STATE);return e?JSON.parse(e):{}},set:e=>{const t=this.appState.get();localStorage.setItem(ct.APP_STATE,JSON.stringify({...t,...e}))},clear:()=>{localStorage.removeItem(ct.APP_STATE)}};preferences={get:()=>{const e=localStorage.getItem(ct.USER_PREFERENCES),t={autoSave:!0,autoSaveInterval:30,defaultVideoQuality:"high",defaultOutputFormat:"mp4",enablePreview:!0,previewQuality:"medium",notifications:!0,soundEffects:!0};return e?{...t,...JSON.parse(e)}:t},set:e=>{const t=this.preferences.get();localStorage.setItem(ct.USER_PREFERENCES,JSON.stringify({...t,...e}))},reset:()=>{localStorage.removeItem(ct.USER_PREFERENCES)}};recentFiles={get:()=>{const e=localStorage.getItem(ct.RECENT_FILES);return e?JSON.parse(e):[]},add:e=>{const t=this.recentFiles.get(),a=[e,...t.filter(t=>t!==e)].slice(0,20);localStorage.setItem(ct.RECENT_FILES,JSON.stringify(a))},remove:e=>{const t=this.recentFiles.get().filter(t=>t!==e);localStorage.setItem(ct.RECENT_FILES,JSON.stringify(t))},clear:()=>{localStorage.removeItem(ct.RECENT_FILES)}};modelSettings={get:e=>{const t=localStorage.getItem(`${ct.MODEL_SETTINGS}_${e}`);return t?JSON.parse(t):null},set:(e,t)=>{localStorage.setItem(`${ct.MODEL_SETTINGS}_${e}`,JSON.stringify(t))},delete:e=>{localStorage.removeItem(`${ct.MODEL_SETTINGS}_${e}`)},getAll:()=>{const e={};for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a?.startsWith(ct.MODEL_SETTINGS)){const t=a.replace(`${ct.MODEL_SETTINGS}_`,"");e[t]=this.modelSettings.get(t)}}return e}};exportHistory={get:()=>{const e=localStorage.getItem(ct.EXPORT_HISTORY);return e?JSON.parse(e):[]},add:e=>{const t=this.exportHistory.get();t.unshift({...e,timestamp:(new Date).toISOString()}),localStorage.setItem(ct.EXPORT_HISTORY,JSON.stringify(t.slice(0,100)))},clear:()=>{localStorage.removeItem(ct.EXPORT_HISTORY)}};set(e,t){localStorage.setItem(`reelforge_${e}`,JSON.stringify(t))}get(e,t){const a=localStorage.getItem(`reelforge_${e}`);return a?JSON.parse(a):t}remove(e){localStorage.removeItem(`reelforge_${e}`)}clearAll(){Object.values(ct).forEach(e=>{localStorage.removeItem(e)});const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a?.startsWith("reelforge_")&&e.push(a)}e.forEach(e=>localStorage.removeItem(e))}exportAll(){const e={};for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a?.startsWith("reelforge_")){const t=localStorage.getItem(a);e[a]=t?JSON.parse(t):null}}return JSON.stringify(e,null,2)}importAll(e){try{const t=JSON.parse(e);return Object.entries(t).forEach(([e,t])=>{localStorage.setItem(e,JSON.stringify(t))}),!0}catch{return!1}}getSize(){let e=0;for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a?.startsWith("reelforge_")){const t=localStorage.getItem(a);t&&(e+=a.length+t.length)}}return{used:e,total:5242880}}},pt=[{id:"template_1",name:"专业解说",description:"正式专业的解说风格，适合知识类、科普类内容",category:"professional",style:"formal",tone:"professional",sample:"大家好，今天我们来探讨...",tags:["知识","科普","正式"],popularity:95},{id:"template_2",name:"轻松休闲",description:"轻松幽默的解说风格，适合娱乐类、搞笑类内容",category:"casual",style:"casual",tone:"friendly",sample:"哈喽各位，今天给大家带来...",tags:["搞笑","娱乐","轻松"],popularity:88},{id:"template_3",name:"故事叙述",description:"讲故事的解说风格，适合剧情类、情感类内容",category:"story",style:"narrative",tone:"emotional",sample:"在那个遥远的年代，有一个传说...",tags:["故事","剧情","情感"],popularity:76},{id:"template_4",name:"游戏解说",description:"激情澎湃的游戏解说风格，适合游戏类内容",category:"gaming",style:"energetic",tone:"excited",sample:"这波操作太秀了！兄弟们看好了...",tags:["游戏","电竞","激情"],popularity:82},{id:"template_5",name:"影评风格",description:"专业的影评解说风格，适合电影类内容",category:"review",style:"critical",tone:"analytical",sample:"从镜头语言来看，导演在这里运用了...",tags:["电影","影评","专业"],popularity:70}];new class{templates;constructor(){this.templates=[...pt],this.loadFromStorage()}loadFromStorage(){try{const e=localStorage.getItem("scriptTemplates");if(e){const t=JSON.parse(e);this.templates=[...this.templates,...t]}}catch{}}saveToStorage(){try{const e=this.templates.filter(e=>e.isCustom);localStorage.setItem("scriptTemplates",JSON.stringify(e))}catch{}}getAllTemplates(){return this.templates}getTemplateById(e){return this.templates.find(t=>t.id===e)}getTemplatesByCategory(e){return this.templates.filter(t=>t.category===e)}getCategories(){const e=new Set;return this.templates.forEach(t=>{t.category&&e.add(t.category)}),Array.from(e)}searchTemplates(e){const t=e.toLowerCase();return this.templates.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.tags?.some(e=>e.toLowerCase().includes(t)))}addTemplate(e){const t={...e,id:`custom_${Date.now()}`,isCustom:!0};return this.templates.push(t),this.saveToStorage(),t}updateTemplate(e,t){const a=this.templates.findIndex(t=>t.id===e);if(-1!==a)return this.templates[a]={...this.templates[a],...t},this.saveToStorage(),this.templates[a]}deleteTemplate(e){const t=this.templates.findIndex(t=>t.id===e&&t.isCustom);return-1!==t&&(this.templates.splice(t,1),this.saveToStorage(),!0)}getPopularTemplates(e=5){return[...this.templates].sort((e,t)=>(t.popularity||0)-(e.popularity||0)).slice(0,e)}};const mt=[{id:"sb_template_5",name:"浪漫邂逅",description:"男女主角浪漫相遇场景",genre:"romance",shots:[{type:"wide",angle:"eye_level",movement:"static",duration:3,description:"街景环境"},{type:"medium",angle:"eye_level",movement:"pan",duration:2,description:"男主走过"},{type:"medium",angle:"eye_level",movement:"pan",duration:2,description:"女主走过"},{type:"close",angle:"eye_level",movement:"static",duration:2,description:"目光交汇"},{type:"extreme_close",angle:"eye_level",movement:"zoom",duration:1,description:"心跳特写"},{type:"medium",angle:"eye_level",movement:"dolly",duration:3,description:"两人靠近"}],transitions:["fade","slow_motion","soft_focus"],duration:15,tags:["浪漫","爱情","邂逅"],usageCount:156},{id:"sb_template_6",name:"职场对决",description:"办公室权力斗争场景",genre:"workplace",shots:[{type:"wide",angle:"eye_level",movement:"static",duration:2,description:"会议室全景"},{type:"medium",angle:"high",movement:"pan",duration:3,description:"俯视会议桌"},{type:"close",angle:"eye_level",movement:"static",duration:2,description:"主角坚定"},{type:"close",angle:"eye_level",movement:"static",duration:2,description:"对手阴沉"},{type:"over_shoulder",angle:"eye_level",movement:"zoom",duration:3,description:"对峙镜头"}],transitions:["cut","hard_cut","quick_cut"],duration:14,tags:["职场","对决","紧张"],usageCount:89},{id:"sb_template_7",name:"古风武侠",description:"古代武侠打斗场景",genre:"wuxia",shots:[{type:"wide",angle:"bird",movement:"static",duration:3,description:"竹林全景"},{type:"medium",angle:"eye_level",movement:"track",duration:2,description:"轻功追逐"},{type:"close",angle:"low",movement:"zoom",duration:1,description:"剑光一闪"},{type:"extreme_close",angle:"eye_level",movement:"static",duration:1,description:"眼神杀气"},{type:"wide",angle:"high",movement:"dolly",duration:3,description:"空中对决"}],transitions:["cut","flash_cut","motion_blur"],duration:12,tags:["武侠","古风","打斗"],usageCount:134},{id:"sb_template_8",name:"科幻未来",description:"未来科幻场景",genre:"scifi",shots:[{type:"wide",angle:"bird",movement:"track",duration:4,description:"未来城市全景"},{type:"medium",angle:"eye_level",movement:"pan",duration:3,description:"飞行器穿梭"},{type:"close",angle:"eye_level",movement:"static",duration:2,description:"全息界面"},{type:"extreme_close",angle:"eye_level",movement:"zoom",duration:2,description:"机械义眼"}],transitions:["fade","glitch","scan_line"],duration:13,tags:["科幻","未来","科技"],usageCount:76},{id:"sb_template_9",name:"校园青春",description:"校园青春日常场景",genre:"youth",shots:[{type:"wide",angle:"eye_level",movement:"static",duration:3,description:"教室全景"},{type:"medium",angle:"eye_level",movement:"pan",duration:2,description:"同学互动"},{type:"close",angle:"eye_level",movement:"static",duration:2,description:"偷看暗恋"},{type:"medium",angle:"high",movement:"tilt",duration:3,description:"窗外夕阳"}],transitions:["fade","soft_cut","dreamy"],duration:12,tags:["校园","青春","纯爱"],usageCount:198},{id:"sb_template_10",name:"美食探店",description:"美食探店推荐场景",genre:"food",shots:[{type:"wide",angle:"eye_level",movement:"static",duration:2,description:"店铺外观"},{type:"medium",angle:"eye_level",movement:"pan",duration:2,description:"店内环境"},{type:"close",angle:"eye_level",movement:"zoom",duration:2,description:"美食特写"},{type:"extreme_close",angle:"eye_level",movement:"static",duration:1,description:"食物纹理"},{type:"medium",angle:"eye_level",movement:"static",duration:2,description:"品尝表情"}],transitions:["fade","cut","zoom_in"],duration:11,tags:["美食","探店","生活"],usageCount:167},{id:"sb_template_11",name:"恐怖惊悚",description:"恐怖惊悚场景",genre:"horror",shots:[{type:"wide",angle:"low",movement:"static",duration:4,description:"阴暗走廊"},{type:"medium",angle:"dutch",movement:"pan",duration:3,description:"诡异移动"},{type:"close",angle:"high",movement:"zoom",duration:2,description:"突然惊吓"},{type:"extreme_close",angle:"eye_level",movement:"shake",duration:1,description:"惊恐表情"}],transitions:["cut","dark_cut","jump_scare"],duration:12,tags:["恐怖","惊悚","悬疑"],usageCount:45},{id:"sb_template_12",name:"运动竞技",description:"体育运动竞技场景",genre:"sports",shots:[{type:"wide",angle:"high",movement:"static",duration:2,description:"赛场全景"},{type:"medium",angle:"eye_level",movement:"track",duration:3,description:"运动员奔跑"},{type:"close",angle:"low",movement:"zoom",duration:2,description:"汗水特写"},{type:"extreme_close",angle:"eye_level",movement:"static",duration:1,description:"坚定眼神"},{type:"wide",angle:"eye_level",movement:"dolly",duration:3,description:"冲刺终点"}],transitions:["cut","slow_motion","speed_ramp"],duration:13,tags:["运动","竞技","热血"],usageCount:112}],ht=[{id:"scene_template_3",name:"古风庭院",description:"古代中式庭院场景",genre:"historical",background:"古典园林，假山流水，亭台楼阁，竹林小径",lighting:"自然光，柔和散射",mood:"古朴、宁静、诗意",elements:["假山","池塘","亭子","竹林","石桥"],tags:["古风","庭院","中式"],usageCount:128},{id:"scene_template_4",name:"未来都市",description:"科幻未来城市场景",genre:"scifi",background:"高楼林立，全息广告，飞行汽车，霓虹灯光",lighting:"霓虹灯光，冷色调",mood:"科技、繁华、冷峻",elements:["摩天楼","全息屏","飞行器","霓虹灯","玻璃幕墙"],tags:["科幻","未来","都市"],usageCount:87},{id:"scene_template_5",name:"海边沙滩",description:"海边度假场景",genre:"leisure",background:"蓝天白云，碧海金沙，椰树遮阳伞",lighting:"强烈阳光，明亮",mood:"放松、愉悦、自由",elements:["沙滩","海浪","椰树","遮阳伞","躺椅"],tags:["海边","度假","夏日"],usageCount:156},{id:"scene_template_6",name:"咖啡厅",description:"文艺咖啡厅场景",genre:"lifestyle",background:"复古装修，木质桌椅，书架绿植，落地窗",lighting:"暖色灯光，柔和",mood:"温馨、文艺、静谧",elements:["吧台","书架","绿植","咖啡杯","落地窗"],tags:["咖啡厅","文艺","休闲"],usageCount:143},{id:"scene_template_7",name:"医院病房",description:"医院病房场景",genre:"medical",background:"白色病房，病床医疗设备，窗外景色",lighting:"冷白灯光，自然光",mood:"严肃、紧张、希望",elements:["病床","监护仪","输液架","窗帘","床头柜"],tags:["医院","医疗","严肃"],usageCount:67},{id:"scene_template_8",name:"健身房",description:"现代健身房场景",genre:"fitness",background:"器械区，瑜伽区，落地镜，工业风装修",lighting:"明亮灯光，活力感",mood:"活力、汗水、坚持",elements:["跑步机","哑铃","瑜伽垫","落地镜","储物柜"],tags:["健身","运动","活力"],usageCount:98},{id:"scene_template_9",name:"图书馆",description:"安静图书馆场景",genre:"education",background:"书架林立，阅读桌椅，落地窗，复古装修",lighting:"自然光+暖色灯光",mood:"安静、知识、专注",elements:["书架","书桌","台灯","楼梯","窗户"],tags:["图书馆","学习","安静"],usageCount:112},{id:"scene_template_10",name:"夜市街道",description:"热闹夜市场景",genre:"nightlife",background:"摊位林立，霓虹招牌，人流涌动，烟火气息",lighting:"霓虹灯光，暖色调",mood:"热闹、烟火、生活",elements:["摊位","招牌","人群","桌椅","灯笼"],tags:["夜市","街道","热闹"],usageCount:134}],gt=[{id:"char_template_3",name:"霸道总裁",description:"冷酷帅气的霸道总裁",appearance:{gender:"male",age:"30-35",archetype:"霸道总裁"},personality:["冷酷","强势","专一","有能力"],role:"protagonist",tags:["总裁","冷酷","帅气"],usageCount:234},{id:"char_template_4",name:"邻家女孩",description:"温柔可爱的邻家女孩",appearance:{gender:"female",age:"20-25",archetype:"邻家女孩"},personality:["温柔","善良","可爱","乐观"],role:"protagonist",tags:["邻家","温柔","可爱"],usageCount:198},{id:"char_template_5",name:"高冷学霸",description:"高冷聪明的学霸",appearance:{gender:"unknown",age:"18-22",archetype:"高冷学霸"},personality:["高冷","聪明","认真","内敛"],role:"protagonist",tags:["学霸","高冷","聪明"],usageCount:167},{id:"char_template_6",name:"热血少年",description:"热血冲动的少年",appearance:{gender:"male",age:"16-20",archetype:"热血少年"},personality:["热血","冲动","正义","勇敢"],role:"protagonist",tags:["热血","少年","正义"],usageCount:145},{id:"char_template_7",name:"腹黑反派",description:"心机深沉的反派角色",appearance:{gender:"unknown",age:"25-40",archetype:"腹黑反派"},personality:["腹黑","阴险","聪明","野心"],role:"antagonist",tags:["反派","腹黑","阴险"],usageCount:89},{id:"char_template_8",name:"御姐女王",description:"成熟魅力的御姐",appearance:{gender:"female",age:"28-35",archetype:"御姐女王"},personality:["成熟","自信","独立","魅力"],role:"protagonist",tags:["御姐","成熟","魅力"],usageCount:156}],yt=[{id:"style_template_3",name:"赛博朋克",description:"未来科技感风格",genre:"scifi",artStyle:"realistic",colorPalette:["#ff0080","#00ffff","#2d004d","#000000"],lightingStyle:"霓虹灯光，高对比度",characteristics:["霓虹灯","高科技","低生活","雨夜"],tags:["赛博朋克","科幻","未来"],usageCount:112},{id:"style_template_4",name:"水墨国风",description:"中国传统水墨风格",genre:"historical",artStyle:"manga",colorPalette:["#1a1a1a","#4a4a4a","#8a8a8a","#ffffff"],lightingStyle:"淡雅水墨，留白意境",characteristics:["水墨","山水","留白","意境"],tags:["水墨","国风","传统"],usageCount:178},{id:"style_template_5",name:"治愈系",description:"温暖治愈的风格",genre:"slice_of_life",artStyle:"anime",colorPalette:["#ffb6c1","#ffe4b5","#e6e6fa","#98fb98"],lightingStyle:"柔和暖光，温馨氛围",characteristics:["柔和","温暖","治愈","日常"],tags:["治愈","温暖","日常"],usageCount:234},{id:"style_template_6",name:"暗黑哥特",description:"暗黑哥特风格",genre:"dark",artStyle:"realistic",colorPalette:["#1a1a1a","#4a0000","#2d004d","#000000"],lightingStyle:"暗调光线，神秘氛围",characteristics:["暗黑","哥特","神秘","华丽"],tags:["暗黑","哥特","神秘"],usageCount:67},{id:"style_template_7",name:"像素风",description:"复古像素艺术风格",genre:"retro",artStyle:"chibi",colorPalette:["#ff6b6b","#4ecdc4","#45b7d1","#f9ca24"],lightingStyle:"平面光线，色块分明",characteristics:["像素","复古","游戏","怀旧"],tags:["像素","复古","游戏"],usageCount:89},{id:"style_template_8",name:"蒸汽朋克",description:"蒸汽朋克机械风格",genre:"steampunk",artStyle:"realistic",colorPalette:["#8b4513","#d2691e","#cd853f","#daa520"],lightingStyle:"暖色调，金属光泽",characteristics:["齿轮","蒸汽","机械","复古未来"],tags:["蒸汽朋克","机械","复古"],usageCount:76}],xt=[{id:"sb_template_1",name:"标准对话",description:"标准的双人对话场景分镜",genre:"general",shots:[{type:"wide",angle:"eye_level",movement:"static",duration:3,description:"建立场景"},{type:"medium",angle:"eye_level",movement:"pan",duration:4,description:"角色A说话"},{type:"close",angle:"eye_level",movement:"static",duration:2,description:"反应镜头"},{type:"medium",angle:"eye_level",movement:"pan",duration:4,description:"角色B说话"}],transitions:["fade","cut","dissolve"],duration:15,tags:["对话","标准","日常"],usageCount:120},{id:"sb_template_2",name:"动作场景",description:"动作打斗场景分镜",genre:"action",shots:[{type:"wide",angle:"high",movement:"track",duration:3,description:"远景展示"},{type:"medium",angle:"eye_level",movement:"dolly",duration:2,description:"快速推进"},{type:"close",angle:"low",movement:"zoom",duration:1,description:"特写"},{type:"extreme_close",angle:"eye_level",movement:"shake",duration:.5,description:"冲击效果"},{type:"wide",angle:"eye_level",movement:"static",duration:2,description:"结果展示"}],transitions:["cut","jump_cut","smash_cut"],duration:10,tags:["动作","打斗","紧张"],usageCount:85},{id:"sb_template_3",name:"情感场景",description:"情感表达场景分镜",genre:"emotional",shots:[{type:"wide",angle:"eye_level",movement:"static",duration:4,description:"环境氛围"},{type:"medium",angle:"eye_level",movement:"tilt",duration:3,description:"角色反应"},{type:"close",angle:"eye_level",movement:"static",duration:3,description:"面部特写"},{type:"wide",angle:"low",movement:"zoom",duration:4,description:"情感高潮"}],transitions:["fade","dissolve","emotional_cut"],duration:16,tags:["情感","感动","温馨"],usageCount:78},{id:"sb_template_4",name:"悬疑场景",description:"悬疑紧张场景分镜",genre:"mystery",shots:[{type:"wide",angle:"low",movement:"static",duration:4,description:"阴暗环境"},{type:"medium",angle:"dutch",movement:"pan",duration:3,description:"紧张移动"},{type:"close",angle:"high",movement:"zoom",duration:2,description:"突然发现"},{type:"extreme_close",angle:"eye_level",movement:"static",duration:2,description:"惊恐表情"}],transitions:["cut","dark_cut","jump_cut"],duration:12,tags:["悬疑","紧张","恐怖"],usageCount:62}],jt=[{id:"scene_template_1",name:"室内客厅",description:"普通家庭客厅场景",genre:"daily",background:"现代公寓客厅，沙发、电视、茶几、落地窗",lighting:"自然光+人工光混合，白天明亮",mood:"温馨、舒适",elements:["沙发","茶几","电视","窗帘","植物"],tags:["室内","日常","家庭"],usageCount:95},{id:"scene_template_2",name:"学校教室",description:"学校教室场景",genre:"education",background:"教室内部，黑板、课桌、窗户",lighting:"荧光灯，自然光从窗户照入",mood:"学习、青春",elements:["黑板","课桌","椅子","书包","教科书"],tags:["学校","学习","青春"],usageCount:72},{id:"scene_template_3",name:"森林",description:"自然森林场景",genre:"nature",background:"茂密森林，阳光透过树叶",lighting:"斑驳的自然光",mood:"神秘、宁静",elements:["树木","草地","小花","阳光","鸟"],tags:["自然","森林","户外"],usageCount:68}],ft=[{id:"char_template_1",name:"热血主角",description:"积极向上的主角模板",appearance:{gender:"male",age:"青年",archetype:"英雄"},personality:["勇敢","正直","坚持","乐观"],role:"protagonist",tags:["主角","热血","正面"],usageCount:110},{id:"char_template_2",name:"温柔女主",description:"温柔善良的女性角色模板",appearance:{gender:"female",age:"青年",archetype:"情人"},personality:["温柔","善良","坚强","体贴"],role:"protagonist",tags:["女主","温柔","女性"],usageCount:98},{id:"char_template_3",name:"反派BOSS",description:"强大神秘的反派模板",appearance:{gender:"unknown",age:"中年",archetype:"阴影"},personality:["冷酷","强大","神秘","野心勃勃"],role:"antagonist",tags:["反派","BOSS","强大"],usageCount:75}],_t=[{id:"style_template_1",name:"日式动漫",description:"经典日式动漫风格",genre:"anime",artStyle:"anime",colorPalette:["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A"],lightingStyle:"明亮鲜艳",characteristics:["大头","尖下巴","大大眼睛","多彩发色"],tags:["日漫","动漫","经典"],usageCount:150},{id:"style_template_2",name:"美式漫画",description:"美式漫画风格",genre:"comic",artStyle:"western",colorPalette:["#2C3E50","#E74C3C","#3498DB","#F39C12"],lightingStyle:"高对比度",characteristics:["肌肉线条","硬朗轮廓","鲜艳色彩","网点"],tags:["美漫","超级英雄","动作"],usageCount:88},{id:"style_template_3",name:"水彩漫画",description:"清新水彩风格",genre:"artistic",artStyle:"manga",colorPalette:["#FFE4E1","#E0FFFF","#FFF0F5","#F0FFF0"],lightingStyle:"柔和温暖",characteristics:["水彩晕染","柔和边缘","淡雅色彩","梦幻"],tags:["水彩","艺术","唯美"],usageCount:65}];new class{storyboardTemplates=[...xt,...mt];sceneTemplates=[...jt,...ht];characterTemplates=[...ft,...gt];styleTemplates=[..._t,...yt];dialogueTemplates=[];constructor(){this.loadFromStorage()}getStoryboardTemplates(e){return e?this.storyboardTemplates.filter(t=>t.genre===e):[...this.storyboardTemplates].sort((e,t)=>t.usageCount-e.usageCount)}getStoryboardTemplate(e){return this.storyboardTemplates.find(t=>t.id===e)}addStoryboardTemplate(e){const t={...e,id:`sb_${C().slice(0,8)}`,usageCount:0,createdAt:(new Date).toISOString()};return this.storyboardTemplates.push(t),this.saveToStorage(),t}useStoryboardTemplate(e){const t=this.storyboardTemplates.find(t=>t.id===e);return t&&(t.usageCount++,this.saveToStorage()),t}getSceneTemplates(e){return e?this.sceneTemplates.filter(t=>t.genre===e):[...this.sceneTemplates].sort((e,t)=>t.usageCount-e.usageCount)}getSceneTemplate(e){return this.sceneTemplates.find(t=>t.id===e)}addSceneTemplate(e){const t={...e,id:`scene_${C().slice(0,8)}`,usageCount:0};return this.sceneTemplates.push(t),this.saveToStorage(),t}getCharacterTemplates(e){return e?this.characterTemplates.filter(t=>t.role===e):[...this.characterTemplates].sort((e,t)=>t.usageCount-e.usageCount)}getCharacterTemplate(e){return this.characterTemplates.find(t=>t.id===e)}addCharacterTemplate(e){const t={...e,id:`char_${C().slice(0,8)}`,usageCount:0};return this.characterTemplates.push(t),this.saveToStorage(),t}getStyleTemplates(e){return e?this.styleTemplates.filter(t=>t.genre===e):[...this.styleTemplates].sort((e,t)=>t.usageCount-e.usageCount)}getStyleTemplate(e){return this.styleTemplates.find(t=>t.id===e)}addStyleTemplate(e){const t={...e,id:`style_${C().slice(0,8)}`,usageCount:0};return this.styleTemplates.push(t),this.saveToStorage(),t}loadFromStorage(){try{const e=localStorage.getItem("dramaTemplates");if(e){const t=JSON.parse(e);t.storyboards&&(this.storyboardTemplates=[...this.storyboardTemplates,...t.storyboards]),t.scenes&&(this.sceneTemplates=[...this.sceneTemplates,...t.scenes]),t.characters&&(this.characterTemplates=[...this.characterTemplates,...t.characters]),t.styles&&(this.styleTemplates=[...this.styleTemplates,...t.styles])}}catch(e){}}saveToStorage(){try{const e={storyboards:this.storyboardTemplates.filter(e=>e.id.startsWith("sb_")),scenes:this.sceneTemplates.filter(e=>e.id.startsWith("scene_")),characters:this.characterTemplates.filter(e=>e.id.startsWith("char_")),styles:this.styleTemplates.filter(e=>e.id.startsWith("style_"))};localStorage.setItem("dramaTemplates",JSON.stringify(e))}catch(e){}}generateUsageReport(){const e=this.storyboardTemplates.reduce((e,t)=>e+t.usageCount,0)+this.sceneTemplates.reduce((e,t)=>e+t.usageCount,0)+this.characterTemplates.reduce((e,t)=>e+t.usageCount,0)+this.styleTemplates.reduce((e,t)=>e+t.usageCount,0),t=[...this.storyboardTemplates].sort((e,t)=>t.usageCount-e.usageCount)[0],a=[...this.sceneTemplates].sort((e,t)=>t.usageCount-e.usageCount)[0],n=[...this.styleTemplates].sort((e,t)=>t.usageCount-e.usageCount)[0];return`# 模板使用报告\n\n## 概览\n- 总使用次数: ${e}\n- 分镜模板: ${this.storyboardTemplates.length} 个\n- 场景模板: ${this.sceneTemplates.length} 个\n- 角色模板: ${this.characterTemplates.length} 个\n- 风格模板: ${this.styleTemplates.length} 个\n\n## 最常用模板\n\n### 分镜模板\n- 名称: ${t?.name||"无"}\n- 使用次数: ${t?.usageCount||0}\n\n### 场景模板\n- 名称: ${a?.name||"无"}\n- 使用次数: ${a?.usageCount||0}\n\n### 风格模板\n- 名称: ${n?.name||"无"}\n- 使用次数: ${n?.usageCount||0}\n\n---\n*报告生成时间: ${(new Date).toLocaleString("zh-CN")}*`}};const vt=[{id:"zh-CN-XiaoxiaoNeural",name:"晓晓",gender:"女",style:"温柔",locale:"zh-CN"},{id:"zh-CN-YunxiNeural",name:"云希",gender:"男",style:"自然",locale:"zh-CN"},{id:"zh-CN-YunyangNeural",name:"云扬",gender:"男",style:"专业",locale:"zh-CN"},{id:"zh-CN-XiaoyiNeural",name:"小艺",gender:"女",style:"活泼",locale:"zh-CN"},{id:"zh-CN-XiaochenNeural",name:"晓晨",gender:"女",style:"甜美",locale:"zh-CN"},{id:"zh-CN-XiaohanNeural",name:"晓涵",gender:"女",style:"知性",locale:"zh-CN"},{id:"zh-CN-XiaomengNeural",name:"晓梦",gender:"女",style:"温柔",locale:"zh-CN"},{id:"zh-CN-XiaomoNeural",name:"晓墨",gender:"男",style:"磁性",locale:"zh-CN"},{id:"zh-CN-XiaoruiNeural",name:"晓睿",gender:"男",style:"成熟",locale:"zh-CN"},{id:"zh-CN-XiaoshuangNeural",name:"晓双",gender:"女",style:"活泼",locale:"zh-CN"},{id:"zh-CN-XiaoxuanNeural",name:"晓萱",gender:"女",style:"清新",locale:"zh-CN"},{id:"zh-CN-XiaoyanNeural",name:"晓颜",gender:"女",style:"标准",locale:"zh-CN"},{id:"zh-CN-XiaoyouNeural",name:"晓悠",gender:"女",style:"可爱",locale:"zh-CN"},{id:"zh-CN-YunfengNeural",name:"云峰",gender:"男",style:"磁性",locale:"zh-CN"},{id:"zh-CN-YunhaoNeural",name:"云皓",gender:"男",style:"阳光",locale:"zh-CN"},{id:"zh-CN-YunjianNeural",name:"云健",gender:"男",style:"解说",locale:"zh-CN"},{id:"zh-CN-YunxiaNeural",name:"云夏",gender:"男",style:"少年",locale:"zh-CN"},{id:"zh-CN-YunyeNeural",name:"云野",gender:"男",style:"磁性",locale:"zh-CN"},{id:"zh-CN-YunzeNeural",name:"云泽",gender:"男",style:"成熟",locale:"zh-CN"},{id:"zh-CN-liaoning-XiaobeiNeural",name:"晓北",gender:"女",style:"东北话",locale:"zh-CN-liaoning"},{id:"zh-CN-shaanxi-XiaoniNeural",name:"晓妮",gender:"女",style:"陕西话",locale:"zh-CN-shaanxi"},{id:"zh-HK-HiuMaanNeural",name:"晓曼",gender:"女",style:"粤语",locale:"zh-HK"},{id:"zh-HK-WanLungNeural",name:"云龙",gender:"男",style:"粤语",locale:"zh-HK"},{id:"zh-TW-HsiaoChenNeural",name:"晓晨",gender:"女",style:"台湾腔",locale:"zh-TW"},{id:"zh-TW-YunJheNeural",name:"云哲",gender:"男",style:"台湾腔",locale:"zh-TW"}],wt=[{id:"xiaoyun",name:"小云",gender:"女",style:"标准"},{id:"xiaogang",name:"小刚",gender:"男",style:"标准"},{id:"ruoxi",name:"若兮",gender:"女",style:"温柔"},{id:"siqi",name:"思琪",gender:"女",style:"温柔"},{id:"sijia",name:"思佳",gender:"女",style:"标准"},{id:"sicheng",name:"思诚",gender:"男",style:"标准"},{id:"aiqi",name:"艾琪",gender:"女",style:"活泼"},{id:"aidi",name:"艾迪",gender:"男",style:"活泼"},{id:"ailing",name:"艾琳",gender:"女",style:"知性"},{id:"aimei",name:"艾美",gender:"女",style:"甜美"},{id:"aiyu",name:"艾雨",gender:"男",style:"磁性"},{id:"aiyue",name:"艾悦",gender:"女",style:"温柔"},{id:"aijing",name:"艾静",gender:"女",style:"温柔"},{id:"xiaomei",name:"小美",gender:"女",style:"甜美"},{id:"aina",name:"艾娜",gender:"女",style:"活泼"},{id:"yina",name:"伊娜",gender:"女",style:"知性"},{id:"sijing",name:"思静",gender:"女",style:"温柔"},{id:"sitong",name:"思彤",gender:"女",style:"儿童"},{id:"xiaobei",name:"小北",gender:"女",style:"东北话"},{id:"xiaoxue",name:"小雪",gender:"女",style:"粤语"}],St=[{id:"0",name:"度小美",gender:"女",style:"标准"},{id:"1",name:"度小宇",gender:"男",style:"标准"},{id:"3",name:"度逍遥",gender:"男",style:"武侠"},{id:"4",name:"度丫丫",gender:"女",style:"儿童"},{id:"5",name:"度小博",gender:"男",style:"新闻"},{id:"103",name:"度米朵",gender:"女",style:"儿童"},{id:"106",name:"度博文",gender:"男",style:"解说"},{id:"110",name:"度小童",gender:"女",style:"儿童"},{id:"111",name:"度小萌",gender:"女",style:"可爱"},{id:"5003",name:"度逍遥",gender:"男",style:"精品"},{id:"5118",name:"度小鹿",gender:"女",style:"甜美"}],bt=[{id:"xiaoyan",name:"小燕",gender:"女",style:"标准"},{id:"aisjiuxu",name:"许久",gender:"男",style:"磁性"},{id:"aisxping",name:"小萍",gender:"女",style:"温柔"},{id:"aisjinger",name:"靖儿",gender:"女",style:"活泼"},{id:"aisbabyxu",name:"许小宝",gender:"男",style:"儿童"}],Ct=new class{audioContext=null;currentAudio=null;getVoices(e){switch(e){case"edge":default:return vt;case"aliyun":return wt;case"baidu":return St;case"xunfei":return bt}}async synthesize(e,t){switch(t?.provider||"edge"){case"edge":default:return this.synthesizeEdge(e);case"aliyun":if(!t?.apiKey)throw new Error("阿里云 TTS 需要 API Key");return this.synthesizeAliyun(e,t);case"baidu":if(!t?.apiKey||!t?.apiSecret)throw new Error("百度 TTS 需要 API Key 和 Secret");return this.synthesizeBaidu(e,t);case"xunfei":if(!t?.appId||!t?.apiKey)throw new Error("讯飞 TTS 需要 App ID 和 API Key");return this.synthesizeXunfei(e,t)}}async synthesizeEdge(e){const{text:t,voice:a,speed:n=1,pitch:s=0,volume:r=80}=e,i=`\n      <speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="zh-CN">\n        <voice name="${a}">\n          <prosody rate="${this.mapSpeedToPercentage(n)}" pitch="${this.mapPitchToPercentage(s)}" volume="${r}%">\n            ${this.escapeXml(t)}\n          </prosody>\n        </voice>\n      </speak>\n    `;try{const s=await fetch("https://speech.platform.bing.com/synthesize",{method:"POST",headers:{"Content-Type":"application/ssml+xml","X-Microsoft-OutputFormat":"audio-16khz-128kbitrate-mono-mp3","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},body:i});if(!s.ok)return this.synthesizeWebSpeech(e);const r=await s.blob();return{audioUrl:URL.createObjectURL(r),duration:this.estimateDuration(t,n),text:t,voice:a}}catch(o){return this.synthesizeWebSpeech(e)}}async synthesizeWebSpeech(e){const{text:t,voice:a,speed:n=1,pitch:s=0,volume:r=80}=e;return new Promise((e,i)=>{if(!("speechSynthesis"in window))return void i(new Error("浏览器不支持语音合成"));const o=new SpeechSynthesisUtterance(t);o.lang="zh-CN",o.rate=n,o.pitch=1+s/10,o.volume=r/100;const l=window.speechSynthesis.getVoices().find(e=>e.name.includes("Chinese")||"zh-CN"===e.lang);l&&(o.voice=l),o.onend=()=>{const s=this.estimateDuration(t,n);e({audioUrl:"",duration:s,text:t,voice:a})},o.onerror=e=>{i(new Error(`语音合成失败: ${e}`))},window.speechSynthesis.speak(o)})}async synthesizeAliyun(e,t){const{text:a,voice:n,speed:s=1,pitch:r=0,volume:i=80}=e,o=await fetch("https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/tts",{method:"POST",headers:{"Content-Type":"application/json","X-NLS-Token":t.apiKey},body:JSON.stringify({appkey:t.apiKey,text:a,format:"mp3",sample_rate:16e3,voice:n,volume:Math.round(i),speech_rate:Math.round(100*(s-1)),pitch_rate:Math.round(10*r)})});if(!o.ok)throw new Error(`阿里云 TTS 错误: ${o.status}`);const l=await o.blob();return{audioUrl:URL.createObjectURL(l),duration:this.estimateDuration(a,s),text:a,voice:n}}async synthesizeBaidu(e,t){const{text:a,voice:n,speed:s=1,pitch:r=0,volume:i=80}=e,o=await fetch(`https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${t.apiKey}&client_secret=${t.apiSecret}`,{method:"POST"}),l=(await o.json()).access_token,d=new URLSearchParams({tex:encodeURIComponent(a),tok:l,cuid:"manga-ai",ctp:"1",lan:"zh",spd:String(Math.round(5*s)),pit:String(Math.round(r+5)),vol:String(Math.round(i/10)),per:n,aue:"3"}),c=await fetch(`https://tsn.baidu.com/text2audio?${d.toString()}`);if(!c.ok)throw new Error(`百度 TTS 错误: ${c.status}`);const u=await c.blob();return{audioUrl:URL.createObjectURL(u),duration:this.estimateDuration(a,s),text:a,voice:n}}async synthesizeXunfei(e,t){const{text:a,voice:n,speed:s=1,pitch:r=0,volume:i=80}=e;return new Promise((e,o)=>{const l=new WebSocket("wss://tts-api.xfyun.cn/v2/tts"),d=[];l.onopen=()=>{const e={common:{app_id:t.appId},business:{aue:"lame",sfl:1,auf:"audio/L16;rate=16000",vcn:n,speed:Math.round(100*s),volume:Math.round(i),pitch:Math.round(10*r),bgs:0,tte:"UTF8"},data:{status:2,text:btoa(unescape(encodeURIComponent(a)))}};l.send(JSON.stringify(e))},l.onmessage=t=>{const r=JSON.parse(t.data);if(0===r.code){if(r.data&&r.data.audio&&d.push(r.data.audio),r.data&&2===r.data.status){l.close();const t=d.join(""),r=this.base64ToBlob(t,"audio/mp3"),i=URL.createObjectURL(r),o=this.estimateDuration(a,s);e({audioUrl:i,duration:o,text:a,voice:n})}}else o(new Error(`讯飞 TTS 错误: ${r.message}`))},l.onerror=e=>{o(new Error("讯飞 TTS WebSocket 错误"))}})}play(e){return new Promise((t,a)=>{e?(this.currentAudio=new Audio(e),this.currentAudio.onended=()=>t(),this.currentAudio.onerror=()=>a(new Error("音频播放失败")),this.currentAudio.play()):a(new Error("使用浏览器原生播放"))})}stop(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null),"speechSynthesis"in window&&window.speechSynthesis.cancel()}download(e,t){const a=document.createElement("a");a.href=e,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}estimateDuration(e,t){const a=e.match(/[\u4e00-\u9fa5]/g)?.length||0,n=(a/4.5+(e.length-a)/10)/t;return Math.max(1,Math.round(n))}mapSpeedToPercentage(e){const t=Math.round(100*(e-1));return t>=0?`+${t}%`:`${t}%`}mapPitchToPercentage(e){const t=Math.round(2*e);return t>=0?`+${t}%`:`${t}%`}escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}base64ToBlob(e,t){const a=atob(e),n=new Array(a.length);for(let r=0;r<a.length;r++)n[r]=a.charCodeAt(r);const s=new Uint8Array(n);return new Blob([s],{type:t})}},Nt={},kt=function(e,t,a){if(!t||0===t.length)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(e=>{if((e=function(e){return"/"+e}(e))in Nt)return;Nt[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(a)for(let a=n.length-1;a>=0;a--){const s=n[a];if(s.href===e&&(!t||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${e}"]${s}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise((t,a)=>{r.addEventListener("load",t),r.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})},It=[{id:"realistic",name:"写实",desc:"照片级真实感"},{id:"anime",name:"动漫",desc:"日式/中式动漫风格"},{id:"3d",name:"3D 渲染",desc:"CG 渲染效果"},{id:"oil",name:"油画",desc:"油画艺术风格"},{id:"watercolor",name:"水彩",desc:"水彩画风格"},{id:"sketch",name:"素描",desc:"铅笔素描风格"},{id:"cyberpunk",name:"赛博朋克",desc:"未来科幻风格"},{id:"chinese",name:"国风",desc:"中国传统风格"},{id:"pixel",name:"像素",desc:"像素艺术风格"},{id:"minimalist",name:"极简",desc:"简约设计风格"}],Tt=[{id:"cinematic",name:"电影感",desc:"电影级画面质感"},{id:"anime",name:"动漫",desc:"动画风格"},{id:"realistic",name:"写实",desc:"真实摄影风格"},{id:"dreamy",name:"梦幻",desc:"梦幻唯美风格"},{id:"dynamic",name:"动感",desc:"快节奏运动风格"}],At={realistic:"photorealistic",anime:"anime","3d":"3d_render",oil:"oil_painting",watercolor:"watercolor",sketch:"sketch",cyberpunk:"cyberpunk",chinese:"traditional_chinese",pixel:"pixel_art",minimalist:"minimalist"},Ot={cinematic:"cinema",anime:"anime",realistic:"realistic",dreamy:"dreamy",dynamic:"dynamic"},Et=new class{tasks=new Map;pollingIntervals=new Map;async generateImage(e,t,a){const n=this.generateTaskId(),s={id:n,type:"image",provider:t.provider,status:"pending",progress:0,createdAt:Date.now(),updatedAt:Date.now()};this.tasks.set(n,s);try{let r;switch(s.status="processing",a?.(10),t.provider){case"bytedance-seedream":r=await this.generateSeedreamImage(n,e,t,a);break;case"kling":r=await this.generateKlingImage(n,e,t,a);break;default:throw new Error(`不支持的图像生成提供商: ${t.provider}`)}return s.status=r.status,s.result=r.url?{url:r.url,urls:r.urls,width:e.width||1024,height:e.height||1024,format:"png"}:void 0,s.error=r.error,s.updatedAt=Date.now(),r}catch(r){throw s.status="failed",s.error=r instanceof Error?r.message:"生成失败",s.updatedAt=Date.now(),r}}async generateVideoTask(e,t,a){const n=this.generateTaskId(),s={id:n,type:"video",provider:t.provider,status:"pending",progress:0,createdAt:Date.now(),updatedAt:Date.now()};this.tasks.set(n,s);try{let r;switch(s.status="processing",a?.(10),t.provider){case"bytedance-seedance":r=await this.generateSeedanceVideo(n,e,t,a);break;case"kling":r=await this.generateKlingVideo(n,e,t,a);break;case"vidu":r=await this.generateViduVideo(n,e,t,a);break;default:throw new Error(`不支持的视频生成提供商: ${t.provider}`)}return s.status=r.status,s.result=r.url?{url:r.url,width:"9:16"===e.aspectRatio?1080:1920,height:"9:16"===e.aspectRatio?1920:1080,duration:e.duration||5,format:"mp4"}:void 0,s.error=r.error,s.updatedAt=Date.now(),r}catch(r){throw s.status="failed",s.error=r instanceof Error?r.message:"生成失败",s.updatedAt=Date.now(),r}}async generateSeedreamImage(e,t,a,n){const{prompt:s,negativePrompt:r,width:i=1024,height:o=1024,style:l,seed:d,numImages:c=1}=t,u=await fetch("https://ark.cn-beijing.volces.com/api/v3/images/generations",{method:"POST",headers:{Authorization:`Bearer ${a.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"seedream-2-0",prompt:this.enhancePrompt(s,l),negative_prompt:r,width:i,height:o,seed:d||Math.floor(2147483647*Math.random()),n:Math.min(Math.max(c,1),4),response_format:"url",style:l?At[l]:void 0})});if(!u.ok){const e=await u.json().catch(()=>({}));throw new Error(`Seedream API 错误: ${u.status} - ${e.error?.message||"未知错误"}`)}n?.(50);const p=await u.json();if(!p.data||0===p.data.length)throw new Error("生成失败：未返回图像");return n?.(100),{taskId:e,status:"completed",url:p.data[0].url,urls:p.data.map(e=>e.url)}}async generateKlingImage(e,t,a,n){const{prompt:s,negativePrompt:r,aspectRatio:i="1:1",style:o,numImages:l=1}=t,d=await fetch("https://api.klingai.com/v1/images/generations",{method:"POST",headers:{Authorization:`Bearer ${a.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"kling-image-v1",prompt:this.enhancePrompt(s,o),negative_prompt:r,aspect_ratio:i,n:Math.min(Math.max(l,1),4),style:o?Ot[o]:void 0})});if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(`可灵 API 错误: ${d.status} - ${e.error?.message||"未知错误"}`)}const c=(await d.json()).data.task_id;return n?.(30),this.pollTask(e,c,a,"image",n)}async generateSeedanceVideo(e,t,a,n){const{prompt:s,imageUrl:r,duration:i=5,aspectRatio:o="16:9",fps:l=24}=t,d=await fetch("https://ark.cn-beijing.volces.com/api/v3/videos/generations",{method:"POST",headers:{Authorization:`Bearer ${a.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"seedance-2-0",prompt:s,image_url:r,duration:i,aspect_ratio:o,fps:l})});if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(`Seedance API 错误: ${d.status} - ${e.error?.message||"未知错误"}`)}const c=(await d.json()).id;return n?.(20),this.pollTask(e,c,a,"video",n)}async generateKlingVideo(e,t,a,n){const{prompt:s,imageUrl:r,duration:i=5,aspectRatio:o="16:9",motionStrength:l=.5}=t,d=await fetch("https://api.klingai.com/v1/videos/generations",{method:"POST",headers:{Authorization:`Bearer ${a.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"kling-video-v1",prompt:s,image:r,duration:i,aspect_ratio:o,camera_control:{motion_strength:l}})});if(!d.ok){const e=await d.json().catch(()=>({}));throw new Error(`可灵视频 API 错误: ${d.status} - ${e.error?.message||"未知错误"}`)}const c=(await d.json()).data.task_id;return n?.(20),this.pollTask(e,c,a,"video",n)}async generateViduVideo(e,t,a,n){const{prompt:s,imageUrl:r,duration:i=5,aspectRatio:o="16:9"}=t,l=await fetch("https://api.vidu.com/v1/videos/generations",{method:"POST",headers:{Authorization:`Bearer ${a.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"vidu-2-0",prompt:s,image_url:r,duration:i,aspect_ratio:o})});if(!l.ok){const e=await l.json().catch(()=>({}));throw new Error(`Vidu API 错误: ${l.status} - ${e.error?.message||"未知错误"}`)}const d=(await l.json()).data.task_id;return n?.(20),this.pollTask(e,d,a,"video",n)}async pollTask(e,t,a,n,s){return new Promise((r,i)=>{let o=0;const l=setInterval(async()=>{o++;try{const d="image"===n?`https://api.klingai.com/v1/images/generations/${t}`:this.getVideoStatusUrl(a.provider,t),c=await fetch(d,{headers:{Authorization:`Bearer ${a.apiKey}`}});if(!c.ok)return clearInterval(l),void i(new Error("查询任务状态失败"));const u=(await c.json()).data,p=Math.min(20+1.3*o,95);s?.(p);const m=this.tasks.get(e);if(m&&(m.progress=p,m.updatedAt=Date.now()),"succeeded"===u.status||"completed"===u.status){clearInterval(l),s?.(100);const t={taskId:e,status:"completed",url:u.result?.url||u.result?.video_url,urls:u.result?.urls};m&&(m.status="completed",m.progress=100,m.result={url:t.url,urls:t.urls}),r(t)}else"failed"===u.status&&(clearInterval(l),m&&(m.status="failed",m.error=u.error?.message||"生成失败"),i(new Error(u.error?.message||"生成失败")));o>=60&&(clearInterval(l),i(new Error("生成超时，请稍后查询")))}catch(d){clearInterval(l),i(d)}},5e3);this.pollingIntervals.set(e,l)})}getVideoStatusUrl(e,t){switch(e){case"bytedance-seedance":return`https://ark.cn-beijing.volces.com/api/v3/videos/generations/${t}`;case"kling":return`https://api.klingai.com/v1/videos/generations/${t}`;case"vidu":return`https://api.vidu.com/v1/videos/generations/${t}`;default:throw new Error(`未知的提供商: ${e}`)}}enhancePrompt(e,t){if(!t)return e;const a={realistic:"photorealistic, highly detailed, 8k uhd",anime:"anime style, vibrant colors, detailed illustration","3d":"3d render, octane render, blender, cgi",oil:"oil painting, artistic, textured brushstrokes",watercolor:"watercolor painting, soft colors, artistic",sketch:"pencil sketch, detailed drawing, monochrome",cyberpunk:"cyberpunk, neon lights, futuristic, sci-fi",chinese:"traditional chinese art, ink wash painting style",pixel:"pixel art, retro game style, 8-bit",minimalist:"minimalist, clean design, simple composition"}[t];return a?`${e}, ${a}`:e}getTask(e){return this.tasks.get(e)}getAllTasks(){return Array.from(this.tasks.values()).sort((e,t)=>t.createdAt-e.createdAt)}cancelTask(e){const t=this.pollingIntervals.get(e);t&&(clearInterval(t),this.pollingIntervals.delete(e));const a=this.tasks.get(e);return!(!a||"processing"!==a.status||(a.status="failed",a.error="用户取消",a.updatedAt=Date.now(),0))}deleteTask(e){return this.cancelTask(e),this.tasks.delete(e)}generateTaskId(){return`gen_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}cleanupOldTasks(e=864e5){const t=Date.now();let a=0;for(const[n,s]of this.tasks)t-s.createdAt>e&&(this.deleteTask(n),a++);return a}async generateImages(e,t){const a=(await kt(()=>Promise.resolve().then(()=>lt),void 0)).settingsService.getSettings(),n=a?.ai||{},s={provider:e.provider||t?.provider||"bytedance-seedream",apiKey:t?.apiKey||n.seedreamApiKey||"",apiSecret:t?.apiSecret||n.seedreamApiSecret,region:t?.region},r=await this.generateImage({prompt:e.prompt,negativePrompt:e.negativePrompt,width:e.width,height:e.height,aspectRatio:e.aspectRatio,style:e.style,seed:e.seed,numImages:e.numImages||e.count||1},s);if("completed"===r.status&&r.url)return r.urls&&r.urls.length>1?r.urls.map((t,a)=>({url:t,width:e.width,height:e.height})):[{url:r.url,width:e.width,height:e.height}];throw new Error(r.error||"图像生成失败")}async generateVideo(e,t){const a=(await kt(()=>Promise.resolve().then(()=>lt),void 0)).settingsService.getSettings(),n=a?.ai||{},s={provider:e.provider||t?.provider||"bytedance-seedance",apiKey:t?.apiKey||n.seedanceApiKey||"",apiSecret:t?.apiSecret||n.seedanceApiSecret,region:t?.region},r=await this.generateVideoTask({prompt:e.prompt,negativePrompt:e.negativePrompt,imageUrl:e.imageUrl,duration:e.duration,aspectRatio:e.aspectRatio,fps:e.fps,motionStrength:e.motionStrength},s);if("completed"===r.status&&r.url)return{url:r.url,duration:r.duration,width:r.width,height:r.height};throw new Error(r.error||"视频生成失败")}async editImage(e){return{data:e.image,edited:!1}}async upscaleImage(e){return{data:e.image,scale:e.scale||2}}async generateMusic(e){return{data:"",duration:e.duration||30,style:e.style}}},Pt=new class{unlistenFn=null;async checkFFmpeg(){try{const e=await I("check_ffmpeg");return{installed:e.installed,version:e.version}}catch(e){return{installed:!1}}}async analyzeVideo(e){try{return await I("analyze_video",{path:e})}catch(t){const e=t instanceof Error?t.message:"分析视频失败";throw h.error(e),t}}async extractKeyFrames(e,t=5){try{return await I("extract_key_frames",{path:e,count:t})}catch(a){const e=a instanceof Error?a.message:"提取关键帧失败";throw h.error(e),a}}async generateThumbnail(e){try{return await I("generate_thumbnail",{path:e})}catch(t){const e=t instanceof Error?t.message:"生成缩略图失败";throw h.error(e),t}}async cutVideo(e,t){t&&(this.unlistenFn=await T("cut_progress",e=>{t(e.payload)}));try{const t=await I("cut_video",{params:{input_path:e.inputPath,output_path:e.outputPath,segments:e.segments,quality:e.quality,format:e.format,transition:e.transition,transition_duration:e.transitionDuration,volume:e.volume,add_subtitles:e.addSubtitles}});return h.success("视频剪辑完成"),t}catch(a){const e=a instanceof Error?a.message:"剪辑视频失败";throw h.error(e),a}finally{this.unlistenFn&&(this.unlistenFn(),this.unlistenFn=null)}}async generatePreview(e){try{return await I("generate_preview",{params:{input_path:e.inputPath,segment:e.segment,transition:e.transition,transition_duration:e.transitionDuration,volume:e.volume,add_subtitles:e.addSubtitles}})}catch(t){const e=t instanceof Error?t.message:"生成预览失败";throw h.error(e),t}}async cleanTempFile(e){try{await I("clean_temp_file",{params:{path:e}})}catch(t){}}async openFile(e){try{await I("open_file",{path:e})}catch(t){const e=t instanceof Error?t.message:"打开文件失败";throw h.error(e),t}}formatDuration(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?`${t}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${a}:${n.toString().padStart(2,"0")}`}formatFileSize(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]}getResolutionName(e,t){return e>=3840||t>=2160?"4K":e>=1920||t>=1080?"1080p":e>=1280||t>=720?"720p":e>=854||t>=480?"480p":"SD"}getRecommendedQuality(e){const t=e.width*e.height;return t>=2073600?"high":t>=921600?"medium":"low"}async mergeVideos(e,t){try{if(void 0!==I){const a=await I("merge_videos",{videos:e,options:{transition:t?.transition||"none",transitionDuration:t?.transitionDuration||.5,outputFormat:t?.outputFormat||"mp4"}});return{data:a.path,duration:a.duration}}return{data:e[0]?.toString()||"",duration:5*e.length}}catch(a){throw new Error(`合并视频失败: ${a instanceof Error?a.message:"未知错误"}`)}}async processVideo(e){try{return void 0!==I?{data:(await I("process_video",{input:e.input,operation:e.operation,params:{startTime:e.startTime,endTime:e.endTime,effects:e.effects,width:e.width,height:e.height,outputFormat:e.outputFormat||"mp4"}})).path}:{data:"string"==typeof e.input?e.input:""}}catch(t){throw new Error(`视频处理失败: ${t instanceof Error?t.message:"未知错误"}`)}}async mergeAudioVideo(e){try{if(void 0!==I){const t=await I("merge_audio_video",{video:e.video,audios:e.audios,crossfade:e.crossfade||0});return{data:t.path,duration:t.duration}}return{data:"string"==typeof e.video?e.video:"",duration:30}}catch(t){throw new Error(`音视频合并失败: ${t instanceof Error?t.message:"未知错误"}`)}}async extractAudio(e){try{return void 0!==I?{data:(await I("extract_audio",{videoPath:e})).path}:{data:""}}catch(t){throw new Error(`提取音频失败: ${t instanceof Error?t.message:"未知错误"}`)}}async addSubtitles(e){try{return void 0!==I?{data:(await I("add_subtitles",{video:e.video,subtitles:e.subtitles,fontPath:e.fontPath,fontSize:e.fontSize||24,position:e.position||"bottom"})).path}:{data:"string"==typeof e.video?e.video:""}}catch(t){throw new Error(`添加字幕失败: ${t instanceof Error?t.message:"未知错误"}`)}}};Qe()(tt((e,t)=>({projects:[],currentProject:null,searchQuery:"",filterStatus:"all",sortBy:"updatedAt",sortOrder:"desc",exportHistory:[],filteredProjects:()=>{const e=t();let a=[...e.projects];if(e.searchQuery){const t=e.searchQuery.toLowerCase();a=a.filter(e=>e.name.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t))}return"all"!==e.filterStatus&&(a=a.filter(t=>t.status===e.filterStatus)),a.sort((t,a)=>{let n=0;switch(e.sortBy){case"name":n=t.name.localeCompare(a.name);break;case"createdAt":n=new Date(t.createdAt).getTime()-new Date(a.createdAt).getTime();break;default:n=new Date(t.updatedAt).getTime()-new Date(a.updatedAt).getTime()}return"asc"===e.sortOrder?n:-n}),a},recentProjects:()=>t().projects.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()).slice(0,10),createProject:t=>{const a={id:`project_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:t.name||"未命名项目",description:t.description||"",status:"draft",videos:[],scripts:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),...t};return e(e=>({projects:[...e.projects,a],currentProject:a})),ut.projects.save(a),a},updateProject:(t,a)=>{e(e=>{const n=e.projects.map(e=>e.id===t?{...e,...a,updatedAt:(new Date).toISOString()}:e),s=n.find(e=>e.id===t);return s&&ut.projects.save(s),{projects:n,currentProject:e.currentProject?.id===t?s||null:e.currentProject}})},deleteProject:t=>{e(e=>({projects:e.projects.filter(e=>e.id!==t),currentProject:e.currentProject?.id===t?null:e.currentProject})),ut.projects.delete(t)},setCurrentProject:t=>{e({currentProject:t})},loadProject:a=>{const n=t().projects.find(e=>e.id===a);return n&&e({currentProject:n}),n||null},addScript:(t,a)=>{e(e=>{const n=e.projects.map(e=>e.id===t?{...e,scripts:[...e.scripts,a],updatedAt:(new Date).toISOString()}:e),s=n.find(e=>e.id===t);return s&&ut.projects.save(s),{projects:n,currentProject:e.currentProject?.id===t?s||null:e.currentProject}})},updateScript:(t,a,n)=>{e(e=>{const s=e.projects.map(e=>e.id===t?{...e,scripts:e.scripts.map(e=>e.id===a?{...e,...n,updatedAt:(new Date).toISOString()}:e),updatedAt:(new Date).toISOString()}:e),r=s.find(e=>e.id===t);return r&&ut.projects.save(r),{projects:s,currentProject:e.currentProject?.id===t?r||null:e.currentProject}})},deleteScript:(t,a)=>{e(e=>{const n=e.projects.map(e=>e.id===t?{...e,scripts:e.scripts.filter(e=>e.id!==a),updatedAt:(new Date).toISOString()}:e),s=n.find(e=>e.id===t);return s&&ut.projects.save(s),{projects:n,currentProject:e.currentProject?.id===t?s||null:e.currentProject}})},addVideo:(t,a)=>{e(e=>{const n=e.projects.map(e=>e.id===t?{...e,videos:[...e.videos,a],updatedAt:(new Date).toISOString()}:e),s=n.find(e=>e.id===t);return s&&ut.projects.save(s),{projects:n,currentProject:e.currentProject?.id===t?s||null:e.currentProject}})},removeVideo:(t,a)=>{e(e=>{const n=e.projects.map(e=>e.id===t?{...e,videos:e.videos.filter(e=>e.id!==a),updatedAt:(new Date).toISOString()}:e),s=n.find(e=>e.id===t);return s&&ut.projects.save(s),{projects:n,currentProject:e.currentProject?.id===t?s||null:e.currentProject}})},setSearchQuery:t=>e({searchQuery:t}),setFilterStatus:t=>e({filterStatus:t}),setSortBy:t=>e({sortBy:t}),setSortOrder:t=>e({sortOrder:t}),addExportRecord:t=>{e(e=>({exportHistory:[t,...e.exportHistory].slice(0,100)})),ut.exportHistory.add(t)},clearExportHistory:()=>{e({exportHistory:[]}),ut.exportHistory.clear()},exportProject:e=>{const a=t().projects.find(t=>t.id===e);return a?JSON.stringify(a,null,2):""},importProject:t=>{try{const a=JSON.parse(t);return a.id=`${a.id}_imported_${Date.now()}`,a.createdAt=(new Date).toISOString(),a.updatedAt=(new Date).toISOString(),e(e=>({projects:[...e.projects,a],currentProject:a})),ut.projects.save(a),a}catch{return null}}}),{name:"reelforge-project-storage",partialize:e=>({projects:e.projects,exportHistory:e.exportHistory})}));const $t={autoSave:!0,autoSaveInterval:30,defaultVideoQuality:"high",defaultOutputFormat:"mp4",enablePreview:!0,previewQuality:"medium",notifications:!0,soundEffects:!0};Qe()(tt((e,t)=>({userId:null,username:null,email:null,avatar:null,preferences:{...$t},apiSettings:{},recentFiles:[],setUser:t=>e(e=>({...e,...t})),clearUser:()=>e({userId:null,username:null,email:null,avatar:null}),updatePreferences:t=>{e(e=>{const a={...e.preferences,...t};return ut.preferences.set(a),{preferences:a}})},resetPreferences:()=>{e({preferences:{...$t}}),ut.preferences.reset()},setApiSettings:(t,a)=>{e(e=>{const n={...e.apiSettings,[t]:a};return ut.modelSettings.set(t,a),{apiSettings:n}})},removeApiSettings:t=>{e(e=>{const{[t]:a,...n}=e.apiSettings;return ut.modelSettings.delete(t),{apiSettings:n}})},getApiSettings:e=>t().apiSettings[e]||null,addRecentFile:t=>{e(e=>{const a=[t,...e.recentFiles.filter(e=>e!==t)].slice(0,20);return ut.recentFiles.add(t),{recentFiles:a}})},removeRecentFile:t=>{e(e=>{const a=e.recentFiles.filter(e=>e!==t);return ut.recentFiles.remove(t),{recentFiles:a}})},clearRecentFiles:()=>{e({recentFiles:[]}),ut.recentFiles.clear()}}),{name:"reelforge-user-storage",partialize:e=>({userId:e.userId,username:e.username,email:e.email,avatar:e.avatar,preferences:e.preferences,apiSettings:e.apiSettings,recentFiles:e.recentFiles})}));const Dt=Qe()(tt(e=>({selectedAIModel:"wenxin",aiModelsSettings:{wenxin:{enabled:!1},qianwen:{enabled:!1},spark:{enabled:!1},chatglm:{enabled:!1},doubao:{enabled:!1},deepseek:{enabled:!1}},setSelectedAIModel:t=>e({selectedAIModel:t}),updateAIModelSettings:(t,a)=>e(e=>({aiModelsSettings:{...e.aiModelsSettings,[t]:{...e.aiModelsSettings[t],...a}}})),autoSave:!0,setAutoSave:t=>e({autoSave:t}),isDarkMode:!1,setIsDarkMode:t=>e({isDarkMode:t})}),{name:"nova-store",partialize:e=>({selectedAIModel:e.selectedAIModel,aiModelsSettings:e.aiModelsSettings,autoSave:e.autoSave,isDarkMode:e.isDarkMode})})),Mt=({name:e,duration:a,path:n,metadata:s})=>{return t.jsx(Card,{title:"视频信息",className:"_container_cjwru_1",children:t.jsxs(Row,{gutter:[16,16],children:[t.jsx(Col,{span:8,children:t.jsx(Statistic,{title:"视频名称",value:e,valueStyle:{fontSize:"16px"},prefix:t.jsx(FileOutlined,{})})}),t.jsx(Col,{span:8,children:t.jsx(Statistic,{title:"时长",value:(r=a,r?`${Math.floor(r/60)}:${Math.floor(r%60).toString().padStart(2,"0")}`:"未知"),valueStyle:{fontSize:"16px"},prefix:t.jsx(ClockCircleOutlined,{})})}),t.jsx(Col,{span:8,children:t.jsx(Statistic,{title:"源文件",value:(e=>{const t=e.split(/[/\\]/);return t[t.length-1]})(n),valueStyle:{fontSize:"16px",overflow:"hidden",textOverflow:"ellipsis"},prefix:t.jsx(VideoCameraOutlined,{})})}),s&&t.jsxs(t.Fragment,{children:[s.width&&s.height&&t.jsx(Col,{span:8,children:t.jsx(Statistic,{title:"分辨率",value:`${s.width} x ${s.height}`,valueStyle:{fontSize:"16px"}})}),s.fps&&t.jsx(Col,{span:8,children:t.jsx(Statistic,{title:"帧率",value:`${s.fps.toFixed(2)} FPS`,valueStyle:{fontSize:"16px"}})}),s.codec&&t.jsx(Col,{span:8,children:t.jsx(Statistic,{title:"编码",value:s.codec,valueStyle:{fontSize:"16px"}})})]})]})});var r},zt="_segmentResizeHandle_1mlzw_59",Bt="_settingItem_1mlzw_105",{Text:Ft,Title:Lt,Paragraph:Rt}=p,{Option:qt}=k,{TabPane:Wt}=y,Vt=[{value:"none",label:"无转场"},{value:"fade",label:"淡入淡出"},{value:"dissolve",label:"交叉溶解"},{value:"wipe",label:"擦除效果"},{value:"slide",label:"滑动效果"}];let Kt=0;const Ut=({videoPath:a,segments:n,onEditComplete:s})=>{const r=e.useRef(null),[i,o]=e.useState(0),[l,d]=e.useState(0),[c,u]=e.useState(!1),[p,m]=e.useState(!1),[g,y]=e.useState(0),[x,j]=e.useState(null),[f,_]=e.useState("medium"),[v,w]=e.useState("mp4"),[S,b]=e.useState(!1),[C,N]=e.useState(!1),[k,I]=e.useState(null),[T,A]=e.useState(!1),[O,E]=e.useState(""),[P,$]=e.useState("fade"),[D,M]=e.useState(1),[z,B]=e.useState(100),[F,L]=e.useState("general"),[R,q]=e.useState(!0),[W,V]=e.useState(!1),[K,U]=e.useState(null),[H,X]=e.useState(null),[Y,Z]=e.useState(n),ee=e.useRef(null);e.useEffect(()=>{Z(n)},[n]),e.useEffect(()=>{const e=r.current;if(!e)return;const t=()=>{d(e.duration),Kt=e.duration};return e.addEventListener("loadedmetadata",t),e.readyState>=2&&(d(e.duration),Kt=e.duration),()=>{e.removeEventListener("loadedmetadata",t)}},[]),e.useEffect(()=>{const e=r.current;if(!e)return;const t=()=>{o(e.currentTime)};return e.addEventListener("timeupdate",t),()=>{e.removeEventListener("timeupdate",t)}},[]),e.useEffect(()=>()=>{O&&O.includes("temp")&&J("clean_temp_file",{path:O}).catch(e=>{})},[O]);const te=e=>{const t=r.current;t&&(t.currentTime=e,o(e))},ae=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,ne=()=>{N(!1),E(""),I(null)},se=()=>{b(!0)},re=(e,t,a)=>{a.stopPropagation(),V(!0),U(t),X(e),document.addEventListener("mousemove",ie),document.addEventListener("mouseup",oe)},ie=e=>{if(!W||!H||!K)return;const t=(e=>{if(!ee.current)return 0;const t=ee.current.getBoundingClientRect(),a=e-t.left;return Math.max(0,Math.min(1,a/t.width))*l})(e.clientX);Z(e=>e.map(e=>{if(e.id!==H)return e;const a=e;let n=a.startTime,s=a.endTime;switch(K){case"move":{const e=a.endTime-a.startTime;n=t,s=t+e,n<0&&(n=0,s=e),s>Kt&&(s=Kt,n=s-e);break}case"start":n=Math.min(t,a.endTime-.5),n=Math.max(0,n);break;case"end":s=Math.max(t,a.startTime+.5),s=Math.min(l,s)}return{...e,startTime:n,endTime:s}}))},oe=()=>{V(!1),U(null),X(null),document.removeEventListener("mousemove",ie),document.removeEventListener("mouseup",oe)};return t.jsxs("div",{className:"_editorContainer_1mlzw_1",children:[t.jsx(Lt,{level:4,children:"视频混剪编辑器"}),t.jsxs(Card,{children:[t.jsx("div",{className:"_videoContainer_1mlzw_7",children:t.jsx("video",{ref:r,src:`file://${a}`,onEnded:()=>u(!1),preload:"metadata",className:"_videoPlayer_1mlzw_15"})}),t.jsxs("div",{className:"_controlsContainer_1mlzw_78",children:[t.jsx(Button,{type:"text",icon:c?t.jsx(PauseCircleOutlined,{}):t.jsx(PlayCircleOutlined,{}),onClick:()=>{const e=r.current;e&&(c?e.pause():e.play(),u(!c))},size:"large"}),t.jsx(Ft,{children:ae(i)}),t.jsx("div",{className:"_sliderContainer_1mlzw_84",children:t.jsx(Slider,{min:0,max:l,value:i,onChange:te,step:.1,tooltip:{formatter:e=>ae(e||0)}})}),t.jsx(Ft,{children:ae(l)})]}),t.jsx("div",{className:"_timelineContainer_1mlzw_20",ref:ee,children:Y.map((e,a)=>{const{left:n,width:s,color:r}=(e=>{const t=e.startTime/l*100+"%",a=(e.endTime-e.startTime)/l*100+"%";let n="#1890ff";return"dialogue"===e.type?n="#52c41a":"description"===e.type&&(n="#fa8c16"),{left:t,width:a,color:n}})(e);return t.jsx(Tooltip,{title:`${ae(e.startTime)} - ${ae(e.endTime)}: ${e.content.substring(0,50)}${e.content.length>50?"...":""}`,children:t.jsxs("div",{className:"_segmentMarker_1mlzw_29",style:{left:n,width:s,backgroundColor:r},onClick:()=>(e=>{te(e.startTime),j(e)})(e),children:[t.jsx("div",{className:zt,style:{left:0},onMouseDown:t=>re(e.id,"start",t)}),t.jsx("div",{className:"_segmentContent_1mlzw_51",onMouseDown:t=>re(e.id,"move",t),children:a+1}),t.jsx("div",{className:zt,style:{right:0},onMouseDown:t=>re(e.id,"end",t)})]})},e.id)})}),x&&t.jsx(Card,{size:"small",style:{marginTop:10},children:t.jsx("div",{className:"_segmentDetails_1mlzw_102",children:t.jsxs(Row,{gutter:16,children:[t.jsxs(Col,{span:6,children:[t.jsx(Ft,{strong:!0,children:"时间: "}),t.jsxs(Ft,{children:[ae(x.startTime)," - ",ae(x.endTime)]})]}),t.jsxs(Col,{span:4,children:[t.jsx(Ft,{strong:!0,children:"类型: "}),t.jsx(Ft,{children:"narration"===x.type?"旁白":"dialogue"===x.type?"对话":"描述"})]}),t.jsxs(Col,{span:12,children:[t.jsx(Ft,{strong:!0,children:"内容: "}),t.jsx(Ft,{children:x.content})]}),t.jsx(Col,{span:2,children:t.jsx(Button,{type:"primary",icon:t.jsx(EyeOutlined,{}),size:"small",onClick:()=>(async e=>{A(!0),I(e),N(!0);try{const t=G(await J("generate_preview",{inputPath:a,segment:{start:e.startTime,end:e.endTime,type:e.type},transition:P,transitionDuration:D,volume:z/100,addSubtitles:R}));E(t)}catch(t){h.error("生成预览失败: "+t)}finally{A(!1)}})(x),children:"预览"})})]})})}),t.jsxs("div",{className:"_editorControls_1mlzw_88",children:[t.jsxs(Space,{children:[t.jsx(Button,{type:"primary",icon:t.jsx(ScissorOutlined,{}),onClick:se,disabled:p||0===Y.length,children:"生成混剪视频"}),t.jsx(Button,{icon:t.jsx(SettingOutlined,{}),onClick:se,disabled:p,children:"导出设置"}),t.jsx(Button,{icon:t.jsx(SaveOutlined,{}),onClick:()=>{s&&s(Y),h.success("片段时间已更新")},disabled:p,children:"保存片段时间"})]}),p&&t.jsxs("div",{className:"_progressContainer_1mlzw_110",children:[t.jsx(Progress,{percent:g,status:"active",style:{width:200}}),t.jsx(Ft,{className:"_progressText_1mlzw_115",children:g<30?"准备片段...":g<70?"处理视频中...":g<90?"合成最终视频...":"完成中..."})]})]})]}),t.jsx(Modal,{title:"视频导出设置",open:S,onOk:async()=>{if(b(!1),Y&&0!==Y.length)try{const e=await Q({defaultPath:`剪辑_${(new Date).toISOString().split("T")[0]}.${v}`,filters:[{name:"视频文件",extensions:[v]}]});if(!e)return;m(!0),y(0);const t=await window.__TAURI__.event.listen("cut_progress",e=>{y(Math.round(100*e.payload))});await J("cut_video",{inputPath:a,outputPath:e,segments:Y.map(e=>({start:e.startTime,end:e.endTime,type:e.type,content:e.content})),quality:f,format:v,transition:P,transitionDuration:D,volume:z/100,addSubtitles:R}).catch(e=>(h.error("视频剪辑失败: "+e),m(!1),null)),t(),s&&s(e),h.success("视频剪辑完成")}catch(e){h.error("导出视频失败")}finally{m(!1)}else h.warning("没有可用的脚本片段来剪辑视频")},onCancel:()=>b(!1),okText:"开始导出",cancelText:"取消",width:600,children:t.jsxs(Tabs,{activeKey:F,onChange:L,children:[t.jsx(Wt,{tab:"基本设置",children:t.jsxs(Space,{direction:"vertical",style:{width:"100%"},children:[t.jsxs("div",{className:Bt,children:[t.jsx(Ft,{strong:!0,children:"视频质量:"}),t.jsxs(Select,{value:f,onChange:_,style:{width:200,marginLeft:10},children:[t.jsx(qt,{value:"low",children:"低质量 (720p)"}),t.jsx(qt,{value:"medium",children:"中等质量 (1080p)"}),t.jsx(qt,{value:"high",children:"高质量 (原始分辨率)"})]})]}),t.jsxs("div",{className:Bt,children:[t.jsx(Ft,{strong:!0,children:"导出格式:"}),t.jsxs(Select,{value:v,onChange:w,style:{width:200,marginLeft:10},children:[t.jsx(qt,{value:"mp4",children:"MP4 格式"}),t.jsx(qt,{value:"mov",children:"MOV 格式"}),t.jsx(qt,{value:"mkv",children:"MKV 格式"})]})]}),t.jsxs("div",{className:Bt,children:[t.jsx(Ft,{strong:!0,children:"添加字幕:"}),t.jsxs(Radio.Group,{value:R,onChange:e=>q(e.target.value),style:{marginLeft:10},children:[t.jsx(Radio,{value:!0,children:"是"}),t.jsx(Radio,{value:!1,children:"否"})]})]})]})},"general"),t.jsxs(Wt,{tab:"高级设置",children:[t.jsxs(Space,{direction:"vertical",style:{width:"100%"},children:[t.jsxs("div",{className:Bt,children:[t.jsx(Ft,{strong:!0,children:"转场效果:"}),t.jsx(Select,{value:P,onChange:e=>$(e),style:{width:200,marginLeft:10},options:Vt})]}),t.jsxs("div",{className:Bt,children:[t.jsx(Ft,{strong:!0,children:"转场时长(秒):"}),t.jsx(InputNumber,{value:D,onChange:e=>null!==e&&M(e),min:.2,max:3,step:.1,style:{width:200,marginLeft:10}})]}),t.jsxs("div",{className:Bt,children:[t.jsx(Ft,{strong:!0,children:"音频音量:"}),t.jsxs(Row,{style:{width:200,marginLeft:10,display:"flex",alignItems:"center"},children:[t.jsx(Col,{span:18,children:t.jsx(Slider,{value:z,onChange:B,min:0,max:150,step:5})}),t.jsx(Col,{span:6,style:{textAlign:"right"},children:t.jsx(InputNumber,{value:z,onChange:e=>null!==e&&B(e),min:0,max:150,step:5,style:{marginLeft:8,width:60},addonAfter:"%"})})]})]})]}),t.jsx(Alert,{message:"高级设置说明",description:"转场效果会在片段之间添加流畅过渡，可能会稍微增加处理时间。音频音量调整可以让您控制整个视频的音量大小，100%表示保持原音量不变。",type:"info",showIcon:!0,style:{marginTop:16}})]},"advanced")]})}),t.jsx(Modal,{title:"片段预览",open:C,onCancel:ne,footer:[t.jsx(Button,{onClick:ne,children:"关闭"},"close")],width:800,children:T?t.jsx("div",{className:"_previewLoading_1mlzw_120",children:t.jsx(Spin,{tip:"生成预览中..."})}):O?t.jsxs("div",{className:"_previewContainer_1mlzw_126",children:[t.jsx("video",{controls:!0,autoPlay:!0,src:O,className:"_previewVideo_1mlzw_129"}),k&&t.jsxs("div",{className:"_previewInfo_1mlzw_136",children:[t.jsxs(Rt,{children:[t.jsx(Ft,{strong:!0,children:"时间段: "}),t.jsxs(Ft,{children:[ae(k.startTime)," - ",ae(k.endTime)]})]}),t.jsxs(Rt,{children:[t.jsx(Ft,{strong:!0,children:"内容: "}),t.jsx(Ft,{children:k.content})]})]})]}):t.jsx("div",{className:"_previewError_1mlzw_142",children:t.jsx(Ft,{type:"danger",children:"无法生成预览，请重试"})})})]})},{Title:Ht,Text:Jt}=p,{TabPane:Gt}=y,{Option:Xt}=k,Yt=()=>{const{id:n}=s(),r=a(),{projects:i,updateProject:o,deleteProject:l,selectedAIModel:d,aiModelsSettings:c}=Dt(),[u,p]=e.useState(!0),[m,g]=e.useState(!1),[y,x]=e.useState(null),[j,f]=e.useState(null),[_,v]=e.useState("简洁专业"),[w,b]=e.useState("scripts");e.useEffect(()=>{if(!n)return;const e=i.find(e=>e.id===n);e?(x(e),e.scripts&&e.scripts.length>0&&f(e.scripts[0])):(h.error("找不到项目信息"),r("/projects")),p(!1)},[n,i,r]);const N=e=>{if(y&&j)try{const t={...j,content:e,updatedAt:(new Date).toISOString()},a=y.scripts.map(e=>e.id===j.id?t:e),n={...y,scripts:a,updatedAt:(new Date).toISOString()};x(n),f(t),ue(n).then(()=>{o(n),h.success("脚本内容已保存")}).catch(e=>{h.error("保存项目文件失败: "+(e instanceof Error?e.message:"未知错误")),x(y),f(j)})}catch(t){h.error("更新脚本内容失败")}};return u?t.jsx(Spin,{size:"large",tip:"加载中..."}):y?t.jsxs("div",{className:"_container_1kcxt_1",children:[t.jsxs("div",{className:"_header_1kcxt_4",children:[t.jsxs(Space,{children:[t.jsx(Button,{icon:t.jsx(ArrowLeftOutlined,{}),onClick:()=>r("/projects"),children:"返回项目列表"}),t.jsx(Button,{icon:t.jsx(EditOutlined,{}),onClick:()=>r(`/projects/${n}/edit`),children:"编辑项目"}),t.jsx(Button,{icon:t.jsx(ExportOutlined,{}),onClick:async()=>{if(y&&j)try{await pe({projectName:y.name,createdAt:j.createdAt,segments:j.content},`${y.name}_脚本.txt`)}catch(e){}else h.warning("没有可导出的脚本")},disabled:!j||!j.content||0===j.content.length,children:"导出脚本"}),t.jsx(Button,{danger:!0,icon:t.jsx(DeleteOutlined,{}),onClick:()=>{S.confirm({title:"确认删除",content:"确定要删除此项目吗？此操作不可撤销。",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{if(n)try{l(n),h.success("项目已删除"),r("/projects")}catch(e){h.error("删除项目失败")}}})},children:"删除项目"})]}),t.jsx(Ht,{level:2,children:y.name})]}),y.description&&t.jsx(Card,{className:"_descriptionCard_1kcxt_12",children:t.jsx(Jt,{children:y.description})}),t.jsx(Mt,{name:y.name,path:y.videoUrl,duration:y.analysis?.duration||0}),t.jsx(Card,{className:"_functionCard_1kcxt_58",children:t.jsxs(Tabs,{activeKey:w,onChange:b,size:"large",children:[t.jsx(Gt,{tab:t.jsxs("span",{children:[t.jsx(RobotOutlined,{}),"脚本生成"]}),children:t.jsxs("div",{className:"_scriptSection_1kcxt_15",children:[t.jsxs("div",{className:"_scriptHeader_1kcxt_18",children:[t.jsx(Ht,{level:4,children:"脚本编辑"}),t.jsxs(Space,{children:[t.jsx(Form.Item,{label:"脚本风格",style:{marginBottom:0},children:t.jsxs(Select,{value:_,onChange:e=>v(e),style:{width:120},children:[t.jsx(Xt,{value:"简洁专业",children:"简洁专业"}),t.jsx(Xt,{value:"生动活泼",children:"生动活泼"}),t.jsx(Xt,{value:"幽默风趣",children:"幽默风趣"}),t.jsx(Xt,{value:"严肃正式",children:"严肃正式"}),t.jsx(Xt,{value:"通俗易懂",children:"通俗易懂"})]})}),t.jsx(Button,{type:"primary",icon:m?t.jsx(LoadingOutlined,{}):t.jsx(RobotOutlined,{}),onClick:async()=>{if(y&&y.analysis)try{g(!0);const e=c[d];if(!e?.enabled)return h.warning(`${d}模型未启用，请在设置中启用该模型`),void g(!1);const t=await ge(d);if(!t)return h.warning(`缺少${d}的API密钥，请在设置中配置`),void g(!1);h.loading(`正在使用${d}生成脚本...`,0);const a=await(async(e,t,a,n)=>{switch(e){case"wenxin":return fe.wenxinGenerateScript(t,a,n);case"qianwen":return fe.qianwenGenerateScript(t,a,n);case"spark":return fe.sparkGenerateScript(t,a,n);case"chatglm":return fe.chatglmGenerateScript(t,a,n);case"doubao":return fe.doubaoGenerateScript(t,a,n);case"deepseek":return fe.deepseekGenerateScript(t,a,n);default:throw new ye(`不支持的AI模型类型: ${e}`)}})(d,t,y.analysis,{style:_}),n={...((e,t)=>{const a=e.split("\n").filter(e=>e.trim().length>0),n=[],s=C(),r=/\[(\d{1,2}):(\d{2})\]/;let i={},o="";for(const l of a){const e=l.match(r);if(e){o.trim()&&n.push({id:C(),startTime:i.startTime||0,endTime:i.endTime||0,content:o.trim(),type:"narration"});const t=60*parseInt(e[1])+parseInt(e[2]);i={startTime:t,endTime:t+10},o=l.replace(r,"").trim()}else void 0!==i.startTime&&(o+=" "+l.trim())}o.trim()&&void 0!==i.startTime&&n.push({id:C(),startTime:i.startTime||0,endTime:i.endTime||0,content:o.trim(),type:"narration"});for(let l=0;l<n.length-1;l++)n[l].endTime=n[l+1].startTime;return{id:s,projectId:t,content:n,fullText:n.map(e=>e.content).join("\n\n"),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}})(a,y.id),modelUsed:d},s={...y,scripts:[...y.scripts||[],n],updatedAt:(new Date).toISOString()};x(s),f(n),o(s),await ue(s),h.success(`使用${d}生成脚本成功`)}catch(e){h.error("生成脚本失败: "+(e instanceof Error?e.message:"未知错误"))}finally{g(!1)}else h.warning("项目缺少视频分析数据，无法生成脚本")},loading:m,disabled:!y.analysis||m,children:"AI生成脚本"}),t.jsx(Button,{icon:m?t.jsx(LoadingOutlined,{}):t.jsx(RobotOutlined,{}),onClick:async()=>{if(y&&j)if(j.content&&0!==j.content.length)try{g(!0);const e=await polishScript(j,_),t=y.scripts.map(t=>t.id===j.id?e:t),a={...y,scripts:t,updatedAt:(new Date).toISOString()};x(a),f(e),o(a),await ue(a),h.success("脚本优化成功")}catch(e){h.error("优化脚本失败: "+e.message)}finally{g(!1)}else h.warning("脚本内容为空，无法优化");else h.warning("没有选择脚本")},loading:m,disabled:!j||!j.content||0===j.content.length||m,children:"优化脚本"}),t.jsx(Button,{icon:t.jsx(PlusOutlined,{}),onClick:()=>{if(y)try{const e={id:C(),videoId:y.id,content:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},t={...y,scripts:[...y.scripts||[],e],updatedAt:(new Date).toISOString()};x(t),f(e),h.loading("正在保存脚本...",.5),ue(t).then(()=>{o(t),h.success("脚本创建成功")}).catch(e=>{h.error("保存项目文件失败: "+(e instanceof Error?e.message:"未知错误")),x(y),f(y.scripts?.[0]||null)})}catch(e){h.error("创建脚本失败")}},children:"创建空白脚本"})]})]}),y.scripts&&y.scripts.length>0?t.jsx(t.Fragment,{children:t.jsx(Tabs,{activeKey:j?.id,onChange:e=>{const t=y.scripts.find(t=>t.id===e);t&&f(t)},children:y.scripts.map(e=>t.jsx(Gt,{tab:`脚本 ${new Date(e.createdAt).toLocaleDateString()}`,children:t.jsx(se,{segments:e.content||[],onSegmentsChange:N})},e.id))})}):t.jsx(Card,{children:t.jsx("div",{className:"_emptyScript_1kcxt_29",children:t.jsx(Jt,{type:"secondary",children:'暂无脚本，点击"AI生成脚本"或"创建空白脚本"按钮添加'})})})]})},"scripts"),t.jsx(Gt,{tab:t.jsxs("span",{children:[t.jsx(ScissorOutlined,{}),"视频混剪"]}),children:j&&j.content&&j.content.length>0?t.jsx(Ut,{videoPath:y.videoUrl,segments:j.content,onEditComplete:e=>{h.success(`视频混剪完成，已保存至: ${e}`)}}):t.jsx(Card,{children:t.jsxs("div",{className:"_emptyEditor_1kcxt_62",children:[t.jsx(Ht,{level:4,children:"请先生成或编辑脚本"}),t.jsx(Jt,{type:"secondary",children:'视频混剪功能需要基于已有脚本进行。请先在"脚本生成"选项卡中创建或生成脚本， 然后再来使用视频混剪功能。'}),t.jsx(Button,{type:"primary",onClick:()=>b("scripts"),icon:t.jsx(RobotOutlined,{}),style:{marginTop:16},children:"去生成脚本"})]})})},"videoEdit")]})})]}):t.jsx("div",{children:"项目不存在"})},{Title:Qt,Text:Zt}=p,ea=()=>{const{projectId:n,scriptId:r}=s(),i=a(),{projects:o,updateProject:l}=Dt(),[d,c]=e.useState(!0),[u,p]=e.useState(null),[m,g]=e.useState(null),[y,x]=e.useState([]);return e.useEffect(()=>{if(!n||!r)return h.error("参数错误"),void i("/projects");const e=o.find(e=>e.id===n);if(!e)return h.error("找不到项目"),void i("/projects");const t=e.scripts?.find(e=>e.id===r);if(!t)return h.error("找不到脚本"),void i(`/projects/${n}`);p(e),g(t),x(t.content||[]),c(!1)},[n,r,o,i]),d?t.jsx(Spin,{size:"large",tip:"加载中..."}):u&&m?t.jsxs("div",{className:"_container_lxtuu_1",children:[t.jsx("div",{className:"_header_lxtuu_4",children:t.jsxs(Space,{children:[t.jsx(Button,{icon:t.jsx(ArrowLeftOutlined,{}),onClick:()=>i(`/projects/${u.id}`),children:"返回项目"}),t.jsx(Button,{type:"primary",icon:t.jsx(SaveOutlined,{}),onClick:async()=>{if(u&&m)try{c(!0);const e={...m,content:y,updatedAt:(new Date).toISOString()},t=u.scripts.map(t=>t.id===m.id?e:t),a={...u,scripts:t,updatedAt:(new Date).toISOString()};p(a),g(e),l(a),await ue(a),h.success("保存成功")}catch(e){h.error("保存失败")}finally{c(!1)}},children:"保存"}),t.jsx(Button,{icon:t.jsx(ExportOutlined,{}),onClick:async()=>{if(u&&m)try{await pe({projectName:u.name,createdAt:m.createdAt,segments:y},`${u.name}_脚本_${(new Date).toISOString().slice(0,10)}.txt`)}catch(e){h.error("导出失败")}},disabled:0===y.length,children:"导出"}),t.jsx(Button,{danger:!0,icon:t.jsx(DeleteOutlined,{}),onClick:()=>{u&&m&&S.confirm({title:"确认删除",content:"确定要删除这个脚本吗？此操作不可撤销。",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{const e=u.scripts.filter(e=>e.id!==m.id),t={...u,scripts:e,updatedAt:(new Date).toISOString()};l(t),await ue(t),h.success("删除成功"),i(`/projects/${u.id}`)}catch(e){h.error("删除失败")}}})},children:"删除"})]})}),t.jsxs(Card,{className:"_infoCard_lxtuu_9",children:[t.jsxs(Qt,{level:4,children:[u.name," - 脚本编辑"]}),t.jsxs("div",{className:"_scriptInfo_lxtuu_33",children:[t.jsxs(Zt,{type:"secondary",children:["创建于 ",new Date(m.createdAt).toLocaleString()]}),m.modelUsed&&t.jsxs(Tag,{color:"blue",icon:t.jsx(RobotOutlined,{}),className:"_modelTag_lxtuu_39",children:["由 ",m.modelUsed," 生成"]})]}),t.jsx(Divider,{}),t.jsx("div",{className:"_stats_lxtuu_12",children:t.jsxs(Space,{children:[t.jsxs(Zt,{children:["片段数量: ",y.length]}),t.jsxs(Zt,{children:["总时长: ",y.reduce((e,t)=>e+(t.endTime-t.startTime),0)," 秒"]})]})})]}),t.jsx("div",{className:"_editorContainer_lxtuu_15",children:t.jsx(se,{segments:y,onSegmentsChange:e=>{x(e)}})})]}):t.jsx("div",{children:"资源不存在"})},ta={editorLayout:"_editorLayout_1m84j_1",editorContent:"_editorContent_1m84j_5",toolbar:"_toolbar_1m84j_8",leftTools:"_leftTools_1m84j_17",rightTools:"_rightTools_1m84j_18",playerCard:"_playerCard_1m84j_22",playerWrapper:"_playerWrapper_1m84j_27",videoPlayer:"_videoPlayer_1m84j_33",emptyPlayer:"_emptyPlayer_1m84j_38",playerControls:"_playerControls_1m84j_46",timeDisplay:"_timeDisplay_1m84j_58",progressBar:"_progressBar_1m84j_62",timelineContainer:"_timelineContainer_1m84j_65",timeline:"_timeline_1m84j_65",timelineSegment:"_timelineSegment_1m84j_79",selected:"_selected_1m84j_91",segmentLabel:"_segmentLabel_1m84j_96",segmentHandle:"_segmentHandle_1m84j_100",playhead:"_playhead_1m84j_113",segmentList:"_segmentList_1m84j_132",segmentCard:"_segmentCard_1m84j_135",segmentHeader:"_segmentHeader_1m84j_149",segmentTime:"_segmentTime_1m84j_155",segmentContent:"_segmentContent_1m84j_158",addSegmentButton:"_addSegmentButton_1m84j_161",keyframesContainer:"_keyframesContainer_1m84j_164",keyframeList:"_keyframeList_1m84j_167",keyframeItem:"_keyframeItem_1m84j_173",keyframeImage:"_keyframeImage_1m84j_178",settingsPanel:"_settingsPanel_1m84j_183",settingCard:"_settingCard_1m84j_186",settingItem:"_settingItem_1m84j_189",editorTabs:"_editorTabs_1m84j_198",sectionTitle:"_sectionTitle_1m84j_203"},{Content:aa}=u,{Title:na,Text:sa}=p,{TabPane:ra}=y,ia=()=>{const{projectId:n}=s();a();const[r,i]=e.useState(""),[o,l]=e.useState(!1),[d,c]=e.useState(!1),[u,p]=e.useState(0),[g,y]=e.useState(0),[x,j]=e.useState([]),[f,_]=e.useState([]),[v,w]=e.useState("trim"),[S,b]=e.useState([]),[C,N]=e.useState(-1),[k,I]=e.useState(-1),[T,A]=e.useState(!1),[O,E]=e.useState(!1),[P,$]=e.useState("mp4"),[D,M]=e.useState("medium"),[z,B]=e.useState(!1),F=e.useRef(null),L=e.useRef(null),R={id:n||"new",name:"未命名项目",videoPath:"",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),segmentCount:x.length,duration:0,width:1920,height:1080,fps:30},q=async()=>{try{const t=await Y({multiple:!1,filters:[{name:"视频文件",extensions:["mp4","mov","avi","mkv","webm"]}]});if(!t||"string"!=typeof t)return;l(!0),c(!0);try{i(`file://${t}`);const e=await ee(t);y(e.duration);const a={start:0,end:e.duration,type:"video",content:"完整视频"};j([a]),V([a]);const n=await te(t,{interval:Math.max(5,Math.floor(e.duration/10)),maxFrames:10});_(n.map(e=>e.path)),h.success("视频加载成功")}catch(e){h.error("视频分析失败，请检查文件格式")}finally{c(!1),l(!1)}}catch(t){}},W=()=>{F.current&&(z?F.current.pause():F.current.play(),B(!z))},V=e=>{C<S.length-1&&b(S.slice(0,C+1)),b([...S,e]),N(C+1)},K=()=>{const e={start:Math.min(u,g-5),end:Math.min(u+5,g),type:"video",content:`片段 ${x.length+1}`},t=[...x,e];j(t),V(t),I(t.length-1),h.success("已添加新片段")},U=e=>{I(e),F.current&&e>=0&&x[e]&&(F.current.currentTime=x[e].start,p(x[e].start))},H=e=>{const t=Math.floor(e/3600),a=Math.floor(e%3600/60),n=Math.floor(e%60);return[t>0?String(t).padStart(2,"0"):null,String(a).padStart(2,"0"),String(n).padStart(2,"0")].filter(Boolean).join(":")};return t.jsx(Layout,{className:ta.editorLayout,children:t.jsxs(aa,{className:ta.editorContent,children:[t.jsxs("div",{className:ta.toolbar,children:[t.jsxs("div",{className:ta.leftTools,children:[t.jsx(Button,{type:"primary",icon:t.jsx(UploadOutlined,{}),onClick:q,loading:o,children:"加载视频"}),t.jsx(Tooltip,{title:"撤销",children:t.jsx(Button,{icon:t.jsx(UndoOutlined,{}),disabled:C<=0,onClick:()=>{C>0&&(N(C-1),j(S[C-1]))}})}),t.jsx(Tooltip,{title:"重做",children:t.jsx(Button,{icon:t.jsx(RedoOutlined,{}),disabled:C>=S.length-1,onClick:()=>{C<S.length-1&&(N(C+1),j(S[C]))}})}),t.jsx(Tooltip,{title:"添加片段",children:t.jsx(Button,{icon:t.jsx(PlusOutlined,{}),onClick:K,disabled:!r})})]}),t.jsxs("div",{className:ta.rightTools,children:[t.jsx(Button,{icon:t.jsx(SaveOutlined,{}),onClick:async()=>{A(!0);try{await new Promise(e=>setTimeout(e,1e3));const e={...R,segments:x,updatedAt:(new Date).toISOString()};await(async(e,t)=>{try{if(!e)throw new Error("项目ID不能为空");return await J("save_project_file",{projectId:e,content:t}),!0}catch(a){return h.error("保存项目失败，请重试"),!1}})(n||"new",JSON.stringify(e)),h.success("项目保存成功")}catch(e){h.error("保存失败，请重试")}finally{A(!1)}},loading:T,disabled:!r,children:"保存"}),t.jsx(Button,{type:"primary",icon:t.jsx(DownloadOutlined,{}),onClick:async()=>{E(!0);try{await new Promise(e=>setTimeout(e,2e3)),h.success("视频导出成功")}catch(e){h.error("导出失败，请重试")}finally{E(!1)}},loading:O,disabled:!r||0===x.length,children:"导出"})]})]}),t.jsxs(Row,{gutter:[24,24],children:[t.jsxs(Col,{span:16,children:[t.jsx(Card,{className:ta.playerCard,title:"视频预览",children:r?t.jsxs("div",{className:ta.playerWrapper,children:[t.jsx("video",{ref:F,src:r,className:ta.videoPlayer,onTimeUpdate:()=>{F.current&&p(F.current.currentTime)},onLoadedMetadata:()=>{F.current&&y(F.current.duration)},onClick:W}),t.jsxs("div",{className:ta.playerControls,children:[t.jsx(Button,{type:"text",icon:z?t.jsx(PauseCircleOutlined,{}):t.jsx(PlayCircleOutlined,{}),onClick:W,size:"large",disabled:!r}),t.jsx("div",{className:ta.timeDisplay,children:t.jsxs(sa,{children:[H(u)," / ",H(g)]})}),t.jsx("div",{className:ta.progressBar,children:t.jsx(Progress,{percent:u/Math.max(g,1)*100,showInfo:!1,strokeColor:"#1E88E5",trailColor:"#e6e6e6"})}),t.jsx(Tooltip,{title:"全屏",children:t.jsx(Button,{type:"text",icon:t.jsx(FullscreenOutlined,{}),disabled:!r})})]})]}):t.jsxs("div",{className:ta.emptyPlayer,children:[t.jsx(Button,{type:"primary",icon:t.jsx(UploadOutlined,{}),onClick:q,size:"large",children:"加载视频"}),t.jsx(sa,{type:"secondary",style:{marginTop:16},children:"支持MP4, MOV, AVI, MKV等格式"})]})}),t.jsx("div",{className:ta.timelineContainer,children:t.jsxs("div",{className:ta.timeline,ref:L,children:[x.map((e,a)=>t.jsxs("div",{className:`${ta.timelineSegment} ${k===a?ta.selected:""}`,style:{left:e.start/Math.max(g,1)*100+"%",width:(e.end-e.start)/Math.max(g,1)*100+"%"},onClick:()=>U(a),children:[t.jsx("div",{className:ta.segmentHandle}),t.jsx("div",{className:ta.segmentLabel,children:a+1}),t.jsx("div",{className:ta.segmentHandle})]},a)),t.jsx("div",{className:ta.playhead,style:{left:u/Math.max(g,1)*100+"%"}})]})})]}),t.jsx(Col,{span:8,children:t.jsxs(Tabs,{defaultActiveKey:"trim",onChange:e=>w(e),className:ta.editorTabs,children:[t.jsx(ra,{tab:"片段",children:t.jsxs("div",{className:ta.segmentList,children:[t.jsx(na,{level:5,className:ta.sectionTitle,children:"片段列表"}),0===x.length?t.jsx(Empty,{description:"暂无片段",image:m.PRESENTED_IMAGE_SIMPLE}):x.map((e,a)=>t.jsxs(Card,{className:`${ta.segmentCard} ${k===a?ta.selected:""}`,onClick:()=>U(a),children:[t.jsxs("div",{className:ta.segmentHeader,children:[t.jsxs(sa,{strong:!0,children:["片段 ",a+1]}),t.jsx(Space,{children:t.jsx(Tooltip,{title:"删除",children:t.jsx(Button,{type:"text",size:"small",danger:!0,icon:t.jsx(DeleteOutlined,{}),onClick:e=>{e.stopPropagation(),(e=>{const t=x.filter((t,a)=>a!==e);j(t),V(t),I(-1),h.success("已删除片段")})(a)}})})})]}),t.jsxs("div",{className:ta.segmentTime,children:[t.jsxs(Tag,{color:"blue",children:[H(e.start)," - ",H(e.end)]}),t.jsxs(sa,{type:"secondary",children:["时长: ",H(e.end-e.start)]})]}),e.content&&t.jsx("div",{className:ta.segmentContent,children:t.jsx(sa,{ellipsis:!0,children:e.content})})]},a)),t.jsx(Button,{type:"dashed",icon:t.jsx(PlusOutlined,{}),block:!0,onClick:K,disabled:!r,className:ta.addSegmentButton,children:"添加片段"})]})},"trim"),t.jsx(ra,{tab:"关键帧",children:t.jsxs("div",{className:ta.keyframesContainer,children:[t.jsx(na,{level:5,className:ta.sectionTitle,children:"关键帧"}),0===f.length?t.jsx(Empty,{description:"暂无关键帧",image:m.PRESENTED_IMAGE_SIMPLE}):t.jsx("div",{className:ta.keyframeList,children:f.map((e,a)=>t.jsx("div",{className:ta.keyframeItem,children:t.jsx("img",{src:e,alt:`关键帧 ${a+1}`,className:ta.keyframeImage})},a))})]})},"keyframes"),t.jsx(ra,{tab:"效果",children:t.jsxs("div",{className:ta.effectsPanel,children:[t.jsx(na,{level:5,className:ta.sectionTitle,children:"视频效果"}),t.jsx(Empty,{description:"此功能正在开发中"})]})},"effects"),t.jsx(ra,{tab:"设置",children:t.jsxs("div",{className:ta.settingsPanel,children:[t.jsx(na,{level:5,className:ta.sectionTitle,children:"导出设置"}),t.jsxs(Card,{className:ta.settingCard,children:[t.jsxs("div",{className:ta.settingItem,children:[t.jsx(sa,{strong:!0,children:"输出格式"}),t.jsx(Dropdown,{menu:{items:[{key:"mp4",label:"MP4"},{key:"mov",label:"MOV"},{key:"webm",label:"WebM"}],onClick:({key:e})=>$(e)},children:t.jsxs(Button,{children:[P.toUpperCase()," ",t.jsx(DownloadOutlined,{})]})})]}),t.jsxs("div",{className:ta.settingItem,children:[t.jsx(sa,{strong:!0,children:"视频质量"}),t.jsx(Dropdown,{menu:{items:[{key:"low",label:"低 (720p)"},{key:"medium",label:"中 (1080p)"},{key:"high",label:"高 (原始分辨率)"}],onClick:({key:e})=>M(e)},children:t.jsxs(Button,{children:["low"===D?"低 (720p)":"medium"===D?"中 (1080p)":"高 (原始分辨率)"," ",t.jsx(DownloadOutlined,{})]})})]})]})]})},"settings")]})})]})]})})},oa="_tabContent_1r23h_18",la="_section_1r23h_21",da="_statCard_1r23h_59",ca="_statIcon_1r23h_64",ua="_statInfo_1r23h_74",pa="_switchItem_1r23h_82",ma="_switchInfo_1r23h_92",ha="_infoItem_1r23h_138",{Title:ga,Text:ya,Paragraph:xa}=p,ja=[{key:"openai",name:"OpenAI",logo:"🤖",models:["gpt-4","gpt-4-turbo","gpt-3.5-turbo"],color:"#10a37f"},{key:"anthropic",name:"Anthropic",logo:"🧠",models:["claude-3-opus","claude-3-sonnet","claude-3-haiku"],color:"#d4a373"},{key:"baidu",name:"百度",logo:"🔍",models:["ernie-5.0","ernie-4.0"],color:"#2932e1"},{key:"alibaba",name:"阿里",logo:"☁️",models:["qwen-3.5","qwen-plus","qwen-max"],color:"#ff6a00"},{key:"zhipu",name:"智谱",logo:"📊",models:["glm-5","glm-4"],color:"#5e72e4"},{key:"moonshot",name:"月之暗面",logo:"🌙",models:["kimi-k2.5"],color:"#1a1a1a"},{key:"minimax",name:"MiniMax",logo:"🎭",models:["minimax-m2.5"],color:"#ff6b6b"},{key:"doubao",name:"字节豆包",logo:"📱",models:["doubao-pro-32k","doubao-lite-32k"],color:"#3c8cff"}],fa=()=>{const[a,n]=e.useState("api"),[s,r]=e.useState({openai:"",anthropic:"",baidu:"",alibaba:"",zhipu:"",moonshot:"",minimax:"",doubao:""}),i=[{key:"api",label:t.jsxs("span",{children:[t.jsx(ApiOutlined,{})," API 配置"]}),children:t.jsxs("div",{className:oa,children:[t.jsxs("div",{className:la,children:[t.jsx(ga,{level:4,children:"AI 模型 API"}),t.jsx(xa,{type:"secondary",children:"配置您使用的 AI 服务商 API 密钥，不同服务商支持不同的模型。"}),t.jsx(List,{dataSource:ja,renderItem:e=>t.jsxs(Card,{className:"_providerCard_1r23h_28",children:[t.jsxs("div",{className:"_providerHeader_1r23h_33",children:[t.jsxs("div",{className:"_providerInfo_1r23h_39",children:[t.jsx("span",{className:"_providerLogo_1r23h_44",children:e.logo}),t.jsx("span",{className:"_providerName_1r23h_47",children:e.name}),s[e.key]?t.jsx(Tag,{color:"success",icon:t.jsx(CheckCircleOutlined,{}),children:"已配置"}):t.jsx(Tag,{icon:t.jsx(CloseCircleOutlined,{}),children:"未配置"})]}),t.jsx(Button,{type:"link",icon:t.jsx(EditOutlined,{}),onClick:()=>{e.key},children:s[e.key]?"修改":"添加"})]}),t.jsxs("div",{className:"_modelSelect_1r23h_51",children:[t.jsx(ya,{type:"secondary",children:"选择模型："}),t.jsx(Select,{defaultValue:e.models[0],style:{width:200},options:e.models.map(e=>({label:e,value:e}))})]})]},e.key)})]}),t.jsx(Divider,{}),t.jsxs("div",{className:la,children:[t.jsx(ga,{level:4,children:"API 使用统计"}),t.jsxs(Row,{gutter:[16,16],children:[t.jsx(Col,{xs:24,sm:8,children:t.jsxs(Card,{className:da,children:[t.jsx("div",{className:ca,style:{background:"#e0e7ff",color:"#6366f1"},children:t.jsx(ThunderboltOutlined,{})}),t.jsxs("div",{className:ua,children:[t.jsx(ya,{type:"secondary",children:"本月调用"}),t.jsx(ga,{level:3,children:"1,234"})]})]})}),t.jsx(Col,{xs:24,sm:8,children:t.jsxs(Card,{className:da,children:[t.jsx("div",{className:ca,style:{background:"#fef3c7",color:"#f59e0b"},children:t.jsx(KeyOutlined,{})}),t.jsxs("div",{className:ua,children:[t.jsx(ya,{type:"secondary",children:"消耗 Tokens"}),t.jsx(ga,{level:3,children:"567K"})]})]})}),t.jsx(Col,{xs:24,sm:8,children:t.jsxs(Card,{className:da,children:[t.jsx("div",{className:ca,style:{background:"#d1fae5",color:"#10b981"},children:t.jsx(CheckCircleOutlined,{})}),t.jsxs("div",{className:ua,children:[t.jsx(ya,{type:"secondary",children:"成功调用"}),t.jsx(ga,{level:3,children:"98.5%"})]})]})})]})]})]})},{key:"general",label:t.jsxs("span",{children:[t.jsx(SettingOutlined,{})," 通用设置"]}),children:t.jsxs("div",{className:oa,children:[t.jsxs("div",{className:la,children:[t.jsx(ga,{level:4,children:"基本设置"}),t.jsxs(Form,{layout:"vertical",children:[t.jsx(Form.Item,{label:"项目保存路径",children:t.jsx(Input,{placeholder:"/Users/username/ClipAiMan/projects",suffix:t.jsx(Button,{type:"text",size:"small",children:"浏览"})})}),t.jsx(Form.Item,{label:"默认视频分辨率",children:t.jsx(Select,{defaultValue:"1080p",options:[{label:"720p",value:"720p"},{label:"1080p",value:"1080p"},{label:"2K",value:"2k"},{label:"4K",value:"4k"}]})}),t.jsx(Form.Item,{label:"默认帧率",children:t.jsx(Select,{defaultValue:"24",options:[{label:"24 fps",value:"24"},{label:"30 fps",value:"30"},{label:"60 fps",value:"60"}]})}),t.jsxs(Form.Item,{label:"自动保存间隔",children:[t.jsx(InputNumber,{min:1,max:60,defaultValue:5}),t.jsx(ya,{type:"secondary",style:{marginLeft:8},children:"分钟"})]})]})]}),t.jsx(Divider,{}),t.jsxs("div",{className:la,children:[t.jsx(ga,{level:4,children:"开关设置"}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"自动保存项目"}),t.jsx(ya,{type:"secondary",children:"工作进度自动保存到本地"})]}),t.jsx(Switch,{defaultChecked:!0})]}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"显示高级选项"}),t.jsx(ya,{type:"secondary",children:"在界面中显示更多高级配置"})]}),t.jsx(Switch,{})]}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"启用快捷键"}),t.jsx(ya,{type:"secondary",children:"使用键盘快捷键提高效率"})]}),t.jsx(Switch,{defaultChecked:!0})]}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"启动时检查更新"}),t.jsx(ya,{type:"secondary",children:"自动检查新版本并提示更新"})]}),t.jsx(Switch,{defaultChecked:!0})]})]})]})},{key:"account",label:t.jsxs("span",{children:[t.jsx(UserOutlined,{})," 账户"]}),children:t.jsxs("div",{className:oa,children:[t.jsx(Card,{className:"_accountCard_1r23h_98",children:t.jsxs("div",{className:"_accountInfo_1r23h_102",children:[t.jsx(Avatar,{size:80,className:"_avatar_1r23h_107",children:t.jsx(UserOutlined,{})}),t.jsxs("div",{className:"_accountDetail_1r23h_111",children:[t.jsx(ga,{level:4,children:"用户账户"}),t.jsx(ya,{type:"secondary",children:"创建时间：2026-02-15"}),t.jsx("div",{className:"_accountTags_1r23h_118",children:t.jsx(Tag,{color:"blue",children:"免费版"})})]})]})}),t.jsx(Divider,{}),t.jsxs("div",{className:la,children:[t.jsx(ga,{level:4,children:"账户设置"}),t.jsxs(Form,{layout:"vertical",children:[t.jsx(Form.Item,{label:"显示名称",children:t.jsx(Input,{placeholder:"输入您的名称"})}),t.jsx(Form.Item,{label:"邮箱",children:t.jsx(Input,{placeholder:"your@email.com"})}),t.jsx(Button,{type:"primary",children:"保存更改"})]})]})]})},{key:"notification",label:t.jsxs("span",{children:[t.jsx(BellOutlined,{})," 通知"]}),children:t.jsx("div",{className:oa,children:t.jsxs("div",{className:la,children:[t.jsx(ga,{level:4,children:"通知设置"}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"项目完成通知"}),t.jsx(ya,{type:"secondary",children:"项目生成完成时推送通知"})]}),t.jsx(Switch,{defaultChecked:!0})]}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"错误提醒"}),t.jsx(ya,{type:"secondary",children:"发生错误时推送通知"})]}),t.jsx(Switch,{defaultChecked:!0})]}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"API 配额提醒"}),t.jsx(ya,{type:"secondary",children:"API 使用达到 80% 时提醒"})]}),t.jsx(Switch,{defaultChecked:!0})]}),t.jsxs("div",{className:pa,children:[t.jsxs("div",{className:ma,children:[t.jsx(ya,{strong:!0,children:"更新推送"}),t.jsx(ya,{type:"secondary",children:"新版本发布时推送通知"})]}),t.jsx(Switch,{})]})]})})},{key:"about",label:t.jsxs("span",{children:[t.jsx(InfoCircleOutlined,{})," 关于"]}),children:t.jsx("div",{className:oa,children:t.jsxs(Card,{className:"_aboutCard_1r23h_122",children:[t.jsxs("div",{className:"_aboutHeader_1r23h_126",children:[t.jsx(ga,{level:2,children:"🎬 ClipAiMan"}),t.jsx(ya,{type:"secondary",children:"AI 漫剧视频智能创作平台"})]}),t.jsxs("div",{className:"_aboutInfo_1r23h_133",children:[t.jsxs("div",{className:ha,children:[t.jsx(ya,{type:"secondary",children:"版本"}),t.jsx(ya,{children:"v2.1.0"})]}),t.jsxs("div",{className:ha,children:[t.jsx(ya,{type:"secondary",children:"构建时间"}),t.jsx(ya,{children:"2026-02-22"})]}),t.jsxs("div",{className:ha,children:[t.jsx(ya,{type:"secondary",children:"许可证"}),t.jsx(ya,{children:"MIT"})]})]}),t.jsx(Divider,{}),t.jsx(Alert,{type:"info",showIcon:!0,message:"感谢使用 ClipAiMan",description:"如有问题或建议，请提交 Issue 或联系开发者。"})]})})}];return t.jsx("div",{className:"_settings_1r23h_2",children:t.jsx(Card,{className:"_settingsCard_1r23h_5",children:t.jsx(Tabs,{activeKey:a,onChange:n,items:i,className:"_tabs_1r23h_8"})})})},_a=[{type:"trigger.manual",displayName:"手动触发",description:"手动启动工作流",category:"trigger",icon:"PlayCircleOutlined",inputs:[],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[],defaultSettings:{}},{type:"trigger.schedule",displayName:"定时触发",description:"按计划自动启动工作流",category:"trigger",icon:"ClockCircleOutlined",inputs:[],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"cron",name:"cron",displayName:"Cron 表达式",type:"string",required:!0,placeholder:"0 8 * * *",description:"例如: 0 8 * * * 表示每天早上8点"},{id:"timezone",name:"timezone",displayName:"时区",type:"select",required:!0,default:"Asia/Shanghai",options:[{label:"北京时间 (UTC+8)",value:"Asia/Shanghai"},{label:"UTC",value:"UTC"}]}],defaultSettings:{}},{type:"trigger.webhook",displayName:"Webhook 触发",description:"通过 Webhook URL 启动工作流",category:"trigger",icon:"ApiOutlined",inputs:[],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"path",name:"path",displayName:"路径",type:"string",required:!0,placeholder:"/my-workflow"},{id:"method",name:"method",displayName:"HTTP 方法",type:"select",required:!0,default:"POST",options:[{label:"POST",value:"POST"},{label:"GET",value:"GET"}]}],defaultSettings:{}}],va=[{type:"ai.chat",displayName:"AI 对话",description:"使用 AI 模型进行对话",category:"ai",icon:"MessageOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"model",name:"model",displayName:"AI 模型",type:"select",required:!0,default:"baidu",options:[{label:"百度 ERNIE",value:"baidu"},{label:"阿里通义千问",value:"alibaba"},{label:"智谱 GLM",value:"zhipu"},{label:"月之暗面 Kimi",value:"moonshot"},{label:"MiniMax",value:"minimax"},{label:"字节豆包",value:"doubao"}]},{id:"prompt",name:"prompt",displayName:"提示词",type:"string",required:!0,description:"支持使用 {{变量}} 引用输入数据"},{id:"temperature",name:"temperature",displayName:"温度",type:"number",required:!1,default:.7},{id:"maxTokens",name:"maxTokens",displayName:"最大 Token",type:"number",required:!1,default:2e3}],defaultSettings:{retryOnFail:!0,retryCount:2}},{type:"ai.script",displayName:"剧本生成",description:"AI 自动生成漫剧剧本",category:"ai",icon:"FileTextOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"model",name:"model",displayName:"AI 模型",type:"select",required:!0,default:"baidu"},{id:"topic",name:"topic",displayName:"主题",type:"string",required:!0},{id:"style",name:"style",displayName:"风格",type:"select",required:!0,default:"professional",options:[{label:"专业正式",value:"professional"},{label:"轻松随意",value:"casual"},{label:"幽默风趣",value:"humorous"},{label:"情感共鸣",value:"emotional"}]},{id:"length",name:"length",displayName:"长度",type:"select",required:!0,default:"medium",options:[{label:"短 (1-3分钟)",value:"short"},{label:"中 (3-5分钟)",value:"medium"},{label:"长 (5-10分钟)",value:"long"}]}],defaultSettings:{retryOnFail:!0,retryCount:2}},{type:"ai.analyze",displayName:"内容分析",description:"AI 分析内容并提取信息",category:"ai",icon:"ScanOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"model",name:"model",displayName:"AI 模型",type:"select",required:!0,default:"moonshot"},{id:"analysisType",name:"analysisType",displayName:"分析类型",type:"select",required:!0,default:"extract",options:[{label:"提取关键信息",value:"extract"},{label:"情感分析",value:"sentiment"},{label:"角色提取",value:"character"},{label:"场景提取",value:"scene"}]}],defaultSettings:{}}],wa=[{type:"image.generate",displayName:"图像生成",description:"AI 生成图像",category:"image",icon:"PictureOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"provider",name:"provider",displayName:"提供商",type:"select",required:!0,default:"bytedance",options:[{label:"字节 Seedream",value:"bytedance"},{label:"快手可灵",value:"kling"}]},{id:"prompt",name:"prompt",displayName:"提示词",type:"string",required:!0},{id:"negativePrompt",name:"negativePrompt",displayName:"负向提示词",type:"string",required:!1},{id:"style",name:"style",displayName:"风格",type:"select",required:!0,default:"anime",options:[{label:"写实",value:"realistic"},{label:"动漫",value:"anime"},{label:"油画",value:"oil"},{label:"水彩",value:"watercolor"},{label:"3D",value:"3d"},{label:"国风",value:"chinese"}]},{id:"aspectRatio",name:"aspectRatio",displayName:"比例",type:"select",required:!0,default:"16:9",options:[{label:"16:9 横屏",value:"16:9"},{label:"9:16 竖屏",value:"9:16"},{label:"1:1 方形",value:"1:1"}]},{id:"count",name:"count",displayName:"生成数量",type:"number",required:!1,default:1}],defaultSettings:{timeout:120,retryOnFail:!0,retryCount:3}},{type:"image.edit",displayName:"图像编辑",description:"编辑处理图像",category:"image",icon:"EditOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"binary",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"operation",name:"operation",displayName:"操作",type:"select",required:!0,default:"resize",options:[{label:"调整大小",value:"resize"},{label:"裁剪",value:"crop"},{label:"旋转",value:"rotate"},{label:"滤镜",value:"filter"}]}],defaultSettings:{}},{type:"image.upscale",displayName:"图像放大",description:"使用 AI 放大图像",category:"image",icon:"ZoomInOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"binary",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"scale",name:"scale",displayName:"放大倍数",type:"select",required:!0,default:"2x",options:[{label:"2x",value:"2"},{label:"4x",value:"4"}]}],defaultSettings:{}}],Sa=[{type:"video.generate",displayName:"视频生成",description:"AI 图生视频",category:"video",icon:"VideoCameraOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"binary",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"provider",name:"provider",displayName:"提供商",type:"select",required:!0,default:"bytedance",options:[{label:"字节 Seedance",value:"bytedance"},{label:"快手可灵",value:"kling"},{label:"生数 Vidu",value:"vidu"}]},{id:"duration",name:"duration",displayName:"时长 (秒)",type:"number",required:!0,default:5},{id:"fps",name:"fps",displayName:"帧率",type:"number",required:!1,default:24}],defaultSettings:{timeout:300,retryOnFail:!0,retryCount:3}},{type:"video.edit",displayName:"视频剪辑",description:"剪辑处理视频",category:"video",icon:"ScissorOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"binary",required:!0,multiple:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"operation",name:"operation",displayName:"操作",type:"select",required:!0,default:"merge",options:[{label:"合并",value:"merge"},{label:"裁剪",value:"trim"},{label:"添加字幕",value:"subtitle"},{label:"添加转场",value:"transition"}]}],defaultSettings:{}},{type:"video.merge",displayName:"视频合成",description:"合并多个视频片段",category:"video",icon:"MergeCellsOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"binary",required:!0,multiple:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"transition",name:"transition",displayName:"转场效果",type:"select",required:!0,default:"fade",options:[{label:"淡入淡出",value:"fade"},{label:"溶解",value:"dissolve"},{label:"滑动",value:"slide"},{label:"无",value:"none"}]},{id:"transitionDuration",name:"transitionDuration",displayName:"转场时长 (秒)",type:"number",required:!1,default:.5}],defaultSettings:{}}],ba=[{type:"audio.tts",displayName:"语音合成",description:"文本转语音",category:"audio",icon:"SoundOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"provider",name:"provider",displayName:"引擎",type:"select",required:!0,default:"edge",options:[{label:"Edge TTS (免费)",value:"edge"},{label:"阿里云",value:"aliyun"},{label:"百度",value:"baidu"},{label:"讯飞",value:"iflytek"}]},{id:"voice",name:"voice",displayName:"音色",type:"string",required:!0,default:"zh-CN-XiaoxiaoNeural"},{id:"speed",name:"speed",displayName:"语速",type:"number",required:!1,default:1},{id:"pitch",name:"pitch",displayName:"音调",type:"number",required:!1,default:1}],defaultSettings:{}},{type:"audio.music",displayName:"音乐生成",description:"AI 生成背景音乐",category:"audio",icon:"CustomerServiceOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"style",name:"style",displayName:"音乐风格",type:"select",required:!0,default:"cinematic",options:[{label:"电影感",value:"cinematic"},{label:"轻松愉快",value:"happy"},{label:"悲伤",value:"sad"},{label:"紧张",value:"tense"}]},{id:"duration",name:"duration",displayName:"时长 (秒)",type:"number",required:!0,default:30}],defaultSettings:{}},{type:"audio.merge",displayName:"音频合成",description:"合并音频到视频",category:"audio",icon:"FileSyncOutlined",inputs:[{id:"video",name:"video",displayName:"视频",type:"input",dataType:"binary",required:!0},{id:"audio",name:"audio",displayName:"音频",type:"input",dataType:"binary",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"binary",required:!0}],parameters:[{id:"volume",name:"volume",displayName:"音量",type:"number",required:!1,default:1},{id:"replaceAudio",name:"replaceAudio",displayName:"替换原音频",type:"boolean",required:!1,default:!1}],defaultSettings:{}}],Ca=[{type:"data.input",displayName:"数据输入",description:"定义输入数据",category:"data",icon:"ImportOutlined",inputs:[],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"data",name:"data",displayName:"数据",type:"json",required:!0,default:{}}],defaultSettings:{}},{type:"data.transform",displayName:"数据转换",description:"转换数据格式",category:"data",icon:"TransformOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"transformations",name:"transformations",displayName:"转换规则",type:"json",required:!0}],defaultSettings:{}},{type:"data.merge",displayName:"数据合并",description:"合并多个数据源",category:"data",icon:"MergeOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0,multiple:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"mode",name:"mode",displayName:"合并模式",type:"select",required:!0,default:"append",options:[{label:"追加",value:"append"},{label:"覆盖",value:"override"},{label:"深度合并",value:"deep"}]}],defaultSettings:{}},{type:"data.filter",displayName:"数据过滤",description:"过滤数据",category:"data",icon:"FilterOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"true",name:"true",displayName:"满足条件",type:"output",dataType:"json",required:!0},{id:"false",name:"false",displayName:"不满足条件",type:"output",dataType:"json",required:!0}],parameters:[{id:"condition",name:"condition",displayName:"条件表达式",type:"string",required:!0,placeholder:"{{ $json.value }} > 10"}],defaultSettings:{}},{type:"data.code",displayName:"自定义代码",description:"执行自定义 JavaScript 代码",category:"data",icon:"CodeOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"any",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"any",required:!0}],parameters:[{id:"code",name:"code",displayName:"代码",type:"code",required:!0,default:"// 可用变量: $input, $node, $workflow\nreturn $input;"}],defaultSettings:{}}],Na=[{type:"flow.condition",displayName:"条件分支",description:"根据条件执行不同分支",category:"flow",icon:"ForkOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"any",required:!0}],outputs:[{id:"true",name:"true",displayName:"是",type:"output",dataType:"any",required:!0},{id:"false",name:"false",displayName:"否",type:"output",dataType:"any",required:!0}],parameters:[{id:"condition",name:"condition",displayName:"条件表达式",type:"string",required:!0}],defaultSettings:{}},{type:"flow.loop",displayName:"循环",description:"循环处理数据",category:"flow",icon:"ReloadOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"json",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"json",required:!0}],parameters:[{id:"mode",name:"mode",displayName:"循环模式",type:"select",required:!0,default:"forEach",options:[{label:"遍历数组",value:"forEach"},{label:"固定次数",value:"count"},{label:"条件循环",value:"while"}]},{id:"count",name:"count",displayName:"循环次数",type:"number",required:!1}],defaultSettings:{}},{type:"flow.parallel",displayName:"并行执行",description:"并行执行多个分支",category:"flow",icon:"BranchesOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"any",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"any",required:!0}],parameters:[],defaultSettings:{}},{type:"flow.delay",displayName:"延迟",description:"延迟执行",category:"flow",icon:"HourglassOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"any",required:!0}],outputs:[{id:"main",name:"main",displayName:"输出",type:"output",dataType:"any",required:!0}],parameters:[{id:"delay",name:"delay",displayName:"延迟时间 (秒)",type:"number",required:!0,default:5}],defaultSettings:{}}],ka=[{type:"output.export",displayName:"导出文件",description:"导出处理结果",category:"output",icon:"ExportOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"binary",required:!0}],outputs:[],parameters:[{id:"format",name:"format",displayName:"导出格式",type:"select",required:!0,default:"mp4",options:[{label:"MP4 视频",value:"mp4"},{label:"PNG 图像",value:"png"},{label:"MP3 音频",value:"mp3"}]},{id:"quality",name:"quality",displayName:"质量",type:"select",required:!0,default:"high",options:[{label:"高质量",value:"high"},{label:"中等质量",value:"medium"},{label:"低质量",value:"low"}]}],defaultSettings:{}},{type:"output.save",displayName:"保存到项目",description:"保存到 ManGaAI 项目",category:"output",icon:"SaveOutlined",inputs:[{id:"main",name:"main",displayName:"输入",type:"input",dataType:"binary",required:!0}],outputs:[],parameters:[{id:"projectId",name:"projectId",displayName:"项目 ID",type:"string",required:!0},{id:"name",name:"name",displayName:"文件名",type:"string",required:!0}],defaultSettings:{}}],Ia=[..._a,...va,...wa,...Sa,...ba,...Ca,...Na,...ka].reduce((e,t)=>(e[t.type]=t,e),{}),Ta={trigger:_a,ai:va,image:wa,video:Sa,audio:ba,data:Ca,flow:Na,output:ka};function Aa(e){return Ia[e]}const Oa=new class{executions=new Map;listeners=[];abortControllers=new Map;async execute(e,t="manual",a){const n=`exec-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,s={id:n,workflowId:e.id,status:"running",startedAt:Date.now(),trigger:t,nodeExecutions:[],data:{}};this.executions.set(n,s);const r=new AbortController;this.abortControllers.set(n,r);try{this.validateWorkflow(e),this.emit({type:"workflow:start",workflowId:e.id,executionId:n,timestamp:Date.now()});const t=e.nodes.filter(e=>e.type.startsWith("trigger."));if(0===t.length)throw new Error("工作流没有触发器节点");for(const n of t){if(r.signal.aborted)break;await this.executeNode(e,n,s,a)}s.status="success",s.finishedAt=Date.now(),s.duration=s.finishedAt-s.startedAt,this.emit({type:"workflow:complete",workflowId:e.id,executionId:n,timestamp:Date.now()})}catch(i){s.status="error",s.finishedAt=Date.now(),s.duration=s.finishedAt-s.startedAt,s.error=i instanceof Error?i.message:"执行失败",this.emit({type:"workflow:error",workflowId:e.id,executionId:n,data:{error:s.error},timestamp:Date.now()})}finally{this.abortControllers.delete(n)}return s}validateWorkflow(e){if(0===e.nodes.filter(e=>e.type.startsWith("trigger.")).length)throw new Error("工作流必须至少有一个触发器节点");for(const t of e.connections){const a=e.nodes.find(e=>e.id===t.sourceNodeId),n=e.nodes.find(e=>e.id===t.targetNodeId);if(!a||!n)throw new Error(`无效的连接: ${t.id}`);const s=Aa(a.type),r=Aa(n.type);if(s&&!s.outputs.find(e=>e.id===t.sourceOutput))throw new Error(`节点 ${a.name} 没有输出端口 ${t.sourceOutput}`);if(r&&!r.inputs.find(e=>e.id===t.targetInput))throw new Error(`节点 ${n.name} 没有输入端口 ${t.targetInput}`)}for(const t of e.nodes)if(!t.type.startsWith("trigger.")&&!e.connections.some(e=>e.targetNodeId===t.id))throw new Error(`节点 ${t.name} 没有输入连接`)}async executeNode(e,t,a,n){const s=Date.now(),r={nodeId:t.id,status:"running",startTime:s,input:n};a.nodeExecutions.push(r),t.status="running",this.emit({type:"node:start",workflowId:e.id,executionId:a.id,nodeId:t.id,timestamp:s});try{const o=this.getExecutor(t.type);if(!o)throw new Error(`未找到节点执行器: ${t.type}`);const l=ot.getSettings(),d={nodeId:t.id,workflowId:e.id,executionId:a.id,parameters:t.parameters,inputData:n||[],settings:t.settings,workflowData:a.data,logger:{debug:(e,t)=>{},info:(e,t)=>{},warn:(e,t)=>{},error:(e,t)=>{}},services:{ai:dt,tts:Ct,image:Et,video:Et,ffmpeg:Pt,storage:ut},appSettings:l};let c,u=null;const p=t.settings.retryOnFail?t.settings.retryCount||2:0;for(let e=0;e<=p;e++)try{c=await o(d),u=null;break}catch(i){if(u=i,e<p){const t=1e3*Math.pow(2,e);await new Promise(e=>setTimeout(e,t))}}if(u)throw u;t.settings.executeOnce&&c.length>0&&(c=[c[0]]);const m=Date.now();return r.status="success",r.endTime=m,r.duration=m-s,r.output=c,t.status="success",a.data[t.id]=c,this.emit({type:"node:complete",workflowId:e.id,executionId:a.id,nodeId:t.id,data:{duration:r.duration},timestamp:m}),await this.executeDownstreamNodes(e,t,a,c),c}catch(i){const n=i instanceof Error?i.message:"节点执行失败";if("continue"===t.settings.onError||"continueWithError"===t.settings.onError){r.status="error",r.error=n,t.status="error",this.emit({type:"node:error",workflowId:e.id,executionId:a.id,nodeId:t.id,data:{error:n},timestamp:Date.now()});const s=[{json:{error:n,nodeId:t.id},binary:{}}];return a.data[t.id]=s,await this.executeDownstreamNodes(e,t,a,s),s}throw r.status="error",r.error=n,r.endTime=Date.now(),t.status="error",this.emit({type:"node:error",workflowId:e.id,executionId:a.id,nodeId:t.id,data:{error:n},timestamp:Date.now()}),i}}async executeDownstreamNodes(e,t,a,n){const s=e.connections.filter(e=>e.sourceNodeId===t.id),r=new Map;for(const o of s)r.has(o.sourceOutput)||r.set(o.sourceOutput,[]),r.get(o.sourceOutput).push(o);const i=[];for(const[o,l]of r)for(const t of l){const n=e.nodes.find(e=>e.id===t.targetNodeId);if(!n)continue;if(!this.checkInputsReady(e,n,a))continue;const s=this.collectInputData(e,n,a);i.push(this.executeNode(e,n,a,s))}await Promise.all(i)}checkInputsReady(e,t,a){const n=e.connections.filter(e=>e.targetNodeId===t.id);for(const s of n)if(!a.data[s.sourceNodeId])return!1;return!0}collectInputData(e,t,a){const n=e.connections.filter(e=>e.targetNodeId===t.id),s=[];for(const r of n){const t=a.data[r.sourceNodeId];if(t){const a=e.nodes.find(e=>e.id===r.sourceNodeId);if(a){const e=Aa(a.type),n=e?.outputs.find(e=>e.id===r.sourceOutput);"main"===n?.type?s.push(...t):"error"===n?.id&&s.push(...t.filter(e=>e.json?.error))}}}return s}getExecutor(e){return{"trigger.manual":async e=>e.inputData.length>0?e.inputData:[{json:{triggered:!0},binary:{}}],"trigger.schedule":async e=>[{json:{triggered:!0,scheduledAt:(new Date).toISOString(),cron:e.parameters.cronExpression},binary:{}}],"trigger.webhook":async e=>[{json:{triggered:!0,webhookPath:e.parameters.path,method:e.parameters.method},binary:{}}],"ai.chat":async e=>{const{model:t,prompt:a,systemPrompt:n,temperature:s,maxTokens:r}=e.parameters,i=e.inputData[0]?.json?.text||e.inputData[0]?.json?.prompt||"",o=i?`${a}\n\n${i}`:a;e.appSettings;try{const e=await dt.chat(o,{model:t,temperature:s??.7,maxTokens:r??2e3,systemPrompt:n});return[{json:{response:e.content,model:e.model,usage:e.usage},binary:{}}]}catch(l){throw e.logger.error("AI 对话失败",l),new Error(`AI 对话失败: ${l instanceof Error?l.message:"未知错误"}`)}},"ai.script":async e=>{const{model:t,topic:a,style:n,tone:s,length:r,audience:i,language:o,keywords:l}=e.parameters;try{return[{json:await dt.generateScript({id:t||"default",name:t||"默认模型",provider:"openai"},{},{topic:a,style:n||"drama",tone:s||"neutral",length:r||"medium",audience:i||"general",language:o||"zh-CN",keywords:l?.split(",").map(e=>e.trim()).filter(Boolean)}),binary:{}}]}catch(d){throw e.logger.error("脚本生成失败",d),new Error(`脚本生成失败: ${d instanceof Error?d.message:"未知错误"}`)}},"ai.analyze":async e=>{const{model:t,analysisType:a}=e.parameters,n=e.inputData[0]?.json?.text||e.inputData[0]?.json?.content||"";if(!n)throw new Error("需要输入文本内容");try{return[{json:await dt.analyzeText(n,{model:t,type:a}),binary:{}}]}catch(s){throw e.logger.error("文本分析失败",s),new Error(`文本分析失败: ${s instanceof Error?s.message:"未知错误"}`)}},"image.generate":async e=>{const{provider:t,prompt:a,negativePrompt:n,style:s,aspectRatio:r,count:i}=e.parameters,o=e.inputData[0]?.json?.prompt||"",l=o?`${a}, ${o}`:a;try{return(await Et.generateImages({prompt:l,negativePrompt:n,style:s,aspectRatio:r,count:i||1,provider:t})).map(e=>({json:{prompt:l,style:s,width:e.width,height:e.height},binary:{image:{data:e.data||e.url,mimeType:e.mimeType||"image/png",fileName:`image-${Date.now()}.png`,url:e.url}}}))}catch(d){throw e.logger.error("图像生成失败",d),new Error(`图像生成失败: ${d instanceof Error?d.message:"未知错误"}`)}},"image.edit":async e=>{const{provider:t,prompt:a,mask:n}=e.parameters,s=e.inputData[0]?.binary?.image;if(!s)throw new Error("需要输入图像");try{return[{json:{prompt:a,edited:!0},binary:{image:{data:(await Et.editImage({image:s.data,prompt:a,mask:n,provider:t})).data,mimeType:s.mimeType,fileName:`edited-${Date.now()}.png`}}}]}catch(r){throw e.logger.error("图像编辑失败",r),new Error(`图像编辑失败: ${r instanceof Error?r.message:"未知错误"}`)}},"image.upscale":async e=>{const{scale:t,model:a}=e.parameters,n=e.inputData[0]?.binary?.image;if(!n)throw new Error("需要输入图像");try{const e=await Et.upscaleImage({image:n.data,scale:t||2,model:a});return[{json:{scale:t,originalSize:n.size,upscaled:!0},binary:{image:{data:e.data,mimeType:n.mimeType,fileName:`upscaled-${Date.now()}.png`}}}]}catch(s){throw e.logger.error("图像放大失败",s),new Error(`图像放大失败: ${s instanceof Error?s.message:"未知错误"}`)}},"video.generate":async e=>{const{provider:t,duration:a,fps:n,resolution:s}=e.parameters,r=e.inputData[0]?.binary?.image,i=e.inputData[0]?.json?.prompt||e.parameters.prompt;try{const e=await Et.generateVideo({image:r?.data,prompt:i,duration:a||5,fps:n||24,resolution:s,provider:t});return[{json:{duration:a,fps:n,resolution:s},binary:{video:{data:e.data,mimeType:"video/mp4",fileName:`video-${Date.now()}.mp4`,url:e.url}}}]}catch(o){throw e.logger.error("视频生成失败",o),new Error(`视频生成失败: ${o instanceof Error?o.message:"未知错误"}`)}},"video.edit":async e=>{const{operation:t,startTime:a,endTime:n,effects:s}=e.parameters,r=e.inputData[0]?.binary?.video;if(!r)throw new Error("需要输入视频");try{return[{json:{operation:t,processed:!0},binary:{video:{data:(await Pt.processVideo({input:r.data,operation:t,startTime:a,endTime:n,effects:s})).data,mimeType:"video/mp4",fileName:`edited-${Date.now()}.mp4`}}}]}catch(i){throw e.logger.error("视频编辑失败",i),new Error(`视频编辑失败: ${i instanceof Error?i.message:"未知错误"}`)}},"video.merge":async e=>{const{transition:t,transitionDuration:a}=e.parameters,n=e.inputData.filter(e=>e.binary?.video).map(e=>e.binary.video);if(n.length<2)throw new Error("需要至少两个视频");try{const e=await Pt.mergeVideos(n.map(e=>e.data),{transition:t,transitionDuration:a});return[{json:{videoCount:n.length,transition:t},binary:{video:{data:e.data,mimeType:"video/mp4",fileName:`merged-${Date.now()}.mp4`}}}]}catch(s){throw e.logger.error("视频合并失败",s),new Error(`视频合并失败: ${s instanceof Error?s.message:"未知错误"}`)}},"audio.tts":async e=>{const{provider:t,voice:a,speed:n,pitch:s,volume:r}=e.parameters,i=e.inputData[0]?.json?.text||e.parameters.text||"";if(!i)throw new Error("需要输入文本");try{const e=await Ct.synthesize({text:i,voice:a||"zh-CN-XiaoxiaoNeural",speed:n||1,pitch:s||0,volume:r||80},{provider:t||"edge"});return[{json:{text:i,voice:a,duration:e.duration},binary:{audio:{data:e.audioUrl,mimeType:"audio/mp3",fileName:`audio-${Date.now()}.mp3`}}}]}catch(o){throw e.logger.error("语音合成失败",o),new Error(`语音合成失败: ${o instanceof Error?o.message:"未知错误"}`)}},"audio.music":async e=>{const{provider:t,style:a,duration:n,tempo:s,mood:r}=e.parameters;try{return[{json:{style:a,duration:n,tempo:s,mood:r},binary:{audio:{data:(await Et.generateMusic({style:a,duration:n||30,tempo:s,mood:r,provider:t})).data,mimeType:"audio/mp3",fileName:`music-${Date.now()}.mp3`}}}]}catch(i){throw e.logger.error("音乐生成失败",i),new Error(`音乐生成失败: ${i instanceof Error?i.message:"未知错误"}`)}},"audio.merge":async e=>{const{fadeIn:t,fadeOut:a,crossfade:n}=e.parameters,s=e.inputData.filter(e=>e.binary?.audio),r=e.inputData.find(e=>e.binary?.video)?.binary?.video;try{const e=await Pt.mergeAudioVideo({video:r?.data,audios:s.map(e=>({data:e.binary.audio.data,fadeIn:t,fadeOut:a})),crossfade:n});return r?[{json:{audioCount:s.length},binary:{video:{data:e.data,mimeType:"video/mp4",fileName:`final-${Date.now()}.mp4`}}}]:[{json:{audioCount:s.length},binary:{audio:{data:e.data,mimeType:"audio/mp3",fileName:`merged-audio-${Date.now()}.mp3`}}}]}catch(i){throw e.logger.error("音频合并失败",i),new Error(`音频合并失败: ${i instanceof Error?i.message:"未知错误"}`)}},"data.input":async e=>{const{dataType:t,value:a}=e.parameters;if("json"===t)try{return[{json:JSON.parse(a),binary:{}}]}catch{throw new Error("无效的 JSON 格式")}return[{json:{value:a},binary:{}}]},"data.transform":async e=>{const{transformations:t}=e.parameters;let a={...e.inputData[0]?.json||{}};for(const n of t||[]){const{type:e,field:t,value:s,mapping:r}=n;switch(e){case"set":a[t]=s;break;case"rename":void 0!==a[t]&&(a[r]=a[t],delete a[t]);break;case"delete":delete a[t];break;case"extract":a={[t]:a[t]}}}return[{json:a,binary:e.inputData[0]?.binary||{}}]},"data.merge":async e=>{const{mode:t,keepBinary:a}=e.parameters,n={json:{},binary:{}};for(const s of e.inputData)"append"===t?n.json={...n.json,...s.json}:"deep"===t?n.json=this.deepMerge(n.json,s.json):"array"===t&&(Array.isArray(n.json.items)||(n.json.items=[]),n.json.items.push(s.json)),!1!==a&&(n.binary={...n.binary,...s.binary});return[n]},"data.filter":async e=>{const{condition:t,keepMatching:a}=e.parameters,n=e.inputData.filter(e=>{const n=this.evaluateCondition(t,e.json);return a?n:!n});return n.length>0?n:[]},"data.code":async e=>{const{code:t,language:a}=e.parameters,n=e.inputData,s=t=>e.workflowData[t],r={id:e.workflowId,executionId:e.executionId};try{if("javascript"===a){const e=new Function("$input","$node","$workflow",t),a=await e(n,s,r);return Array.isArray(a)?a.map(e=>({json:e,binary:{}})):[{json:a,binary:{}}]}throw new Error(`不支持的语言: ${a}`)}catch(i){throw e.logger.error("代码执行失败",i),new Error(`代码执行失败: ${i instanceof Error?i.message:"未知错误"}`)}},"flow.condition":async e=>{const{conditions:t}=e.parameters,a=e.inputData[0]?.json||{};for(const n of t||[])if(this.evaluateCondition(n.expression,a))return[{json:{...a,conditionResult:n.output},binary:e.inputData[0]?.binary||{}}];return e.inputData},"flow.loop":async e=>{const{mode:t,maxIterations:a}=e.parameters,n=e.inputData,s=[];if("each"===t){const e=Math.min(n.length,a||100);for(let t=0;t<e;t++)s.push({json:{...n[t].json,index:t,total:e},binary:n[t].binary})}else if("count"===t){const t=Math.min(e.parameters.count||1,a||100);for(let e=0;e<t;e++)s.push({json:{index:e,total:t},binary:{}})}return s},"flow.parallel":async e=>e.inputData,"flow.delay":async e=>{const{delay:t,unit:a}=e.parameters,n="seconds"===a?1e3*t:"minutes"===a?60*t*1e3:"hours"===a?60*t*60*1e3:t;return await new Promise(e=>setTimeout(e,n)),e.inputData},"output.export":async e=>{const{format:t,filename:a}=e.parameters,n=e.inputData[0];let s,r;if(n?.binary){const e=Object.keys(n.binary)[0];s=n.binary[e].data,r=n.binary[e].mimeType}else s=JSON.stringify(n?.json||{},null,2),r="application/json";return[{json:{exported:!0,format:t,filename:a||`export-${Date.now()}`,mimeType:r,size:s.length},binary:{export:{data:s,mimeType:r,fileName:a||`export-${Date.now()}`}}}]},"output.save":async e=>{const{projectId:t,name:a,description:n}=e.parameters,s=e.inputData[0];try{const e={id:t||`project_${Date.now()}`,name:a||`工作流输出 ${(new Date).toLocaleString()}`,description:n||"从工作流生成的项目",data:s?.json||{},binaryData:s?.binary||{},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return ut.projects.save(e),[{json:{saved:!0,projectId:e.id,name:e.name,savedAt:e.updatedAt},binary:s?.binary||{}}]}catch(r){throw e.logger.error("保存失败",r),new Error(`保存失败: ${r instanceof Error?r.message:"未知错误"}`)}}}[e]||null}deepMerge(e,t){const a={...e};for(const n of Object.keys(t))"object"!=typeof t[n]||null===t[n]||Array.isArray(t[n])?a[n]=t[n]:a[n]=this.deepMerge(a[n]||{},t[n]);return a}evaluateCondition(e,t){try{let a=e;return a=a.replace(/\{\{\s*json\.(\w+(?:\.\w+)*)\s*\}\}/g,(e,a)=>{const n=a.split(".").reduce((e,t)=>e?.[t],t);return JSON.stringify(n)}),new Function("return ("+a+")")()}catch(a){return!1}}stop(e){const t=this.abortControllers.get(e);t&&t.abort()}getExecution(e){return this.executions.get(e)}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}emit(e){for(const a of this.listeners)try{a(e)}catch(t){}}},Ea=new class{workflows=new Map;storageKey="mangaai-workflows";constructor(){this.loadFromStorage()}createWorkflow(e,t){const a={id:C(),name:e,description:t,version:1,status:"draft",nodes:[],connections:[],settings:{timezone:"Asia/Shanghai",saveExecutionProgress:!0,saveManualExecutions:!0,maxExecutionTime:3600},metadata:{author:"ManGaAI",icon:"ApartmentOutlined",color:"#1890ff"},createdAt:Date.now(),updatedAt:Date.now()};return this.workflows.set(a.id,a),this.saveToStorage(),a}getWorkflow(e){return this.workflows.get(e)}getAllWorkflows(){return Array.from(this.workflows.values()).sort((e,t)=>t.updatedAt-e.updatedAt)}updateWorkflow(e,t){const a=this.workflows.get(e);if(a)return Object.assign(a,t,{updatedAt:Date.now()}),this.saveToStorage(),a}deleteWorkflow(e){const t=this.workflows.delete(e);return t&&this.saveToStorage(),t}duplicateWorkflow(e){const t=this.workflows.get(e);if(!t)return;const a=new Map;for(const i of t.nodes)a.set(i.id,C());const n=t.nodes.map(e=>({...e,id:a.get(e.id)})),s=t.connections.map(e=>({...e,id:C(),sourceNodeId:a.get(e.sourceNodeId),targetNodeId:a.get(e.targetNodeId)})),r={...t,id:C(),name:`${t.name} (副本)`,nodes:n,connections:s,status:"draft",createdAt:Date.now(),updatedAt:Date.now()};return this.workflows.set(r.id,r),this.saveToStorage(),r}addNode(e,t,a,n,s){const r=this.workflows.get(e);if(!r)return;const i=function(e,t,a,n,s){const r=Aa(e);if(!r)throw new Error(`Unknown node type: ${e}`);return{id:t,type:e,name:n||r.displayName,position:a,parameters:s||r.parameters.reduce((e,t)=>(void 0!==t.default&&(e[t.id]=t.default),e),{}),inputs:r.inputs,outputs:r.outputs,settings:{onError:"stop",...r.defaultSettings}}}(t,C(),a,n,s);return r.nodes.push(i),r.updatedAt=Date.now(),this.saveToStorage(),i}updateNode(e,t,a){const n=this.workflows.get(e);if(!n)return;const s=n.nodes.find(e=>e.id===t);return s?(Object.assign(s,a),n.updatedAt=Date.now(),this.saveToStorage(),s):void 0}deleteNode(e,t){const a=this.workflows.get(e);if(!a)return!1;const n=a.nodes.findIndex(e=>e.id===t);return-1!==n&&(a.nodes.splice(n,1),a.connections=a.connections.filter(e=>e.sourceNodeId!==t&&e.targetNodeId!==t),a.updatedAt=Date.now(),this.saveToStorage(),!0)}moveNode(e,t,a){return void 0!==this.updateNode(e,t,{position:a})}addConnection(e,t,a,n,s){const r=this.workflows.get(e);if(!r)return;const i=r.nodes.find(e=>e.id===t),o=r.nodes.find(e=>e.id===n);if(!i||!o)return;if(r.connections.some(e=>e.sourceNodeId===t&&e.targetNodeId===n&&e.sourceOutput===a&&e.targetInput===s))return;if(this.wouldCreateCycle(r,t,n))return;const l={id:C(),sourceNodeId:t,sourceOutput:a,targetNodeId:n,targetInput:s};return r.connections.push(l),r.updatedAt=Date.now(),this.saveToStorage(),l}deleteConnection(e,t){const a=this.workflows.get(e);if(!a)return!1;const n=a.connections.findIndex(e=>e.id===t);return-1!==n&&(a.connections.splice(n,1),a.updatedAt=Date.now(),this.saveToStorage(),!0)}wouldCreateCycle(e,t,a){const n=new Set,s=[t];for(;s.length>0;){const t=s.pop();if(t===a)return!0;if(!n.has(t)){n.add(t);for(const a of e.connections)a.targetNodeId===t&&s.push(a.sourceNodeId)}}return!1}async executeWorkflow(e,t="manual",a){const n=this.workflows.get(e);if(!n)throw new Error("工作流不存在");n.status="running",this.saveToStorage();try{const e=await Oa.execute(n,t,a);return n.status="success"===e.status?"completed":"error",n.updatedAt=Date.now(),this.saveToStorage(),e}catch(s){throw n.status="error",this.saveToStorage(),s}}stopExecution(e){Oa.stop(e)}subscribe(e){return Oa.subscribe(e)}getTemplates(){return[this.createComicDramaTemplate(),this.createImageToVideoTemplate(),this.createBatchProcessingTemplate()]}createFromTemplate(e){const t=this.getTemplates().find(t=>t.id===e);if(t)return this.duplicateWorkflow(t.id)}createComicDramaTemplate(){const e=this.createWorkflow("漫剧工作流","完整的 AI 漫剧创作流程"),t=this.addNode(e.id,"trigger.manual",{x:100,y:200}),a=this.addNode(e.id,"data.input",{x:300,y:200}),n=this.addNode(e.id,"ai.script",{x:500,y:200}),s=this.addNode(e.id,"ai.analyze",{x:700,y:200}),r=this.addNode(e.id,"image.generate",{x:900,y:100}),i=this.addNode(e.id,"video.generate",{x:1100,y:100}),o=this.addNode(e.id,"audio.tts",{x:900,y:300}),l=this.addNode(e.id,"audio.merge",{x:1100,y:300}),d=this.addNode(e.id,"output.export",{x:1300,y:200});return this.addConnection(e.id,t.id,"main",a.id,"main"),this.addConnection(e.id,a.id,"main",n.id,"main"),this.addConnection(e.id,n.id,"main",s.id,"main"),this.addConnection(e.id,s.id,"main",r.id,"main"),this.addConnection(e.id,r.id,"main",i.id,"main"),this.addConnection(e.id,s.id,"main",o.id,"main"),this.addConnection(e.id,i.id,"video",l.id,"video"),this.addConnection(e.id,o.id,"audio",l.id,"audio"),this.addConnection(e.id,l.id,"main",d.id,"main"),e}createImageToVideoTemplate(){const e=this.createWorkflow("图生视频","将静态图像转换为动态视频"),t=this.addNode(e.id,"trigger.manual",{x:100,y:200}),a=this.addNode(e.id,"image.generate",{x:300,y:200}),n=this.addNode(e.id,"video.generate",{x:500,y:200}),s=this.addNode(e.id,"output.export",{x:700,y:200});return this.addConnection(e.id,t.id,"main",a.id,"main"),this.addConnection(e.id,a.id,"main",n.id,"main"),this.addConnection(e.id,n.id,"main",s.id,"main"),e}createBatchProcessingTemplate(){const e=this.createWorkflow("批量处理","批量生成和处理内容"),t=this.addNode(e.id,"trigger.manual",{x:100,y:200}),a=this.addNode(e.id,"data.input",{x:300,y:200}),n=this.addNode(e.id,"flow.loop",{x:500,y:200}),s=this.addNode(e.id,"image.generate",{x:700,y:200}),r=this.addNode(e.id,"output.save",{x:900,y:200});return this.addConnection(e.id,t.id,"main",a.id,"main"),this.addConnection(e.id,a.id,"main",n.id,"main"),this.addConnection(e.id,n.id,"main",s.id,"main"),this.addConnection(e.id,s.id,"main",r.id,"main"),e}saveToStorage(){try{const e=JSON.stringify(Array.from(this.workflows.entries()));localStorage.setItem(this.storageKey,e)}catch(e){}}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.workflows=new Map(t)}}catch(e){this.workflows=new Map}}exportWorkflow(e){const t=this.workflows.get(e);if(t)return JSON.stringify(t,null,2)}importWorkflow(e){try{const t=JSON.parse(e);t.id=C(),t.createdAt=Date.now(),t.updatedAt=Date.now(),t.status="draft";const a=new Map;return t.nodes.forEach(e=>{a.set(e.id,C()),e.id=a.get(e.id)}),t.connections.forEach(e=>{e.id=C(),e.sourceNodeId=a.get(e.sourceNodeId)||e.sourceNodeId,e.targetNodeId=a.get(e.targetNodeId)||e.targetNodeId}),this.workflows.set(t.id,t),this.saveToStorage(),t}catch(t){return}}},Pa=Qe((e,t)=>({currentWorkflow:null,selectedNodeId:null,selectedConnectionId:null,isDragging:!1,isConnecting:!1,connectingFrom:null,viewport:{x:100,y:100,zoom:1},isExecuting:!1,currentExecution:null,executionLogs:[],showNodePanel:!0,showSettingsPanel:!1,history:[],historyIndex:-1,maxHistorySize:50,clipboard:[],setCurrentWorkflow:a=>{e({currentWorkflow:a,selectedNodeId:null,selectedConnectionId:null,history:[],historyIndex:-1}),a&&t().saveHistory()},selectNode:t=>{e({selectedNodeId:t,selectedConnectionId:null,showSettingsPanel:!!t})},selectConnection:t=>{e({selectedConnectionId:t,selectedNodeId:null})},addNode:(e,a)=>{const{currentWorkflow:n}=t();if(!n)return null;const s=Ea.addNode(n.id,e,a);return s&&(t().saveHistory(),t().refreshWorkflow()),s},updateNode:(e,a)=>{const{currentWorkflow:n}=t();n&&(Ea.updateNode(n.id,e,a),t().saveHistory(),t().refreshWorkflow())},deleteNode:a=>{const{currentWorkflow:n,selectedNodeId:s}=t();n&&(Ea.deleteNode(n.id,a),t().saveHistory(),t().refreshWorkflow(),s===a&&e({selectedNodeId:null}))},deleteSelectedNode:()=>{const{selectedNodeId:e}=t();e&&t().deleteNode(e)},moveNode:(e,a)=>{const{currentWorkflow:n}=t();n&&(Ea.moveNode(n.id,e,a),t().refreshWorkflow())},addConnection:(e,a,n,s)=>{const{currentWorkflow:r}=t();if(!r)return null;const i=Ea.addConnection(r.id,e,a,n,s);return i&&(t().saveHistory(),t().refreshWorkflow()),i},deleteConnection:a=>{const{currentWorkflow:n,selectedConnectionId:s}=t();n&&(Ea.deleteConnection(n.id,a),t().saveHistory(),t().refreshWorkflow(),s===a&&e({selectedConnectionId:null}))},startConnecting:(t,a)=>{e({isConnecting:!0,connectingFrom:{nodeId:t,output:a}})},stopConnecting:()=>{e({isConnecting:!1,connectingFrom:null})},setDragging:t=>{e({isDragging:t})},setViewport:t=>{e(e=>({viewport:{...e.viewport,...t}}))},fitView:()=>{const{currentWorkflow:a}=t();if(!a||0===a.nodes.length)return void e({viewport:{x:100,y:100,zoom:1}});let n=1/0,s=1/0,r=-1/0,i=-1/0;for(const e of a.nodes)n=Math.min(n,e.position.x),s=Math.min(s,e.position.y),r=Math.max(r,e.position.x+250),i=Math.max(i,e.position.y+100);const o=r-n+200,l=i-s+200,d=Math.min(1,Math.min(800/o,600/l));e({viewport:{x:(800-o*d)/2-n*d+100,y:(600-l*d)/2-s*d+100,zoom:d}})},executeWorkflow:async()=>{const{currentWorkflow:a,isExecuting:n}=t();if(!a||n)return;e({isExecuting:!0,executionLogs:[]});const s=Ea.subscribe(t=>{const{type:a,nodeId:n,data:s}=t;let r="";switch(a){case"workflow:start":r="🚀 工作流开始执行";break;case"workflow:complete":r="✅ 工作流执行完成";break;case"workflow:error":r=`❌ 工作流执行失败: ${s?.error}`;break;case"node:start":r="▶️ 开始执行节点";break;case"node:complete":r=`✅ 节点执行完成 (${s?.duration}ms)`;break;case"node:error":r=`❌ 节点执行失败: ${s?.error}`}r&&e(e=>({executionLogs:[...e.executionLogs,{timestamp:Date.now(),message:r,nodeId:n}]}))});try{const t=await Ea.executeWorkflow(a.id);e({currentExecution:t})}catch(r){}finally{s(),e({isExecuting:!1})}},stopExecution:()=>{const{currentExecution:a}=t();a&&Ea.stopExecution(a.id),e({isExecuting:!1})},clearExecutionLogs:()=>{e({executionLogs:[]})},toggleNodePanel:()=>{e(e=>({showNodePanel:!e.showNodePanel}))},toggleSettingsPanel:()=>{e(e=>({showSettingsPanel:!e.showSettingsPanel}))},saveHistory:()=>{const{currentWorkflow:a,history:n,historyIndex:s,maxHistorySize:r}=t();if(!a)return;const i={nodes:JSON.parse(JSON.stringify(a.nodes)),connections:JSON.parse(JSON.stringify(a.connections))},o=n.slice(0,s+1);o.push(i),o.length>r&&o.shift(),e({history:o,historyIndex:o.length-1})},undo:()=>{const{history:a,historyIndex:n,currentWorkflow:s}=t();if(!s||n<=0)return;const r=n-1,i=a[r];Ea.updateWorkflow(s.id,{nodes:JSON.parse(JSON.stringify(i.nodes)),connections:JSON.parse(JSON.stringify(i.connections))}),e({historyIndex:r}),t().refreshWorkflow()},redo:()=>{const{history:a,historyIndex:n,currentWorkflow:s}=t();if(!s||n>=a.length-1)return;const r=n+1,i=a[r];Ea.updateWorkflow(s.id,{nodes:JSON.parse(JSON.stringify(i.nodes)),connections:JSON.parse(JSON.stringify(i.connections))}),e({historyIndex:r}),t().refreshWorkflow()},canUndo:()=>{const{historyIndex:e}=t();return e>0},canRedo:()=>{const{history:e,historyIndex:a}=t();return a<e.length-1},copySelectedNode:()=>{const{currentWorkflow:a,selectedNodeId:n}=t();if(!a||!n)return;const s=a.nodes.find(e=>e.id===n);s&&e({clipboard:[JSON.parse(JSON.stringify(s))]})},pasteNode:e=>{const{currentWorkflow:a,clipboard:n}=t();if(a&&0!==n.length){for(const t of n){const n=e||{x:t.position.x+50,y:t.position.y+50};Ea.addNode(a.id,t.type,n,`${t.name} (副本)`,JSON.parse(JSON.stringify(t.parameters)))}t().saveHistory(),t().refreshWorkflow()}},refreshWorkflow:()=>{const{currentWorkflow:a}=t();if(!a)return;const n=Ea.getWorkflow(a.id);e({currentWorkflow:n||null})}})),$a={node:"_node_u0ut1_1",selected:"_selected_u0ut1_16",dragging:"_dragging_u0ut1_21",status_running:"_status_running_u0ut1_26",pulse:"_pulse_u0ut1_1",status_success:"_status_success_u0ut1_30",status_error:"_status_error_u0ut1_33",nodeContent:"_nodeContent_u0ut1_45",nodeHeader:"_nodeHeader_u0ut1_48",nodeIcon:"_nodeIcon_u0ut1_53",nodeInfo:"_nodeInfo_u0ut1_63",nodeName:"_nodeName_u0ut1_67",nodeType:"_nodeType_u0ut1_76",nodeStatus:"_nodeStatus_u0ut1_82",nodeParams:"_nodeParams_u0ut1_86",paramBadge:"_paramBadge_u0ut1_94",inputs:"_inputs_u0ut1_105",outputs:"_outputs_u0ut1_106",port:"_port_u0ut1_122",portDot:"_portDot_u0ut1_133",portLabel:"_portLabel_u0ut1_137",inputPort:"_inputPort_u0ut1_140",outputPort:"_outputPort_u0ut1_143",selectionBorder:"_selectionBorder_u0ut1_163"},Da={trigger:t.jsx(PlayCircleOutlined,{}),ai:t.jsx(RobotOutlined,{}),image:t.jsx(PictureOutlined,{}),video:t.jsx(VideoCameraOutlined,{}),audio:t.jsx(SoundOutlined,{}),data:t.jsx(DatabaseOutlined,{}),flow:t.jsx(BranchesOutlined,{}),output:t.jsx(ExportOutlined,{})},Ma={trigger:"#10b981",ai:"#8b5cf6",image:"#f59e0b",video:"#ef4444",audio:"#06b6d4",data:"#6366f1",flow:"#ec4899",output:"#14b8a6"},za={idle:{icon:null,color:""},running:{icon:t.jsx(LoadingOutlined,{spin:!0}),color:"#3b82f6"},success:{icon:t.jsx(CheckCircleOutlined,{}),color:"#10b981"},error:{icon:t.jsx(CloseCircleOutlined,{}),color:"#ef4444"},skipped:{icon:t.jsx(ClockCircleOutlined,{}),color:"#64748b"}},Ba=({node:a,isSelected:n,isConnecting:s,zoom:r,onSelect:i,onMove:o,onConnectionStart:l,onConnectionEnd:d})=>{const[c,u]=e.useState(!1),[p,m]=e.useState({x:0,y:0,nodeX:0,nodeY:0}),h=e.useRef(null),g=Aa(a.type);if(!g)return null;const y=g.category,x=Ma[y]||"#666",j=za[a.status||"idle"];e.useEffect(()=>{if(!c)return;const e=e=>{const t=(e.clientX-p.x)/r,a=(e.clientY-p.y)/r;o({x:Math.max(0,p.nodeX+t),y:Math.max(0,p.nodeY+a)})},t=()=>{u(!1)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[c,p,r,o]);const f=(e,a)=>e.map((e,n)=>t.jsxs("div",{className:`${$a.port} ${"input"===a?$a.inputPort:$a.outputPort}`,style:{"--port-color":x},onMouseDown:t=>{"output"===a&&(t.stopPropagation(),l(e.id))},onMouseUp:t=>{"input"===a&&s&&(t.stopPropagation(),d(e.id))},title:e.displayName,children:[t.jsx("div",{className:$a.portDot}),t.jsx("span",{className:$a.portLabel,children:e.displayName})]},e.id));return t.jsxs("div",{ref:h,className:`${$a.node} ${n?$a.selected:""} ${c?$a.dragging:""} ${a.status?$a[`status_${a.status}`]:""}`,style:{left:a.position.x,top:a.position.y,"--node-color":x,"--status-color":j.color},onMouseDown:e=>{0===e.button&&(e.stopPropagation(),i(),u(!0),m({x:e.clientX,y:e.clientY,nodeX:a.position.x,nodeY:a.position.y}))},children:[t.jsx("div",{className:$a.inputs,children:f(g.inputs,"input")}),t.jsxs("div",{className:$a.nodeContent,children:[t.jsxs("div",{className:$a.nodeHeader,children:[t.jsx("div",{className:$a.nodeIcon,style:{backgroundColor:`${x}20`,color:x},children:Da[y]}),t.jsxs("div",{className:$a.nodeInfo,children:[t.jsx("span",{className:$a.nodeName,children:a.name}),t.jsx("span",{className:$a.nodeType,children:g.displayName})]}),j.icon&&t.jsx("div",{className:$a.nodeStatus,style:{color:j.color},children:j.icon})]}),Object.keys(a.parameters).length>0&&t.jsx("div",{className:$a.nodeParams,children:Object.entries(a.parameters).slice(0,2).map(([e,a])=>t.jsxs("span",{className:$a.paramBadge,children:[String(a).substring(0,15),String(a).length>15?"...":""]},e))})]}),t.jsx("div",{className:$a.outputs,children:f(g.outputs,"output")}),n&&t.jsx("div",{className:$a.selectionBorder})]})},Fa=({connection:e,nodes:a,isDraft:n=!1,startPos:s,endPos:r,isSelected:i=!1,onClick:o})=>{const l=(()=>{if(n&&s&&r)return{x1:s.x,y1:s.y,x2:r.x,y2:r.y};if(e&&a){const t=a.find(t=>t.id===e.sourceNodeId),n=a.find(t=>t.id===e.targetNodeId);if(t&&n){const a=Aa(t.type),s=Aa(n.type),r=a?.outputs.findIndex(t=>t.id===e.sourceOutput)||0,i=s?.inputs.findIndex(t=>t.id===e.targetInput)||0;return{x1:t.position.x+250,y1:t.position.y+50+28*r,x2:n.position.x,y2:n.position.y+50+28*i}}}return null})();if(!l)return null;const{x1:d,y1:c,x2:u,y2:p}=l,m=((e,t,a,n)=>{const s=Math.abs(a-e),r=Math.min(.5*s,100);return`M ${e} ${t} C ${e+r} ${t}, ${a-r} ${n}, ${a} ${n}`})(d,c,u,p);return t.jsxs("g",{className:`_connection_lcdzn_1 ${i?"_selected_lcdzn_8":""} ${n?"_draft_lcdzn_15":""}`,onClick:o,children:[t.jsx("path",{d:m,fill:"none",stroke:"transparent",strokeWidth:20,style:{cursor:"pointer"}}),t.jsx("path",{d:m,fill:"none",stroke:i?"#e94560":"#64748b",strokeWidth:i?3:2,strokeLinecap:"round",className:"_line_lcdzn_4"}),!n&&!i&&t.jsx("circle",{r:"3",fill:"#e94560",className:"_animatedDot_lcdzn_28",children:t.jsx("animateMotion",{dur:"2s",repeatCount:"indefinite",path:m,rotate:"auto"})}),i&&t.jsx("path",{d:m,fill:"none",stroke:"#e94560",strokeWidth:6,strokeLinecap:"round",className:"_glow_lcdzn_12"})]})},La="_canvas_1qn4g_1",Ra=()=>{const{currentWorkflow:a,viewport:n,selectedNodeId:s,selectedConnectionId:r,isConnecting:i,connectingFrom:o,selectNode:l,selectConnection:d,moveNode:c,addConnection:u,startConnecting:p,stopConnecting:m,setViewport:h}=Pa(),g=e.useRef(null),[y,x]=e.useState(!1),[j,f]=e.useState({x:0,y:0}),[_,v]=e.useState({x:0,y:0}),w=e.useCallback((e,t)=>{if(!g.current)return{x:0,y:0};const a=g.current.getBoundingClientRect();return{x:(e-a.left-n.x)/n.zoom,y:(t-a.top-n.y)/n.zoom}},[n]),S=()=>{x(!1)},b=e.useCallback(e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1,a=Math.max(.25,Math.min(2,n.zoom*t));if(g.current){const t=g.current.getBoundingClientRect(),s=e.clientX-t.left,r=e.clientY-t.top,i=s-(s-n.x)*(a/n.zoom),o=r-(r-n.y)*(a/n.zoom);h({x:i,y:o,zoom:a})}},[n,h]),C=e.useCallback((e,t)=>{o&&o.nodeId!==e&&u(o.nodeId,o.output,e,t),m()},[o,u,m]);if(e.useEffect(()=>{const e=e=>{"Escape"===e.key&&i&&m()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[i,m]),!a)return t.jsx("div",{className:"_emptyCanvas_1qn4g_22",children:t.jsxs("div",{className:"_emptyContent_1qn4g_30",children:[t.jsx("div",{className:"_emptyIcon_1qn4g_34",children:"📋"}),t.jsx("p",{className:"_emptyTitle_1qn4g_38",children:"拖拽左侧节点到画布"}),t.jsx("p",{className:"_emptyDesc_1qn4g_43",children:"开始创建你的工作流"})]})});const{nodes:N,connections:k}=a;return t.jsxs("div",{ref:g,className:`${La} ${y?"_panning_1qn4g_9":""}`,onMouseDown:e=>{if(1===e.button||0===e.button&&e.altKey)return e.preventDefault(),x(!0),void f({x:e.clientX-n.x,y:e.clientY-n.y})},onMouseMove:e=>{const t=w(e.clientX,e.clientY);v(t),y&&h({x:e.clientX-j.x,y:e.clientY-j.y})},onMouseUp:S,onMouseLeave:S,onClick:e=>{(e.target===g.current||e.target.classList.contains(La))&&(l(null),d(null),m())},onWheel:b,children:[t.jsx("div",{className:"_grid_1qn4g_12",style:{backgroundPosition:`${n.x}px ${n.y}px`,backgroundSize:`${20*n.zoom}px ${20*n.zoom}px`}}),t.jsxs("svg",{className:"_connectionsLayer_1qn4g_47",style:{transform:`translate(${n.x}px, ${n.y}px) scale(${n.zoom})`,transformOrigin:"0 0"},children:[t.jsx("defs",{children:t.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:t.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#64748b"})})}),k.map(e=>t.jsx(Fa,{connection:e,nodes:N,isSelected:e.id===r,onClick:()=>{d(e.id),l(null)}},e.id)),i&&o&&t.jsx(Fa,{isDraft:!0,startPos:qa(N,o.nodeId,o.output),endPos:_})]}),t.jsx("div",{className:"_nodesLayer_1qn4g_61",style:{transform:`translate(${n.x}px, ${n.y}px) scale(${n.zoom})`,transformOrigin:"0 0"},children:N.map(e=>t.jsx(Ba,{node:e,isSelected:e.id===s,isConnecting:i,zoom:n.zoom,onSelect:()=>{l(e.id),d(null)},onMove:t=>c(e.id,t),onConnectionStart:t=>p(e.id,t),onConnectionEnd:t=>C(e.id,t)},e.id))}),t.jsxs("div",{className:"_zoomIndicator_1qn4g_67",children:[Math.round(100*n.zoom),"%"]})]})};function qa(e,t,a){const n=e.find(e=>e.id===t);if(!n)return{x:0,y:0};const s=Aa(n.type),r=s?.outputs.findIndex(e=>e.id===a)||0;return{x:n.position.x+250,y:n.position.y+50+28*r}}const{Panel:Wa}=x,Va=[{key:"trigger",name:"触发器",icon:t.jsx(PlayCircleOutlined,{}),color:"#10b981"},{key:"ai",name:"AI",icon:t.jsx(RobotOutlined,{}),color:"#8b5cf6"},{key:"image",name:"图像",icon:t.jsx(PictureOutlined,{}),color:"#f59e0b"},{key:"video",name:"视频",icon:t.jsx(VideoCameraOutlined,{}),color:"#ef4444"},{key:"audio",name:"音频",icon:t.jsx(SoundOutlined,{}),color:"#06b6d4"},{key:"data",name:"数据",icon:t.jsx(DatabaseOutlined,{}),color:"#6366f1"},{key:"flow",name:"流程控制",icon:t.jsx(BranchesOutlined,{}),color:"#ec4899"},{key:"output",name:"输出",icon:t.jsx(ExportOutlined,{}),color:"#14b8a6"}],Ka=()=>{const[a,n]=e.useState("");return t.jsxs("div",{className:"_nodePanel_1nad1_1",children:[t.jsx("div",{className:"_searchWrapper_1nad1_8",children:t.jsx(Input,{prefix:t.jsx(SearchOutlined,{}),placeholder:"搜索节点...",value:a,onChange:e=>n(e.target.value),allowClear:!0})}),t.jsx(Collapse,{defaultActiveKey:Va.map(e=>e.key),ghost:!0,className:"_collapse_1nad1_28",children:Va.map(e=>{const n=(e=>{if(!a)return e;const t=a.toLowerCase();return e.filter(e=>e.displayName.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))})(Ta[e.key]||[]);return 0===n.length?null:t.jsx(Wa,{header:t.jsxs("div",{className:"_categoryHeader_1nad1_45",children:[t.jsx("span",{style:{color:e.color},children:e.icon}),t.jsx("span",{children:e.name}),t.jsx(Badge,{count:n.length,style:{backgroundColor:e.color}})]}),children:t.jsx("div",{className:"_nodeList_1nad1_51",children:n.map(a=>t.jsxs("div",{className:"_nodeItem_1nad1_57",draggable:!0,onDragStart:e=>((e,t)=>{e.dataTransfer.setData("nodeType",t),e.dataTransfer.effectAllowed="copy"})(e,a.type),children:[t.jsx("div",{className:"_nodeIcon_1nad1_74",style:{backgroundColor:e.color},children:e.icon}),t.jsxs("div",{className:"_nodeInfo_1nad1_84",children:[t.jsx("div",{className:"_nodeName_1nad1_88",children:a.displayName}),t.jsx("div",{className:"_nodeDesc_1nad1_93",children:a.description})]})]},a.type))})},e.key)})})]})},Ua=({nodeId:e})=>{const{currentWorkflow:a,updateNode:n,deleteNode:s,copySelectedNode:r,pasteNode:i}=Pa(),[o]=b.useForm(),l=a?.nodes.find(t=>t.id===e),d=l?Aa(l.type):null;if(!l||!d)return t.jsx("div",{className:"_empty_pacu3_9",children:"节点不存在"});const c=e=>{const a={placeholder:e.placeholder};switch(e.type){case"string":return"prompt"===e.id||"text"===e.id?t.jsx(Input.TextArea,{rows:4,...a}):t.jsx(Input,{...a});case"number":return e.id.includes("temperature")||e.id.includes("pitch")?t.jsx(Slider,{min:0,max:2,step:.1,marks:{0:"0",1:"1",2:"2"}}):t.jsx(InputNumber,{style:{width:"100%"},min:e.min,max:e.max});case"boolean":return t.jsx(Switch,{});case"select":return t.jsx(Select,{children:e.options?.map(e=>t.jsx(Select.Option,{value:e.value,children:e.label},e.value))});case"multiselect":return t.jsx(Select,{mode:"multiple",children:e.options?.map(e=>t.jsx(Select.Option,{value:e.value,children:e.label},e.value))});case"code":case"json":return t.jsx(Input.TextArea,{rows:6,className:"_codeEditor_pacu3_70",...a});default:return t.jsx(Input,{...a})}};return t.jsxs("div",{className:"_panel_pacu3_1",children:[t.jsxs("div",{className:"_header_pacu3_14",children:[t.jsx("h3",{children:l.name}),t.jsx("span",{className:"_nodeType_pacu3_19",children:d.displayName})]}),t.jsx(Divider,{}),t.jsxs(Form,{form:o,layout:"vertical",initialValues:l.parameters,onValuesChange:t=>{n(e,{parameters:{...l.parameters,...t}})},className:"_form_pacu3_23",children:[t.jsx(Form.Item,{label:"名称",children:t.jsx(Input,{value:l.name,onChange:t=>n(e,{name:t.target.value})})}),d.parameters.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(Divider,{children:"参数配置"}),d.parameters.map(e=>t.jsx(Form.Item,{label:t.jsxs("span",{children:[e.displayName,e.description&&t.jsx(Tooltip,{title:e.description,children:t.jsx(QuestionCircleOutlined,{style:{marginLeft:4,color:"#64748b"}})})]}),name:e.id,required:e.required,children:c(e)},e.id))]}),t.jsx(Divider,{children:"高级设置"}),t.jsxs(Form.Item,{label:"执行一次",children:[t.jsx(Switch,{checked:l.settings.executeOnce,onChange:t=>n(e,{settings:{...l.settings,executeOnce:t}})}),t.jsx("span",{className:"_hint_pacu3_74",children:"仅处理第一个输入项"})]}),t.jsx(Form.Item,{label:"失败重试",children:t.jsx(Switch,{checked:l.settings.retryOnFail,onChange:t=>n(e,{settings:{...l.settings,retryOnFail:t}})})}),l.settings.retryOnFail&&t.jsx(Form.Item,{label:"重试次数",children:t.jsx(InputNumber,{value:l.settings.retryCount||2,onChange:t=>n(e,{settings:{...l.settings,retryCount:t||2}}),min:1,max:5})}),t.jsx(Form.Item,{label:"超时时间 (秒)",children:t.jsx(InputNumber,{value:l.settings.timeout||60,onChange:t=>n(e,{settings:{...l.settings,timeout:t||60}}),min:10,max:600,style:{width:"100%"}})}),t.jsx(Form.Item,{label:"错误处理",children:t.jsxs(Select,{value:l.settings.onError||"stop",onChange:t=>n(e,{settings:{...l.settings,onError:t}}),children:[t.jsx(Select.Option,{value:"stop",children:"停止工作流"}),t.jsx(Select.Option,{value:"continue",children:"继续执行"}),t.jsx(Select.Option,{value:"continueWithError",children:"继续并传递错误"})]})}),t.jsx(Form.Item,{label:"备注",children:t.jsx(Input.TextArea,{value:l.settings.notes,onChange:t=>n(e,{settings:{...l.settings,notes:t.target.value}}),rows:2,placeholder:"添加节点备注..."})})]}),t.jsx(Divider,{}),t.jsxs("div",{className:"_actions_pacu3_80",children:[t.jsx(Button,{icon:t.jsx(CopyOutlined,{}),onClick:()=>{r(),i({x:l.position.x+50,y:l.position.y+50})},children:"复制节点"}),t.jsx(Popconfirm,{title:"确定删除此节点？",onConfirm:()=>{s(e)},okText:"删除",cancelText:"取消",children:t.jsx(Button,{danger:!0,icon:t.jsx(DeleteOutlined,{}),children:"删除节点"})})]})]})},Ha=()=>{const{isExecuting:e,currentExecution:a,executionLogs:n,executeWorkflow:s,stopExecution:r,clearExecutionLogs:i}=Pa();return t.jsxs("div",{className:"_panel_1846c_1",children:[t.jsx("div",{className:"_header_1846c_8",children:t.jsx("h3",{children:"执行面板"})}),t.jsxs("div",{className:"_controls_1846c_16",children:[e?t.jsx(Button,{type:"primary",danger:!0,onClick:r,children:"停止执行"}):t.jsx(Button,{type:"primary",icon:t.jsx(PlayCircleOutlined,{}),onClick:s,children:"执行工作流"}),t.jsx(Button,{onClick:i,children:"清空日志"})]}),a&&t.jsxs("div",{className:"_status_1846c_24",children:[t.jsx(Tag,{color:"success"===a.status?"green":"error"===a.status?"red":"blue",children:"running"===a.status?"执行中":"success"===a.status?"成功":"失败"}),a.duration&&t.jsxs("span",{className:"_duration_1846c_33",children:[a.duration,"ms"]})]}),t.jsx("div",{className:"_logs_1846c_37",children:0===n.length?t.jsx(Empty,{description:"暂无执行记录"}):t.jsx(Timeline,{items:n.map((e,a)=>({key:a,color:e.message.includes("✅")?"green":e.message.includes("❌")?"red":"blue",children:t.jsxs("div",{className:"_logItem_1846c_44",children:[t.jsx("span",{className:"_logTime_1846c_49",children:new Date(e.timestamp).toLocaleTimeString()}),t.jsx("span",{className:"_logMessage_1846c_53",children:e.message})]})}))})})]})},Ja="_canvasContainer_yoxyw_81",{Header:Ga,Sider:Xa,Content:Ya}=u,Qa=({workflowId:a})=>{const{currentWorkflow:n,selectedNodeId:s,selectedConnectionId:r,isExecuting:i,showNodePanel:o,showSettingsPanel:l,viewport:d,canUndo:c,canRedo:u,setCurrentWorkflow:p,addNode:m,deleteSelectedNode:g,executeWorkflow:y,stopExecution:x,setViewport:j,fitView:f,undo:_,redo:v,copySelectedNode:w,pasteNode:b,toggleNodePanel:C,toggleSettingsPanel:N}=Pa();e.useEffect(()=>{if(a){const e=Ea.getWorkflow(a);e&&p(e)}else{const e=Ea.createWorkflow("新工作流");p(e)}},[a,p]),e.useEffect(()=>{const e=e=>{!e.ctrlKey&&!e.metaKey||"z"!==e.key||e.shiftKey||(e.preventDefault(),_()),(e.ctrlKey||e.metaKey)&&("y"===e.key||"z"===e.key&&e.shiftKey)&&(e.preventDefault(),v()),(e.ctrlKey||e.metaKey)&&"c"===e.key&&s&&(e.preventDefault(),w()),(e.ctrlKey||e.metaKey)&&"v"===e.key&&(e.preventDefault(),b()),"Delete"!==e.key&&"Backspace"!==e.key||!s||(e.preventDefault(),g())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[_,v,w,b,g,s]);const k=e.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.getData("nodeType");if(!t)return;const a=e.target.closest(`.${Ja}`)?.getBoundingClientRect();if(!a)return;const n=(e.clientX-a.left-d.x)/d.zoom,s=(e.clientY-a.top-d.y)/d.zoom;m(t,{x:n,y:s})},[d,m]);return t.jsxs(Layout,{className:"_workflowEditor_yoxyw_1",children:[t.jsxs(Ga,{className:"_header_yoxyw_5",children:[t.jsxs("div",{className:"_title_yoxyw_15",children:[t.jsx(AppstoreOutlined,{}),t.jsx("span",{children:n?.name||"工作流编辑器"})]}),t.jsxs(Space,{className:"_toolbar_yoxyw_26",children:[t.jsxs(Space.Compact,{children:[t.jsx(Tooltip,{title:"新建 (Ctrl+N)",children:t.jsx(Button,{icon:t.jsx(PlusOutlined,{}),onClick:()=>{S.confirm({title:"新建工作流",content:t.jsx(Input,{placeholder:"输入工作流名称",id:"workflow-name-input",defaultValue:"新工作流"}),onOk:()=>{const e=document.getElementById("workflow-name-input")?.value||"新工作流",t=Ea.createWorkflow(e);p(t),h.success("创建成功")}})}})}),t.jsx(Tooltip,{title:"打开",children:t.jsx(Button,{icon:t.jsx(FolderOutlined,{}),onClick:()=>{const e=Ea.getAllWorkflows();S.info({title:"工作流列表",width:600,content:t.jsx("div",{style:{maxHeight:400,overflow:"auto"},children:e.map(e=>t.jsxs("div",{style:{padding:"12px",borderBottom:"1px solid #eee",cursor:"pointer"},onClick:()=>{p(e),S.destroyAll()},children:[t.jsx("div",{style:{fontWeight:500},children:e.name}),t.jsxs("div",{style:{fontSize:12,color:"#999"},children:[e.nodes.length," 节点 · ",new Date(e.updatedAt).toLocaleString()]})]},e.id))})})}})}),t.jsx(Tooltip,{title:"导入",children:t.jsx(Button,{icon:t.jsx(ImportOutlined,{}),onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files?.[0];if(!t)return;const a=await t.text(),n=Ea.importWorkflow(a);n?(p(n),h.success("导入成功")):h.error("导入失败：无效的工作流文件")},e.click()}})}),t.jsx(Tooltip,{title:"导出",children:t.jsx(Button,{icon:t.jsx(ExportOutlined,{}),onClick:()=>{if(!n)return;const e=Ea.exportWorkflow(n.id);if(e){const t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`${n.name}.json`,s.click(),URL.revokeObjectURL(a),h.success("导出成功")}}})})]}),t.jsxs(Space.Compact,{children:[t.jsx(Tooltip,{title:"撤销 (Ctrl+Z)",children:t.jsx(Button,{icon:t.jsx(UndoOutlined,{}),onClick:_,disabled:!c()})}),t.jsx(Tooltip,{title:"重做 (Ctrl+Y)",children:t.jsx(Button,{icon:t.jsx(RedoOutlined,{}),onClick:v,disabled:!u()})})]}),(s||r)&&t.jsx(Popconfirm,{title:"确定删除选中的节点？",onConfirm:g,children:t.jsx(Button,{danger:!0,icon:t.jsx(DeleteOutlined,{}),children:"删除"})}),t.jsxs(Space.Compact,{children:[t.jsx(Tooltip,{title:"放大",children:t.jsx(Button,{icon:t.jsx(ZoomInOutlined,{}),onClick:()=>j({zoom:Math.min(1.2*d.zoom,2)})})}),t.jsx(Tooltip,{title:"缩小",children:t.jsx(Button,{icon:t.jsx(ZoomOutOutlined,{}),onClick:()=>j({zoom:Math.max(d.zoom/1.2,.25)})})}),t.jsx(Tooltip,{title:"适应视图",children:t.jsx(Button,{icon:t.jsx(FitViewOutlined,{}),onClick:()=>f()})})]}),t.jsxs("span",{className:"_zoomLevel_yoxyw_61",children:[Math.round(100*d.zoom),"%"]}),i?t.jsx(Button,{type:"primary",danger:!0,icon:t.jsx(ClearOutlined,{}),onClick:x,children:"停止"}):t.jsx(Button,{type:"primary",icon:t.jsx(PlayCircleOutlined,{}),onClick:y,disabled:!n?.nodes.length,children:"执行"}),t.jsx(Button,{icon:t.jsx(SettingOutlined,{}),onClick:N,type:l?"primary":"default",children:"设置"})]})]}),t.jsxs(Layout,{children:[o&&t.jsx(Xa,{width:280,className:"_sider_yoxyw_68",children:t.jsx(Ka,{})}),t.jsx(Ya,{className:"_content_yoxyw_76",children:t.jsx("div",{className:Ja,onDrop:k,onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},children:t.jsx(Ra,{})})}),l&&t.jsx(Xa,{width:320,className:"_siderRight_yoxyw_72",children:s?t.jsx(Ua,{nodeId:s}):t.jsx(Ha,{})})]})]})},Za="_card_1ijd0_1",en="_installMethod_1ijd0_30",{Text:tn,Title:an,Paragraph:nn}=p,sn=()=>{const[a,n]=e.useState(null),[s,r]=e.useState(!1),i=async()=>{r(!0);try{const e=await Pt.checkFFmpeg();n(e)}catch(e){}finally{r(!1)}};return e.useEffect(()=>{i()},[]),s?t.jsx(Card,{className:Za,children:t.jsxs("div",{className:"_loading_1ijd0_4",children:[t.jsx(Spin,{}),t.jsx(tn,{children:"正在检查 FFmpeg..."})]})}):a?t.jsx(Card,{className:Za,title:t.jsxs(Space,{children:[t.jsx(ToolOutlined,{}),t.jsx("span",{children:"FFmpeg 状态"}),a.installed?t.jsx(Badge,{status:"success",text:"已安装"}):t.jsx(Badge,{status:"error",text:"未安装"})]}),extra:t.jsx(Button,{icon:t.jsx(ReloadOutlined,{}),onClick:i,loading:s,size:"small",children:"刷新"}),children:a.installed?t.jsxs("div",{className:"_installed_1ijd0_11",children:[t.jsx(Alert,{message:"FFmpeg 已安装",description:"视频处理功能已就绪",type:"success",showIcon:!0,icon:t.jsx(CheckCircleOutlined,{})}),a.version&&t.jsx(Descriptions,{size:"small",bordered:!0,className:"_details_1ijd0_11",children:t.jsx(Descriptions.Item,{label:"版本",span:3,children:t.jsx(tn,{code:!0,children:a.version})})}),t.jsxs("div",{className:"_features_1ijd0_14",children:[t.jsx(an,{level:5,children:"可用功能"}),t.jsxs(Space,{wrap:!0,children:[t.jsx(Tag,{color:"green",children:"视频剪辑"}),t.jsx(Tag,{color:"green",children:"格式转换"}),t.jsx(Tag,{color:"green",children:"提取关键帧"}),t.jsx(Tag,{color:"green",children:"生成缩略图"}),t.jsx(Tag,{color:"green",children:"添加字幕"}),t.jsx(Tag,{color:"green",children:"转场效果"}),t.jsx(Tag,{color:"green",children:"音量调节"})]})]})]}):t.jsxs("div",{className:"_notInstalled_1ijd0_20",children:[t.jsx(Alert,{message:"FFmpeg 未安装",description:"视频处理功能需要 FFmpeg，请安装后刷新",type:"error",showIcon:!0,icon:t.jsx(CloseCircleOutlined,{})}),t.jsxs("div",{className:"_installGuide_1ijd0_20",children:[t.jsx(an,{level:5,children:"安装指南"}),t.jsxs("div",{className:en,children:[t.jsx(tn,{strong:!0,children:"方法 1：使用包管理器（推荐）"}),t.jsx("div",{className:"_codeBlock_1ijd0_36",children:t.jsx("code",{children:(()=>{const e=navigator.platform.toLowerCase();return e.includes("win")?"winget install Gyan.FFmpeg":e.includes("mac")?"brew install ffmpeg":"sudo apt install ffmpeg  # Ubuntu/Debian\nsudo yum install ffmpeg  # CentOS/RHEL"})()})})]}),t.jsxs("div",{className:en,children:[t.jsx(tn,{strong:!0,children:"方法 2：手动下载"}),t.jsxs(nn,{children:["访问 FFmpeg 官网下载对应系统的安装包：",t.jsx("br",{}),t.jsxs("a",{href:(()=>{const e=navigator.platform.toLowerCase();return e.includes("win")?"https://ffmpeg.org/download.html#build-windows":e.includes("mac")?"https://ffmpeg.org/download.html#build-mac":"https://ffmpeg.org/download.html#build-linux"})(),target:"_blank",rel:"noopener noreferrer",children:[t.jsx(DownloadOutlined,{})," 下载 FFmpeg"]})]})]}),t.jsxs("div",{className:en,children:[t.jsx(tn,{strong:!0,children:"安装后"}),t.jsx(nn,{children:'安装完成后，请确保 FFmpeg 已添加到系统 PATH，然后点击上方"刷新"按钮。'})]})]}),t.jsx(Alert,{message:"为什么需要 FFmpeg？",description:"FFmpeg 是业界标准的音视频处理工具，提供视频剪辑、转码、合并、添加特效等功能。",type:"info",showIcon:!0,icon:t.jsx(InfoCircleOutlined,{})})]})}):t.jsx(Card,{className:Za,children:t.jsx(Alert,{message:"检查失败",description:"无法检查 FFmpeg 状态，请重试",type:"warning",action:t.jsx(Button,{size:"small",onClick:i,children:"重试"})})})},{TextArea:rn}=j,{Option:on}=k,{Text:ln}=p,dn=[{key:"bytedance-seedream",name:"字节 Seedream",type:"image",desc:"高质量图像生成"},{key:"bytedance-seedance",name:"字节 Seedance",type:"video",desc:"高质量视频生成"},{key:"kling",name:"快手可灵",type:"both",desc:"图像+视频生成"},{key:"vidu",name:"生数 Vidu",type:"video",desc:"视频生成"}],cn=[{label:"1:1 方形",value:"1:1"},{label:"16:9 宽屏",value:"16:9"},{label:"9:16 竖屏",value:"9:16"},{label:"4:3 标准",value:"4:3"},{label:"3:4 竖版",value:"3:4"}],un=({type:e,prompt:a,negativePrompt:n,provider:s,style:r,aspectRatio:i,numImages:o,duration:l,motionStrength:d,referenceImage:c,isGenerating:u,progress:p,onPromptChange:m,onNegativePromptChange:h,onProviderChange:g,onStyleChange:y,onAspectRatioChange:x,onNumImagesChange:j,onDurationChange:f,onMotionStrengthChange:_,onReferenceImageChange:v,onGenerate:w})=>{const S=dn.filter(t=>t.type===e||"both"===t.type),b="image"===e?It:Tt;return t.jsx(Card,{title:"生成设置",children:t.jsxs(Space,{direction:"vertical",style:{width:"100%"},size:"large",children:[t.jsxs("div",{children:[t.jsx(ln,{strong:!0,children:"描述词"}),t.jsx(rn,{rows:3,value:a,onChange:e=>m(e.target.value),placeholder:`描述你想要的${"image"===e?"图像":"视频"}内容...`,disabled:u})]}),t.jsxs("div",{children:[t.jsx(ln,{strong:!0,children:"反向描述词（可选）"}),t.jsx(rn,{rows:2,value:n,onChange:e=>h(e.target.value),placeholder:"描述你不想要的内容...",disabled:u})]}),t.jsxs("div",{children:[t.jsx(ln,{strong:!0,children:"AI 提供商"}),t.jsx(Select,{style:{width:"100%"},value:s,onChange:g,disabled:u,children:S.map(e=>t.jsxs(on,{value:e.key,children:[e.name," - ",e.desc]},e.key))})]}),t.jsxs("div",{children:[t.jsx(ln,{strong:!0,children:"风格"}),t.jsx(Select,{style:{width:"100%"},value:r,onChange:y,disabled:u,children:b.map(e=>t.jsx(on,{value:e.id,children:e.name},e.id))})]}),t.jsxs("div",{children:[t.jsx(ln,{strong:!0,children:"画面比例"}),t.jsx(Radio.Group,{value:i,onChange:e=>x(e.target.value),disabled:u,children:cn.map(e=>t.jsx(Radio.Button,{value:e.value,children:e.label},e.value))})]}),"image"===e&&t.jsxs("div",{children:[t.jsxs(ln,{strong:!0,children:["生成数量: ",o]}),t.jsx(Slider,{min:1,max:4,value:o,onChange:j,disabled:u})]}),"video"===e&&t.jsxs("div",{children:[t.jsx(ln,{strong:!0,children:"视频时长"}),t.jsxs(Radio.Group,{value:l,onChange:e=>f(e.target.value),disabled:u,children:[t.jsx(Radio.Button,{value:5,children:"5 秒"}),t.jsx(Radio.Button,{value:10,children:"10 秒"})]})]}),"video"===e&&t.jsxs("div",{children:[t.jsxs(ln,{strong:!0,children:["运动强度: ",Math.round(100*d),"%"]}),t.jsx(Slider,{min:0,max:1,step:.1,value:d,onChange:_,disabled:u})]}),"video"===e&&t.jsxs("div",{children:[t.jsx(ln,{strong:!0,children:"参考图像（可选）"}),t.jsx(Upload,{accept:"image/*",maxCount:1,fileList:c?[c]:[],onRemove:()=>v(null),beforeUpload:e=>(v(e),!1),disabled:u,children:t.jsx(Button,{icon:t.jsx(PlusOutlined,{}),children:"上传参考图"})})]}),t.jsx(Button,{type:"primary",size:"large",icon:u?t.jsx(LoadingOutlined,{}):t.jsx(PlusOutlined,{}),onClick:w,loading:u,block:!0,children:u?`生成中 ${p}%`:"开始生成"+("image"===e?"图像":"视频")}),u&&t.jsx(Progress,{percent:p,status:"active"})]})})},{Text:pn}=p,mn={pending:{text:"等待中",color:"default",icon:t.jsx(ClockCircleOutlined,{})},generating:{text:"生成中",color:"processing",icon:t.jsx(LoadingOutlined,{spin:!0})},completed:{text:"已完成",color:"success",icon:t.jsx(CheckCircleOutlined,{})},failed:{text:"失败",color:"error",icon:t.jsx(CloseCircleOutlined,{})},cancelled:{text:"已取消",color:"default",icon:t.jsx(CloseCircleOutlined,{})}},hn={image:"图像",video:"视频"},gn=({tasks:e,onDownload:a,onCancel:n,onDelete:s})=>0===e.length?t.jsx(Card,{title:"任务历史",children:t.jsx(Empty,{description:"暂无生成任务"})}):t.jsx(Card,{title:`任务历史 (${e.length})`,children:t.jsx(List,{dataSource:e,renderItem:e=>{const r=mn[e.status];return t.jsx(List.Item,{actions:["generating"===e.status&&t.jsx(Button,{size:"small",onClick:()=>n(e.id),children:"取消"},"cancel"),"completed"===e.status&&e.resultUrl&&t.jsx(Button,{size:"small",icon:t.jsx(DownloadOutlined,{}),onClick:()=>a(e.resultUrl,`${e.type}_${e.id}.${"image"===e.type?"png":"mp4"}`),children:"下载"},"download"),t.jsx(Button,{size:"small",danger:!0,icon:t.jsx(DeleteOutlined,{}),onClick:()=>s(e.id),children:"删除"},"delete")].filter(Boolean),children:t.jsx(List.Item.Meta,{avatar:"image"===e.type&&e.resultUrl?t.jsx(Image,{src:e.resultUrl,width:80,height:80,style:{objectFit:"cover"}}):null,title:t.jsxs(Space,{children:[t.jsx(Tag,{color:"blue",children:hn[e.type]}),t.jsx(Tag,{icon:r.icon,color:r.color,children:r.text}),e.progress>0&&"generating"===e.status&&t.jsxs(pn,{type:"secondary",children:[e.progress,"%"]})]}),description:t.jsxs(Space,{direction:"vertical",size:0,children:[t.jsx(pn,{ellipsis:!0,style:{maxWidth:300},title:e.prompt,children:e.prompt}),t.jsx(pn,{type:"secondary",style:{fontSize:12},children:new Date(e.createdAt).toLocaleString()}),e.error&&t.jsx(pn,{type:"danger",style:{fontSize:12},children:e.error})]})})})}})}),yn=({visible:e,type:a,url:n,onClose:s,onDownload:r})=>t.jsx(Modal,{open:e,footer:null,onCancel:s,width:"video"===a?800:600,centered:!0,children:t.jsxs("div",{style:{textAlign:"center"},children:["image"===a&&n&&t.jsx(Image,{src:n,style:{maxWidth:"100%",maxHeight:"70vh"}}),"video"===a&&n&&t.jsx("video",{src:n,controls:!0,style:{maxWidth:"100%",maxHeight:"70vh"},autoPlay:!0}),t.jsxs(Space,{style:{marginTop:16},children:[t.jsx(Button,{icon:t.jsx(DownloadOutlined,{}),onClick:r,children:"下载"}),t.jsx(Button,{icon:t.jsx(CloseOutlined,{}),onClick:s,children:"关闭"})]})]})}),xn=[{label:"1:1 方形",value:"1:1",width:1024,height:1024},{label:"16:9 宽屏",value:"16:9",width:1920,height:1080},{label:"9:16 竖屏",value:"9:16",width:1080,height:1920},{label:"4:3 标准",value:"4:3",width:1440,height:1080},{label:"3:4 竖版",value:"3:4",width:1080,height:1440}],jn={container:"_container_a2xdr_1",generatorCard:"_generatorCard_a2xdr_9",tabs:"_tabs_a2xdr_9",formSection:"_formSection_a2xdr_12",formItem:"_formItem_a2xdr_17",sliderHeader:"_sliderHeader_a2xdr_22",progressSection:"_progressSection_a2xdr_27",previewCard:"_previewCard_a2xdr_34",previewContainer:"_previewContainer_a2xdr_34",previewActions:"_previewActions_a2xdr_45",historyCard:"_historyCard_a2xdr_50",taskResult:"_taskResult_a2xdr_50"},{TabPane:fn}=y,_n=()=>{const[a,n]=e.useState("image"),[s,r]=e.useState(!1),[i,o]=e.useState("image"),{prompt:l,negativePrompt:d,selectedProvider:c,selectedStyle:u,aspectRatio:p,numImages:m,duration:g,motionStrength:y,referenceImage:x,isGenerating:j,progress:f,tasks:_,previewImage:v,previewVideo:w,setPrompt:S,setNegativePrompt:b,setSelectedProvider:C,setSelectedStyle:N,setAspectRatio:k,setNumImages:I,setDuration:T,setMotionStrength:A,setReferenceImage:O,generateImage:E,generateVideo:P,cancelTask:$,deleteTask:D,downloadResult:M}=(()=>{const[t,a]=e.useState("image"),[n,s]=e.useState(""),[r,i]=e.useState(""),[o,l]=e.useState("bytedance-seedream"),[d,c]=e.useState("realistic"),[u,p]=e.useState("1:1"),[m,g]=e.useState(1),[y,x]=e.useState(5),[j,f]=e.useState(.5),[_,v]=e.useState(null),[w,S]=e.useState(!1),[b,C]=e.useState(0),[N,k]=e.useState([]),[I,T]=e.useState(null),[A,O]=e.useState(null),E=e.useCallback(()=>{k(Et.getAllTasks())},[]);return e.useEffect(()=>{E();const e=setInterval(E,3e3);return()=>clearInterval(e)},[E]),{activeTab:t,prompt:n,negativePrompt:r,selectedProvider:o,selectedStyle:d,aspectRatio:u,numImages:m,duration:y,motionStrength:j,referenceImage:_,isGenerating:w,progress:b,tasks:N,previewImage:I,previewVideo:A,setActiveTab:a,setPrompt:s,setNegativePrompt:i,setSelectedProvider:l,setSelectedStyle:c,setAspectRatio:p,setNumImages:g,setDuration:x,setMotionStrength:f,setReferenceImage:v,generateImage:async()=>{if(n.trim()){S(!0),C(0);try{const e=xn.find(e=>e.value===u),t={prompt:n.trim(),negativePrompt:r.trim()||void 0,width:e?.width||1024,height:e?.height||1024,aspectRatio:u,style:d,numImages:m},a=await Et.generateImage(t,{provider:o,apiKey:"mock-api-key"},e=>C(e));"completed"===a.status?(h.success("图像生成完成"),a.url&&T(a.url)):h.error(a.error||"生成失败")}catch(e){h.error(e instanceof Error?e.message:"生成失败")}finally{S(!1),C(0),E()}}else h.warning("请输入描述词")},generateVideo:async()=>{if(n.trim()){S(!0),C(0);try{const e={prompt:n.trim(),negativePrompt:r.trim()||void 0,imageUrl:_?.url,duration:y,aspectRatio:u,motionStrength:j},t=await Et.generateVideo(e,{provider:o,apiKey:"mock-api-key"},e=>C(e));"completed"===t.status?(h.success("视频生成完成"),t.url&&O(t.url)):h.error(t.error||"生成失败")}catch(e){h.error(e instanceof Error?e.message:"生成失败")}finally{S(!1),C(0),E()}}else h.warning("请输入描述词")},cancelTask:e=>{Et.cancelTask(e),h.info("已取消"),E()},deleteTask:e=>{Et.deleteTask(e),h.success("已删除"),E()},downloadResult:(e,t)=>{const a=document.createElement("a");a.href=e,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)},clearPreview:()=>{T(null),O(null)},refreshTasks:E}})(),z=()=>{"image"===a?E():P()},B=e=>{o(e),r(!0)},F=_.filter(e=>e.type===a);return t.jsxs("div",{className:jn.container,children:[t.jsxs(Tabs,{activeKey:a,onChange:e=>n(e),children:[t.jsx(fn,{tab:t.jsxs("span",{children:[t.jsx(PictureOutlined,{}),"图像生成"]}),children:t.jsxs(Row,{gutter:16,children:[t.jsx(Col,{span:12,children:t.jsx(un,{type:"image",prompt:l,negativePrompt:d,provider:c,style:u,aspectRatio:p,numImages:m,duration:g,motionStrength:y,referenceImage:x,isGenerating:j,progress:f,onPromptChange:S,onNegativePromptChange:b,onProviderChange:e=>C(e),onStyleChange:N,onAspectRatioChange:k,onNumImagesChange:I,onDurationChange:T,onMotionStrengthChange:A,onReferenceImageChange:O,onGenerate:z})}),t.jsx(Col,{span:12,children:t.jsx(gn,{tasks:F,onDownload:M,onCancel:$,onDelete:D})})]})},"image"),t.jsx(fn,{tab:t.jsxs("span",{children:[t.jsx(VideoCameraOutlined,{}),"视频生成"]}),children:t.jsxs(Row,{gutter:16,children:[t.jsx(Col,{span:12,children:t.jsx(un,{type:"video",prompt:l,negativePrompt:d,provider:c,style:u,aspectRatio:p,numImages:m,duration:g,motionStrength:y,referenceImage:x,isGenerating:j,progress:f,onPromptChange:S,onNegativePromptChange:b,onProviderChange:e=>C(e),onStyleChange:N,onAspectRatioChange:k,onNumImagesChange:I,onDurationChange:T,onMotionStrengthChange:A,onReferenceImageChange:O,onGenerate:z})}),t.jsx(Col,{span:12,children:t.jsx(gn,{tasks:F,onDownload:M,onCancel:$,onDelete:D})})]})},"video")]}),t.jsx(yn,{visible:s,type:i,url:"image"===i?v:w,onClose:()=>r(!1),onDownload:()=>{const e="image"===i?v:w;e&&M(e,`preview_${Date.now()}.${"image"===i?"png":"mp4"}`)}}),(v||w)&&t.jsxs("div",{className:jn.previewSection,children:[v&&"image"===a&&t.jsx("img",{src:v,alt:"预览",className:jn.previewImage,onClick:()=>B("image")}),w&&"video"===a&&t.jsx("video",{src:w,controls:!0,className:jn.previewVideo,onClick:()=>B("video")})]})]})},{Title:vn,Text:wn}=p,{TabPane:Sn}=y,bn=()=>{const[a,n]=e.useState("workflow");return t.jsxs("div",{className:"_container_hfdi9_1",children:[t.jsxs("div",{className:"_header_hfdi9_6",children:[t.jsxs(Space,{children:[t.jsx(ThunderboltOutlined,{style:{fontSize:24,color:"#faad14"}}),t.jsx(vn,{level:3,style:{margin:0},children:"漫剧工作流"})]}),t.jsx(wn,{type:"secondary",children:"节点式可视化工作流编辑器，自由组合 AI、图像、视频、音频节点"})]}),t.jsx(Alert,{message:"工作流编辑器",description:"从左侧拖拽节点到画布，连接节点创建工作流。支持 AI 对话、图像生成、视频生成、语音合成等 25+ 节点类型。",type:"info",showIcon:!0,icon:t.jsx(InfoCircleOutlined,{}),style:{marginBottom:16}}),t.jsx(sn,{}),t.jsx(Card,{className:"_workflowCard_hfdi9_12",children:t.jsxs(Tabs,{activeKey:a,onChange:n,children:[t.jsx(Sn,{tab:t.jsxs("span",{children:[t.jsx(ClusterOutlined,{}),"工作流编辑器"]}),children:t.jsx("div",{style:{height:600},children:t.jsx(Qa,{})})},"workflow"),t.jsx(Sn,{tab:t.jsxs("span",{children:[t.jsx(PictureOutlined,{}),"图像/视频生成"]}),children:t.jsx(_n,{})},"generation")]})})]})},Cn=(e,t)=>{try{window.localStorage.setItem(e,JSON.stringify(t))}catch(a){}},Nn={autoSave:!0,autoUpdate:!0,highQualityExport:!0,enableTranscode:!1,showLineNumbers:!0,defaultModelIndex:0,preferredAIProvider:"openai",preferredAICategory:"all",language:"zh",theme:"auto",recentProjects:[]},kn=e.createContext(void 0),In=({children:a})=>{const{settings:n,updateSettings:s,resetSettings:r,addRecentProject:i}=(()=>{const[t,a]=e.useState(()=>((e,t)=>{try{const e=window.localStorage.getItem("app_settings");return e?JSON.parse(e):t}catch(a){return t}})(0,Nn));return{settings:t,updateSettings:e.useCallback(e=>{a(t=>{const a={...t,...e};return Cn("app_settings",a),a})},[]),resetSettings:e.useCallback(()=>{a(Nn),Cn("app_settings",Nn)},[]),addRecentProject:e.useCallback(e=>{a(t=>{const a=(t.recentProjects||[]).filter(t=>t!==e),n=[e,...a].slice(0,10),s={...t,recentProjects:n};return Cn("app_settings",s),s})},[])}})();return e.useEffect(()=>{const e=()=>{const{theme:e}=n,t=window.matchMedia("(prefers-color-scheme: dark)").matches,a="dark"===e||"auto"===e&&t;document.documentElement.classList.toggle("dark",a),document.documentElement.classList.toggle("dark-theme",a),document.documentElement.setAttribute("data-theme",a?"dark":"light"),a?(document.body.style.backgroundColor="#141414",document.body.style.color="rgba(255, 255, 255, 0.85)"):(document.body.style.backgroundColor="#fff",document.body.style.color="rgba(0, 0, 0, 0.85)")};e();const t=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{"auto"===n.theme&&e()};return t.addEventListener?t.addEventListener("change",a):t.addListener(a),()=>{t.removeEventListener?t.removeEventListener("change",a):t.removeListener(a)}},[n.theme]),e.useEffect(()=>{document.documentElement.setAttribute("lang",n.language)},[n.language]),t.jsx(kn.Provider,{value:{settings:n,updateSettings:s,resetSettings:r,addRecentProject:i},children:a})},Tn={zh:{"app.name":"ClipAiMan","app.save":"保存","app.cancel":"取消","app.confirm":"确认","app.delete":"删除","app.edit":"编辑","app.add":"添加","theme.mode":"主题模式","theme.light":"亮色","theme.dark":"暗色","theme.auto":"自动","theme.toggle":"切换亮/暗色主题","settings.title":"设置","settings.subtitle":"自定义您的应用程序设置和AI模型配置","settings.save":"保存设置","settings.saved":"设置已保存","settings.saveSuccess":"您的设置已成功保存并应用","settings.models":"AI模型","settings.general":"通用设置","settings.about":"关于","settings.privacy":"隐私","settings.models.title":"AI模型","settings.models.message":"选择您偏好的AI模型","settings.models.description":"请选择您想要使用的AI模型，并配置相应的API密钥。不同模型有不同的功能和价格。","settings.models.available":"可用模型","settings.models.selectPreferred":"选择您喜欢的AI模型作为默认选项","settings.models.canChange":"您可以随时更改默认模型，或为特定任务选择不同的模型。某些模型可能需要额外的API密钥配置。","settings.api.title":"API密钥","settings.api.message":"配置AI服务提供商API密钥","settings.api.description":"为了使用各种AI模型，您需要配置相应服务提供商的API密钥。这些密钥仅存储在您的本地设备，不会传输到其他位置。","settings.api.keyConfig":"API密钥配置","settings.api.domesticServices":"国内AI服务","settings.api.howToGet":"如何获取API密钥","settings.api.missing":"API密钥缺失","settings.api.enterFirst":"请输入API密钥后再进行测试","settings.api.valid":"API密钥有效","settings.api.invalid":"API密钥无效","settings.api.validationError":"验证API密钥时发生错误，请稍后再试","settings.api.test":"测试","settings.general.title":"通用设置","settings.general.autoSave":"自动保存","settings.general.autoSaveDesc":"自动保存您的编辑，避免意外丢失数据","settings.general.lineNumbers":"显示行号","settings.general.lineNumbersDesc":"在编辑器中显示行号，方便代码导航和引用","settings.general.autoUpdate":"自动更新","settings.general.autoUpdateDesc":"启用自动更新，确保您始终使用最新版本","settings.general.performance":"性能与导出","settings.general.highQuality":"高质量导出","settings.general.highQualityDesc":"导出更高质量的视频和图像，可能需要更多处理时间","settings.general.transcode":"启用转码","settings.general.transcodeDesc":"自动转码上传的视频，以适应不同的播放设备（需更多系统资源）","settings.general.language":"界面语言","settings.general.languageDesc":"选择应用界面的显示语言"},en:{"app.name":"ClipAiMan","app.save":"Save","app.cancel":"Cancel","app.confirm":"Confirm","app.delete":"Delete","app.edit":"Edit","app.add":"Add","theme.mode":"Theme Mode","theme.light":"Light","theme.dark":"Dark","theme.auto":"Auto","theme.toggle":"Toggle Light/Dark Theme","settings.title":"Settings","settings.subtitle":"Customize your application settings and AI model configuration","settings.save":"Save Settings","settings.saved":"Settings Saved","settings.saveSuccess":"Your settings have been successfully saved and applied","settings.models":"AI Models","settings.general":"General Settings","settings.about":"About","settings.privacy":"Privacy","settings.models.title":"AI Models","settings.models.message":"Choose your preferred AI model","settings.models.description":"Please select the AI model you want to use and configure the corresponding API key. Different models have different features and prices.","settings.models.available":"Available Models","settings.models.selectPreferred":"Select your favorite AI model as the default option","settings.models.canChange":"You can change the default model at any time, or choose different models for specific tasks. Some models may require additional API key configuration.","settings.api.title":"API Keys","settings.api.message":"Configure AI service provider API keys","settings.api.description":"To use various AI models, you need to configure the corresponding service provider API keys. These keys are only stored on your local device and will not be transmitted elsewhere.","settings.api.keyConfig":"API Key Configuration","settings.api.domesticServices":"Domestic AI Services","settings.api.howToGet":"How to Get API Keys","settings.api.missing":"API Key Missing","settings.api.enterFirst":"Please enter an API key before testing","settings.api.valid":"API Key Valid","settings.api.invalid":"API Key Invalid","settings.api.validationError":"An error occurred when validating the API key, please try again later","settings.api.test":"Test","settings.general.title":"General Settings","settings.general.autoSave":"Auto Save","settings.general.autoSaveDesc":"Automatically save your edits to avoid accidental data loss","settings.general.lineNumbers":"Show Line Numbers","settings.general.lineNumbersDesc":"Display line numbers in the editor for easy code navigation and reference","settings.general.autoUpdate":"Auto Update","settings.general.autoUpdateDesc":"Enable automatic updates to ensure you are always using the latest version","settings.general.performance":"Performance and Export","settings.general.highQuality":"High Quality Export","settings.general.highQualityDesc":"Export higher quality videos and images, may require more processing time","settings.general.transcode":"Enable Transcoding","settings.general.transcodeDesc":"Automatically transcode uploaded videos to suit different playback devices (requires more system resources)","settings.general.language":"Interface Language","settings.general.languageDesc":"Select the display language for the application interface"}},An=navigator.language.toLowerCase().startsWith("zh")?"zh":"en",On={zh:{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1},en:{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0}},En={zh:{maximumFractionDigits:2},en:{maximumFractionDigits:2}},Pn={zh:["B","KB","MB","GB","TB"],en:["B","KB","MB","GB","TB"]},$n=({children:a})=>{const{isDarkMode:n}=E(),{language:s}=function(){const[t,a]=e.useState(localStorage.getItem("app_language")||An);e.useEffect(()=>{localStorage.setItem("app_language",t)},[t]);const n=e.useCallback((e,a)=>{let n=Tn[t]?.[e]||e;return a&&Object.entries(a).forEach(([e,t])=>{n=n.replace(new RegExp(`{${e}}`,"g"),String(t))}),n},[t]),s=e.useCallback(e=>{a(e)},[]),r=e.useCallback(e=>{const a="string"==typeof e||"number"==typeof e?new Date(e):e;return new Intl.DateTimeFormat("zh"===t?"zh-CN":"en-US",On[t]).format(a)},[t]),i=e.useCallback(e=>new Intl.NumberFormat("zh"===t?"zh-CN":"en-US",En[t]).format(e),[t]),o=e.useCallback(e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024)),n=parseFloat((e/Math.pow(1024,a)).toFixed(2));return`${i(n)} ${Pn[t][a]}`},[t,i]),l=e.useCallback(e=>{const a=Math.floor(e/3600),n=Math.floor(e%3600/60),s=Math.floor(e%60);return a>0?"zh"===t?`${a}小时${n}分钟`:`${a}h ${n}m`:n>0?"zh"===t?`${n}分${s}秒`:`${n}m ${s}s`:"zh"===t?`${s}秒`:`${s}s`},[t]);return{t:n,language:t,changeLanguage:s,formatDate:r,formatNumber:i,formatFileSize:o,formatDuration:l}}(),r="zh"===s?_:v,i={Button:{borderRadius:8,controlHeight:40,fontWeight:500,primaryShadow:n?"none":"0 2px 6px rgba(30, 136, 229, 0.2)"},Card:{borderRadius:12,boxShadow:n?"none":"0 2px 8px rgba(0, 0, 0, 0.08)"},Menu:{itemBorderRadius:8,subMenuItemBorderRadius:6},Modal:{borderRadius:12},Select:{borderRadius:8},Input:{borderRadius:8},Radio:{borderRadius:8},Checkbox:{borderRadius:4},Avatar:{borderRadius:8},Dropdown:{borderRadius:8,paddingBlock:4,paddingInline:0},Tabs:{cardBg:n?"rgba(255, 255, 255, 0.04)":"rgba(0, 0, 0, 0.02)",cardGutter:4},Table:{borderRadius:12,headerBg:n?"rgba(255, 255, 255, 0.04)":"#f5f7fa"}};return t.jsx(ConfigProvider,{locale:r,theme:{token:{colorPrimary:"#1E88E5",colorSuccess:"#26A69A",colorWarning:"#FF9800",colorError:"#FF5252",colorInfo:"#42A5F5",borderRadius:8,wireframe:!1,fontSize:14,fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif",colorTextBase:n?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.87)",colorBgBase:n?"#121212":"#ffffff",colorBgElevated:n?"#1f1f1f":"#ffffff",colorBorder:n?"rgba(255, 255, 255, 0.15)":"rgba(0, 0, 0, 0.08)",boxShadow:n?"0 2px 8px rgba(0, 0, 0, 0.5)":"0 2px 8px rgba(0, 0, 0, 0.1)",motionEaseInOut:"cubic-bezier(0.645, 0.045, 0.355, 1)"},components:i,algorithm:n?f.darkAlgorithm:f.defaultAlgorithm},children:t.jsx(AntdApp,{children:a})})},Dn=({children:e})=>t.jsx(O,{children:t.jsx(In,{children:t.jsx($n,{children:e})})}),Mn=()=>{const[a,n]=e.useState(!1),[s,r]=e.useState(!0);return e.useEffect(()=>{(async()=>{})()},[]),e.useEffect(()=>{(async()=>{r(!0);try{setTimeout(()=>{n(!0),r(!1)},1e3)}catch(e){n(!1),r(!1),w.error({message:"依赖检查失败",description:"无法检测到FFmpeg，某些功能可能无法正常工作。请确保已正确安装FFmpeg。",duration:0})}})()},[]),e.useEffect(()=>{const e=a?"应用初始化完成，所有功能正常可用。":"应用初始化完成，但某些功能可能受限。";s||h.info({content:e,duration:3})},[a,s]),t.jsx(Dn,{children:t.jsx(i,{children:t.jsx(B,{children:t.jsxs(o,{children:[t.jsx(l,{path:"/",element:t.jsx(U,{})}),t.jsx(l,{path:"/project/new",element:t.jsx(be,{})}),t.jsx(l,{path:"/project/edit/:projectId",element:t.jsx(be,{})}),t.jsx(l,{path:"/project/:projectId",element:t.jsx(Yt,{})}),t.jsx(l,{path:"/editor",element:t.jsx(ia,{})}),t.jsx(l,{path:"/editor/:projectId",element:t.jsx(ia,{})}),t.jsx(l,{path:"/scripts",element:t.jsx(U,{})}),t.jsx(l,{path:"/script/:scriptId",element:t.jsx(ea,{})}),t.jsx(l,{path:"/workflow",element:t.jsx(bn,{})}),t.jsx(l,{path:"/templates",element:t.jsx(U,{})}),t.jsx(l,{path:"/settings",element:t.jsx(fa,{})}),t.jsx(l,{path:"*",element:t.jsx(d,{to:"/",replace:!0})})]})})})})};window.addEventListener("error",e=>{e.message&&(e.message.includes("@tauri-apps/api")||e.message.includes("Tauri"))&&e.preventDefault()});const zn=document.getElementById("root");if(!zn)throw new Error("找不到根元素");c.createRoot(zn).render(t.jsx(r.StrictMode,{children:t.jsx(O,{children:t.jsx(Mn,{})})}));
