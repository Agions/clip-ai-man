# 漫剧师 项目重构计划

## 项目现状分析

### 当前问题
1. **代码重复**: src/services/ 和 src/core/services/ 重复
2. **组件混乱**: src/components/ 包含新旧版本组件
3. **类型分散**: 类型定义分布在多个文件
4. **页面臃肿**: 部分页面文件过大（Settings.tsx 34KB）
5. **命名不一致**: 部分组件使用旧命名（ScriptGenerator vs StoryboardGenerator）

### 当前结构
```
src/
├── components/          # 组件层（混乱）
├── services/           # 旧服务层（应删除）
├── core/               # 核心层（新）
│   ├── services/      # 新服务层
│   ├── hooks/         # Hooks
│   ├── constants/     # 常量
│   └── ...
├── pages/              # 页面层
└── types/              # 类型定义
```

## 重构目标

### 1. 目录结构标准化
```
src/
├── core/                      # 核心层
│   ├── services/             # 业务服务
│   ├── hooks/                # 自定义 Hooks
│   ├── stores/               # 状态管理
│   ├── constants/            # 常量
│   ├── types/                # 类型定义
│   ├── utils/                # 工具函数
│   └── api/                  # API 客户端
├── components/               # 组件层
│   ├── common/              # 通用组件
│   ├── business/            # 业务组件
│   └── layout/              # 布局组件
├── pages/                    # 页面层
├── assets/                   # 静态资源
└── styles/                   # 全局样式
```

### 2. 代码清理
- [ ] 删除重复的服务文件
- [ ] 删除未使用的组件
- [ ] 统一命名规范
- [ ] 合并重复的类型定义

### 3. 组件重构
- [ ] 拆分大型组件（Settings.tsx）
- [ ] 统一组件命名（Script → Storyboard）
- [ ] 提取通用逻辑到 Hooks

### 4. 类型系统重构
- [ ] 集中类型定义
- [ ] 消除类型重复
- [ ] 完善类型导出

## 任务分配

### 子代理 1: 目录结构重构
**任务**: 建立标准目录结构
- 创建新的目录结构
- 移动文件到新位置
- 更新导入路径
- 删除旧目录

### 子代理 2: 服务层重构
**任务**: 统一服务层
- 合并重复的服务文件
- 删除旧 services/ 目录
- 更新所有服务导入
- 确保功能正常

### 子代理 3: 组件层重构
**任务**: 清理和重构组件
- 删除未使用的组件
- 重命名组件（Script → Storyboard）
- 拆分大型组件
- 更新组件导入

### 子代理 4: 类型系统重构
**任务**: 统一类型定义
- 合并类型定义到 core/types/
- 删除重复的类型
- 更新所有类型导入
- 确保类型检查通过

### 子代理 5: 页面层重构
**任务**: 重构页面
- 拆分大型页面
- 更新页面导入
- 优化页面结构
- 确保路由正常

## 执行顺序

1. **阶段 1**: 类型系统重构（子代理 4）
   - 类型是基础，先确定类型定义

2. **阶段 2**: 服务层重构（子代理 2）
   - 服务层依赖类型

3. **阶段 3**: 组件层重构（子代理 3）
   - 组件依赖服务和类型

4. **阶段 4**: 页面层重构（子代理 5）
   - 页面依赖组件和服务

5. **阶段 5**: 目录结构重构（子代理 1）
   - 最后整理目录结构

## 命名规范

### 文件命名
- 组件: PascalCase (StoryboardGenerator.tsx)
- 服务: camelCase (novel.service.ts)
- Hooks: camelCase (useNovel.ts)
- 类型: camelCase (index.ts 内定义)
- 常量: UPPER_SNAKE_CASE

### 导出规范
- 默认导出: 组件、服务类
- 命名导出: 类型、工具函数、Hooks

## 检查清单

- [ ] TypeScript 编译通过
- [ ] 所有导入路径正确
- [ ] 无重复代码
- [ ] 组件正常渲染
- [ ] 功能测试通过
- [ ] 构建成功

## 风险与回滚

### 风险
1. 重构过程中可能破坏功能
2. 导入路径更新可能遗漏
3. 类型定义可能不兼容

### 缓解措施
1. 每个阶段完成后进行测试
2. 保持 Git 提交记录
3. 准备回滚方案

### 回滚策略
- 每个子代理任务独立分支
- 完成后合并到重构分支
- 最终合并到 main
