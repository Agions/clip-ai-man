# ClipAiMan 漫剧生成流程优化方案

## 项目目标
将 ClipAiMan 打造成精品 AI 漫剧视频创作平台

## 优化内容

### 1. 工作流稳定性增强

#### 1.1 重试机制
- API 调用失败自动重试 3 次
- 指数退避策略 (1s → 2s → 4s)
- 区分可重试和不可重试错误

#### 1.2 检查点保存
- 每个步骤完成后自动保存状态
- 支持中断后从任意步骤继续
- 本地存储 + 云端同步

#### 1.3 智能缓存
- 相同输入 Skip 已完成步骤
- 缓存 key: 内容 hash + 配置 hash

#### 1.4 并行处理
- 多角色并行设计
- 多场景并行渲染
- 配音与画面并行生成

---

### 2. 对口型功能 (Lip Sync)

#### 2.1 技术方案
使用 **Wav2Lip / SadTalker** 方案：
1. TTS 生成配音音频
2. 提取音频MFCC特征
3. 生成对口型视频

#### 2.2 工作流整合
```
voiceover → lip-sync → animation → export
```

#### 2.3 新增服务
- `lip-sync.service.ts` - 对口型处理

---

## 实现计划

### Phase 1: 基础优化 (重试 + 检查点)
- [ ] 添加重试装饰器
- [ ] 添加检查点保存
- [ ] 添加状态恢复

### Phase 2: 性能优化 (缓存 + 并行)
- [ ] 添加智能缓存
- [ ] 添加并行处理

### Phase 3: 对口型功能
- [ ] 新增 lip-sync 服务
- [ ] 整合到工作流
- [ ] UI 集成

---

*创建于: 2026-02-22*
